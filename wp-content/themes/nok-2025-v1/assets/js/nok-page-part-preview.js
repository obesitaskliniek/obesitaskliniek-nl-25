(()=>{"use strict";var t={n:e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return t.d(i,{a:i}),i},d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};window.wp.editor;const e=window.wp.domReady;var i=t.n(e);const s=window.wp.element,r=window.wp.data,o={degsteps:60,startsat:100,startbri:100,startdeg:0,gradsteps:10,paletlim:[0,360]},n=new class{constructor(t,e,i,s,r,n){this.startdeg=null!=s?s:o.startdeg,this.degsteps=null!=t?t:o.degsteps,this.startsat=null!=e?e:o.startsat,this.startbri=null!=i?i:o.startbri,this.gradsteps=r&&r>1?r:o.gradsteps,this.paletlim=null!=n?n:o.paletlim,this.calls=0,this.color=null,this.deg=0,this.cyc=0,this.bri=100,this.sat=100,this.opa=1}new(t,e){return this.color=this._generateColor(t,e),this.string=this.color.string,this.values=this.color.values,this.contra=this.color.contra,this.hex=this._rgbToHex(this.color.values),this.calls++,this}adjust(t){var e,i,s,r;const o=null!==(e=t.deg)&&void 0!==e?e:0,n=null!==(i=t.sat)&&void 0!==i?i:this.sat,a=null!==(s=t.bri)&&void 0!==s?s:this.bri,c=null!==(r=t.opa)&&void 0!==r?r:this.opa,d=(this.deg+o)%this.paletlim[1],l=this._clamp(a<=1&&a>0?this.bri*a:a,0,100),h=this._clamp(n<=1&&n>0?this.sat*n:n,0,100),u=this._clamp(c,0,1);return this._hsvToRgb(d,h,l,u)}_generateColor(t,e){let i=!1;if("string"==typeof t)if("#"===t[0]){const e=this._hslToHsv(this._hexToHsl(t));this.deg=e[0],this.sat=e[1],this.bri=e[2],i=!0}else this.deg=this._stringToDegrees(t);else this.startdeg=Math.max(this.startdeg,this.paletlim[0]),this.deg=this.startdeg+this.calls*this.degsteps;if(this.cyc=Math.floor(this.deg/this.paletlim[1]),!i&&(this.bri=t&&t>0?t:this.startbri,this.sat=e&&e>0?e:this.startsat,this.bri=Math.abs(this.bri%101),this.sat=Math.abs(this.sat%101),this.deg=this.deg%(this.paletlim[1]+1),this.deg=Math.max(this.deg,this.paletlim[0]),this.paletlim[0]%this.degsteps===0&&this.cyc>0)){const e=this.cyc*this.gradsteps;this.bri=t&&t>0?t:this.startbri-e,e>=100&&(this.cyc=0,this.gradsteps=this.gradsteps/2)}return this._hsvToRgb(this.deg,this.sat,this.bri)}_stringToDegrees(t){const e=[...t].reduce((t,e)=>e.charCodeAt(0)+((t<<5)-t),0);return Math.abs(e)%360}_hsvToRgb(t,e,i,s){t/=360,e/=100,i/=100,s=void 0!==s?parseFloat(s):void 0;const r=Math.floor(6*t),o=6*t-r,n=i*(1-e),a=i*(1-o*e),c=i*(1-(1-o)*e);let d,l,h;switch(r%6){case 0:d=i,l=c,h=n;break;case 1:d=a,l=i,h=n;break;case 2:d=n,l=i,h=c;break;case 3:d=n,l=a,h=i;break;case 4:d=c,l=n,h=i;break;case 5:d=i,l=n,h=a}const u=[Math.round(255*d),Math.round(255*l),Math.round(255*h)],g=void 0!==s?"rgba":"rgb";return void 0!==s&&u.push(s),{values:u,string:`${g}(${u.join(",")})`,hex:this._rgbToHex(u),contra:this._textContrast(u)}}_hexToHsl(t){const e=this._hexToRgb(t),i=e[0]/255,s=e[1]/255,r=e[2]/255,o=Math.min(i,s,r),n=Math.max(i,s,r),a=n-o;let c=0;0!==a&&(c=n===i?(s-r)/a%6:n===s?(r-i)/a+2:(i-s)/a+4),c=Math.round(60*c),c<0&&(c+=360);const d=(n+o)/2;return[c,+(100*(0===a?0:a/(1-Math.abs(2*d-1)))).toFixed(1),+(100*d).toFixed(1)]}_hslToHsv(t){const e=t[1]*(t[2]<50?t[2]:100-t[2])/100,i=0===e?0:2*e/(t[2]+e)*100,s=t[2]+e;return[t[0],i,s]}_hexToRgb(t){return t.match(/\w\w/g).map(t=>+`0x${t}`)}_rgbToHex(t){return"#"+t.slice(0,3).map(t=>t.toString(16).padStart(2,"0")).join("")}_textContrast(t){return Math.round((299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3)>125?"rgb(0,0,0)":"rgb(255,255,255)"}_clamp(t,e,i){return Math.min(Math.max(t,e),i)}},a=window.location.search.includes("debug=true"),c="font-family: Lucida Grande,Lucida Sans Unicode,Lucida Sans,Geneva,Verdana,sans-serif",d=new Map,l={log:"black",info:"#1e529e",warn:"#fd7e14",error:"red"};function h(t,e=!1){const i=`${t}:${e}`;if(d.has(i))return d.get(i);const s=n.new(t),r=`${c};padding:3px 5px;border-radius:6px;`,o=e?r+"color: #339;border: 1px solid #339B;background-color: #FFF8;margin-right:2px;":r+`color:${s.contra};border: 1px solid transparent;`+`background-color:${s.string};margin-right:10px;`+`background-image:linear-gradient(0deg,${s.adjust({deg:10}).string} 0%,${s.adjust({opa:1}).string} 100%);`;return d.set(i,o),o}function u(t,e,i){if(!a)return;const s=console[t]||console.log,r=`${c};color:${l[t]};`,o=e.match(/^(core|util)\.(.+)/);if(o){const t=o[1],n=o[2],a=h(t,!0),c=h(e,!1);"object"==typeof i&&null!==i?s(`%c${t}%c${n}`,a,c,i):s(`%c${t}%c${n}%c ${i}`,a,c,r)}else{const t=h(e,!1);"object"==typeof i&&null!==i?s(`%c${e}`,t,i):s(`%c${e}%c ${i}`,t,r)}}const g={log(t,e){u("log",t,e)},info(t,e){u("info",t,e)},warn(t,e){u("warn",t,e)},error(t,e){u("error",t,e)}};"undefined"!=typeof window&&window.location.search.includes("debug=true");const p="nok-page-part-preview",m="nok-page-part-preview";function w(){const t=(0,s.useRef)(null),[e,i]=(0,s.useState)(400);return(0,s.useEffect)(()=>{const e=t.current;if(!e)return;const s=()=>{e.srcdoc||(()=>{try{const t=e.contentDocument||e.contentWindow.document,s=Math.min(t.documentElement.scrollHeight,t.body.scrollHeight);i(s)}catch(t){}})()};return e.addEventListener("load",s),()=>{e.removeEventListener("load",s)}},[]),(0,s.createElement)("iframe",{ref:t,id:`${m}-iframe`,srcdoc:'\n      <div style="\n        display:flex;\n        align-items:center;\n        justify-content:center;\n        height: 90vh;\n        color:#777;\n        font-family: -apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,Oxygen-Sans,Ubuntu,Cantarell,\'Helvetica Neue\',sans-serif;\n      ">\n        Klik "Refresh Preview" om de preview te laden.\n        <div class="loader" style="margin:15px;">\n            <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><circle cx="12" cy="2.5" r="1.5" opacity=".14"/><circle cx="16.75" cy="3.77" r="1.5" opacity=".29"/><circle cx="20.23" cy="7.25" r="1.5" opacity=".43"/><circle cx="21.50" cy="12.00" r="1.5" opacity=".57"/><circle cx="20.23" cy="16.75" r="1.5" opacity=".71"/><circle cx="16.75" cy="20.23" r="1.5" opacity=".86"/><circle cx="12" cy="21.5" r="1.5"/><animateTransform attributeName="transform" type="rotate" calcMode="discrete" dur="0.75s" values="0 12 12;30 12 12;60 12 12;90 12 12;120 12 12;150 12 12;180 12 12;210 12 12;240 12 12;270 12 12;300 12 12;330 12 12;360 12 12" repeatCount="indefinite"/></g></svg>\n        </div>\n      </div>\n    ',style:{width:"100%",height:`${e}px`,border:"none"}})}i()(()=>{g.info(p,"domReady");const t=document.getElementById(`${m}-root`);t&&(0,s.render)((0,s.createElement)(w),t);const e=document.getElementById(`${m}-button`),i=document.getElementById(`${m}-iframe`);if(!i)return void g.error(p,"Failed to load iframe");e||g.warn(p,"Update button not found, continuing with frame only");const o=(t=!1)=>{t&&g.info(p,"User-initiated preview update");const e=wp.data.select("core/editor").getCurrentPostId(),s=wp.data.select("core/editor").getEditedPostAttribute("meta")||{},o=new URLSearchParams({action:"store_preview_state",post_id:e,nonce:window.PagePartDesignSettings.nonce});o.append("meta_fields",JSON.stringify(s)),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then(t=>t.json()).then(t=>(g.info(p,"Meta fields stored in transient"),wp.data.dispatch("core/editor").autosave())).then(()=>(g.info(p,"Autosave completed"),new Promise((t,e)=>{const i=setTimeout(()=>{o(),e(new Error("Timeout waiting for autosave to complete"))},1e4),s=()=>{if(!wp.data.select("core/editor").isAutosavingPost()){const e=wp.data.select("core/editor").getEditedPostPreviewLink();if(e)return clearTimeout(i),t(e),!0}return!1};if(s())return;const o=(0,r.subscribe)(()=>{s()&&o()})}))).then(t=>{wp.data.dispatch("core/notices").removeNotice("autosave-exists"),i.removeAttribute("srcdoc"),i.src=`${t}&hide_adminbar=1`}).catch(t=>{g.error(p,`Preview update failed: ${t}`)})};window.nokUpdatePreview=o,e&&e.addEventListener("click",()=>o(!0)),(async()=>{await new Promise(t=>{const e=(0,r.subscribe)(()=>{const i=(0,r.select)("core/editor").getCurrentPostId(),s=(0,r.select)("core/editor").getCurrentPostType();i&&s&&(e(),t())})}),g.info(p,"Editor ready, initializing preview system");let t=(0,r.select)("core/editor").getEditedPostAttribute("meta")?.design_slug,e=(0,r.select)("core/editor").getEditedPostAttribute("meta")||{};const{previewLink:s,designSlug:n}=await new Promise(t=>{const e=()=>{const t=(0,r.select)("core/editor").getEditedPostPreviewLink(),e=(0,r.select)("core/editor").getEditedPostAttribute("meta")?.design_slug;return t&&!t.includes("auto-draft")&&e?{previewLink:t,designSlug:e}:null},i=e();if(i)return void t(i);const s=(0,r.subscribe)(()=>{const i=e();i&&(s(),t(i))})});g.info(p,"Loading initial preview"),i.removeAttribute("srcdoc"),i.src=`${s}&hide_adminbar=1`,(0,r.subscribe)(()=>{const i=(0,r.select)("core/editor").getEditedPostAttribute("meta")||{},s=i.design_slug;if(s!==t)return t=s,g.info(p,`Design slug changed to: ${s}`),void o();JSON.stringify(i)!==JSON.stringify(e)&&(e={...i},g.info(p,"Custom fields changed, updating preview"),o())}),g.info(p,"Preview system fully initialized")})()})})();