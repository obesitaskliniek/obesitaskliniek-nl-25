(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};window.wp.editPost;const t=window.wp.domReady;var n=e.n(t);const o=window.wp.element,r=(window.wp.data,window.wp.components,{threshold:100,execStart:!1,execWhile:!1,execDone:!0}),i="nok-page-part-preview";function s(){const e=(0,o.useRef)(null),[t,n]=(0,o.useState)(400);return(0,o.useEffect)(()=>{const t=e.current;if(!t)return;const o=()=>{t.srcdoc||(()=>{try{const e=t.contentDocument||t.contentWindow.document,o=Math.min(e.documentElement.scrollHeight,e.body.scrollHeight);n(o)}catch(e){}})()};return t.addEventListener("load",o),()=>{t.removeEventListener("load",o)}},[]),(0,o.createElement)("iframe",{ref:e,id:`${i}-iframe`,srcdoc:"\n      <div style=\"\n        display:flex;\n        align-items:center;\n        justify-content:center;\n        height: 90vh;\n        color:#777;\n        font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;\n      \">\n        Klik “Refresh Preview” om de preview te laden.\n      </div>\n    ",style:{width:"100%",height:`${t}px`,border:"none"}})}n()(()=>{const e=document.getElementById(`${i}-root`);e&&(0,o.render)((0,o.createElement)(s),e);const t=document.getElementById(`${i}-button`),n=document.getElementById(`${i}-iframe`);if(!n)return void console.error("Failed to load iframe");t||console.warn("Update button not found, continuing with frame only");const c=()=>{const e=document.querySelector('select[name="page_part_design_slug"]'),t=e?e.value:"";console.log("About to autosave with design_slug:",t);const o=wp.data.select("core/editor").getCurrentPostId();fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"store_preview_meta",post_id:o,design_slug:t})}).then(e=>e.json()).then(e=>(console.log("Meta stored:",e),wp.data.dispatch("core/editor").autosave())).then(()=>{console.log("Autosave completed");const e=wp.data.select("core/editor").getEditedPostPreviewLink();n.removeAttribute("srcdoc"),n.src=`${e}&hide_adminbar=1`})},a=document.querySelector('select[name="page_part_design_slug"]');a?a.addEventListener("change",function(){console.log("Design slug changed to:",this.value),c()}):console.warn("Design select dropdown not found"),t&&t.addEventListener("click",c),window.addEventListener("resize",function(e,t={}){let n={timer:0,whileTimer:0,busy:!1,...r,...t};return function(...t){clearTimeout(n.timer),!n.busy&&n.execStart&&(t[0].debounceType="start",e.apply(this,t),n.busy=!0),n.execWhile&&!n.whileTimer&&(n.whileTimer=setTimeout(()=>{t[0].debounceType="while",e.apply(this,t),n.whileTimer=!1},n.threshold)),n.timer=setTimeout(()=>{t[0].debounceType="done",n.busy=!1,n.execDone&&e.apply(this,t),clearInterval(n.whileTimer)},n.threshold)}}(e=>{c()}))})})();