(()=>{"use strict";var t={n:e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return t.d(i,{a:i}),i},d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};window.wp.editPost;const e=window.wp.domReady;var i=t.n(e);const s=window.wp.element,r=window.wp.data,o={threshold:100,execStart:!1,execWhile:!1,execDone:!0},a=new class{constructor(t,e,i,s,r,o){this.startdeg=s||0,this.degsteps=t||60,this.startsat=e||100,this.startbri=i||100,this.gradsteps=r&&r>1?r:10,this.paletlim=o||[0,360],this.skipgreen=!1,this.calls=0,this.color=null,this.deg=0,this.cyc=0,this.bri=100,this.sat=100,this.opa=1}_stringToDegrees(t){let e=[...t].reduce((t,e)=>e.charCodeAt(0)+((t<<5)-t),0);return Math.abs(e)%360}_textContrast(t){return Math.round((299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3)>125?"rgb(0,0,0)":"rgb(255,255,255)"}_componentToHex(t){var e=t.toString(16);return 1===e.length?"0"+e:e}_rgbToHex(t){return"#"+this._componentToHex(t[0])+this._componentToHex(t[1])+this._componentToHex(t[2])}_hexToRgb(t){return t.match(/\w\w/g).map(t=>+`0x${t}`)}_hexToHSL(t){let e=this._hexToRgb(t),i=e[0]/255,s=e[1]/255,r=e[2]/255,o=Math.min(i,s,r),a=Math.max(i,s,r),n=a-o,d=0,h=0,c=0;return d=0===n?0:a===i?(s-r)/n%6:a===s?(r-i)/n+2:(i-s)/n+4,d=Math.round(60*d),d<0&&(d+=360),c=(a+o)/2,h=0===n?0:n/(1-Math.abs(2*c-1)),h=+(100*h).toFixed(1),c=+(100*c).toFixed(1),[d,h,c]}_hsl2hsv(t){const e=t[1]*(t[2]<50?t[2]:100-t[2])/100,i=0===e?0:2*e/(t[2]+e)*100,s=t[2]+e;return[t[0],i,s]}_HSVtoRGB(t,e,i,s){var r,o,a,n,d,h,c,l;switch(t/=360,e/=100,i/=100,s=void 0!==s?parseFloat(s):void 0,1===arguments.length&&(e=t.s,i=t.v,t=t.h),h=i*(1-e),c=i*(1-(d=6*t-(n=Math.floor(6*t)))*e),l=i*(1-(1-d)*e),n%6){case 0:r=i,o=l,a=h;break;case 1:r=c,o=i,a=h;break;case 2:r=h,o=i,a=l;break;case 3:r=h,o=c,a=i;break;case 4:r=l,o=h,a=i;break;case 5:r=i,o=h,a=c}let u=[Math.round(255*r),Math.round(255*o),Math.round(255*a)],g="rgb";return void 0!==s&&(u.push(s),g="rgba"),{values:u,string:g+"("+u.join(",")+")",hex:this._rgbToHex(u),contra:this._textContrast(u),textContrast:this._textContrast}}doColor(t,e){let i=!1;if("string"==typeof t)if("#"===t[0]){let e=this._hsl2hsv(this._hexToHSL(t));this.deg=e[0],this.sat=e[1],this.bri=e[2],i=!0}else this.deg=this._stringToDegrees(t);else this.startdeg=this.startdeg<this.paletlim[0]?this.paletlim[0]:this.startdeg,this.deg=this.startdeg+this.calls*this.degsteps;if(this.cyc=Math.floor(this.deg/this.paletlim[1]),!i&&(this.bri=t&&t>0?t:this.startbri,this.sat=e&&e>0?e:this.startsat,this.bri=Math.abs(this.bri%101),this.sat=Math.abs(this.sat%101),this.deg=this.deg%(this.paletlim[1]+1),this.deg=this.deg<this.paletlim[0]?this.paletlim[0]:this.deg,this.paletlim[0]%this.degsteps===0&&this.cyc>0)){let i=this.cyc*this.gradsteps;this.altbri=t&&t>0?t:this.startbri-i,this.altsat=e&&e>0?e:this.startsat-i,this.altdeg=this.deg+this.degsteps/(this.cyc+1),this.altdeg=this.altdeg<this.paletlim[0]?this.altdeg-this.paletlim[0]:this.altdeg,this.bri=this.altbri,i>=100&&(this.cyc=0,this.gradsteps=this.gradsteps/2)}return this._HSVtoRGB(this.deg,this.sat,this.bri)}new(t,e){return this.color=this.doColor(t,e),this.string=this.color.string,this.values=this.color.values,this.contra=this.color.contra,this.hex=this._rgbToHex(this.color.values),this.calls++,this}adjust(t){let e,i,s,r,o=void 0!==t.deg?t.deg:0,a=void 0!==t.sat?t.sat:this.sat,n=void 0!==t.bri?t.bri:this.bri,d=void 0!==t.opa?t.opa:this.opa;return s=(this.deg+o)%this.paletlim[1],i=n<=1&&n>0?this.bri*n:n,e=a<=1&&a>0?this.sat*a:a,r=d<0?0:d>1?1:d,i=i>100?100:i<0?0:i,e=e>100?100:e<0?0:e,this._HSVtoRGB(s,e,i,r)}},n=window.location.search.includes("debug=true");function d(t){return"%c"+[].slice.call(t).join("%c")}const h="font-family: Lucida Grande,Lucida Sans Unicode,Lucida Sans,Geneva,Verdana,sans-serif";function c(t){const e=a.new(t);return`color:${e.contra};\n  background-color:${e.string};\n  background-image:linear-gradient(0deg,${e.adjust({deg:10}).string} 0%, ${e.adjust({opa:1}).string} 100%);\n  padding:3px 5px;margin-right:15px;border-radius:4px;`}const l=function(t,e){!n||console.info("object"==typeof t?t:d("object"==typeof e?[t]:arguments),`${h}; ${c(t)}`,"object"==typeof e?e:`${h};color:#1e529e;`)},u=function(t,e){!n||console.error("object"==typeof t?t:d("object"==typeof e?[t]:arguments),`${h}; ${c(t)}`,"object"==typeof e?e:`${h};color:red;`)},g="nok-page-part-preview",p="nok-page-part-preview";function m(){const t=(0,s.useRef)(null),[e,i]=(0,s.useState)(400);return(0,s.useEffect)(()=>{const e=t.current;if(!e)return;const s=()=>{e.srcdoc||(()=>{try{const t=e.contentDocument||e.contentWindow.document,s=Math.min(t.documentElement.scrollHeight,t.body.scrollHeight);i(s)}catch(t){}})()};return e.addEventListener("load",s),()=>{e.removeEventListener("load",s)}},[]),(0,s.createElement)("iframe",{ref:t,id:`${p}-iframe`,srcdoc:"\n      <div style=\"\n        display:flex;\n        align-items:center;\n        justify-content:center;\n        height: 90vh;\n        color:#777;\n        font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;\n      \">\n        Klik \"Refresh Preview\" om de preview te laden.\n      </div>\n    ",style:{width:"100%",height:`${e}px`,border:"none"}})}i()(()=>{const t=document.getElementById(`${p}-root`);t&&(0,s.render)((0,s.createElement)(m),t);const e=document.getElementById(`${p}-button`),i=document.getElementById(`${p}-iframe`);if(!i)return void u(g,"Failed to load iframe");e||function(t,e){!n||console.warn("object"==typeof t?t:d("object"==typeof e?[t]:arguments),`${h}; ${c(t)}`,"object"==typeof e?e:`${h};color:#fd7e14;`)}(g,"Update button not found, continuing with frame only");let a=!0,b=!1,w=!1;const f=(t=!1)=>{t&&(b=!0,l(g,"User-initiated preview update"));const e=wp.data.select("core/editor").getCurrentPostId(),s=wp.data.select("core/editor").getEditedPostAttribute("meta")||{},r=s.design_slug||"";l(g,`About to autosave with design_slug: ${r}`),l(g,"All meta:"),l(g,s);const o=new URLSearchParams({action:"store_preview_meta",post_id:e,design_slug:r});o.append("all_meta",JSON.stringify(s)),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then(t=>t.json()).then(t=>(l(g,"Meta stored:"),l(g,t),wp.data.dispatch("core/editor").autosave())).then(()=>{l(g,"Autosave completed");const t=wp.data.select("core/editor").getEditedPostPreviewLink();i.removeAttribute("srcdoc"),i.src=`${t}&hide_adminbar=1`}).catch(t=>{u(g,`Preview update failed: ${t}`)})};window.nokUpdatePreview=f,e&&e.addEventListener("click",()=>f(!0)),window.addEventListener("resize",function(t,e={}){let i={timer:0,whileTimer:0,busy:!1,...o,...e};return function(...e){clearTimeout(i.timer),!i.busy&&i.execStart&&(e[0].debounceType="start",t.apply(this,e),i.busy=!0),i.execWhile&&!i.whileTimer&&(i.whileTimer=setTimeout(()=>{e[0].debounceType="while",t.apply(this,e),i.whileTimer=!1},i.threshold)),i.timer=setTimeout(()=>{e[0].debounceType="done",i.busy=!1,i.execDone&&t.apply(this,e),clearInterval(i.whileTimer)},i.threshold)}}(t=>{f(!0)})),setTimeout(()=>{a=!1,(()=>{if(!w){l(g,"Loading initial preview"),wp.data.select("core/editor").getCurrentPostId();const t=wp.data.select("core/editor").getEditedPostPreviewLink();t&&!t.includes("auto-draft")&&(i.removeAttribute("srcdoc"),i.src=`${t}&hide_adminbar=1`,w=!0)}})(),l(g,"Preview system initialized, updates now enabled")},2e3);let v=(0,r.select)("core/editor").getEditedPostAttribute("meta")?.design_slug,y=(0,r.select)("core/editor").getEditedPostAttribute("meta")||{};(0,r.subscribe)(()=>{if(a)return;const t=(0,r.select)("core/editor").getEditedPostAttribute("meta")||{},e=t.design_slug,i=!b;if(b&&setTimeout(()=>{b=!1},2e3),e!==v)return v=e,void(i?l(g,"Design slug changed via autosave, skipping preview update"):(l(g,`Design slug changed to: ${e}`),f()));JSON.stringify(t)!==JSON.stringify(y)&&(y={...t},i?l(g,"Custom fields changed via autosave, skipping preview update"):(l(g,"Custom fields changed, updating preview"),f()))})})})();