(()=>{"use strict";const e=window.wp.data,t=window.wp.plugins,s=window.wp.editor,n=window.wp.components,r={degsteps:60,startsat:100,startbri:100,startdeg:0,gradsteps:10,paletlim:[0,360]},i=new class{constructor(e,t,s,n,i,a){this.startdeg=null!=n?n:r.startdeg,this.degsteps=null!=e?e:r.degsteps,this.startsat=null!=t?t:r.startsat,this.startbri=null!=s?s:r.startbri,this.gradsteps=i&&i>1?i:r.gradsteps,this.paletlim=null!=a?a:r.paletlim,this.calls=0,this.color=null,this.deg=0,this.cyc=0,this.bri=100,this.sat=100,this.opa=1}new(e,t){return this.color=this._generateColor(e,t),this.string=this.color.string,this.values=this.color.values,this.contra=this.color.contra,this.hex=this._rgbToHex(this.color.values),this.calls++,this}adjust(e){var t,s,n,r;const i=null!==(t=e.deg)&&void 0!==t?t:0,a=null!==(s=e.sat)&&void 0!==s?s:this.sat,o=null!==(n=e.bri)&&void 0!==n?n:this.bri,l=null!==(r=e.opa)&&void 0!==r?r:this.opa,d=(this.deg+i)%this.paletlim[1],c=this._clamp(o<=1&&o>0?this.bri*o:o,0,100),p=this._clamp(a<=1&&a>0?this.sat*a:a,0,100),h=this._clamp(l,0,1);return this._hsvToRgb(d,p,c,h)}_generateColor(e,t){let s=!1;if("string"==typeof e)if("#"===e[0]){const t=this._hslToHsv(this._hexToHsl(e));this.deg=t[0],this.sat=t[1],this.bri=t[2],s=!0}else this.deg=this._stringToDegrees(e);else this.startdeg=Math.max(this.startdeg,this.paletlim[0]),this.deg=this.startdeg+this.calls*this.degsteps;if(this.cyc=Math.floor(this.deg/this.paletlim[1]),!s&&(this.bri=e&&e>0?e:this.startbri,this.sat=t&&t>0?t:this.startsat,this.bri=Math.abs(this.bri%101),this.sat=Math.abs(this.sat%101),this.deg=this.deg%(this.paletlim[1]+1),this.deg=Math.max(this.deg,this.paletlim[0]),this.paletlim[0]%this.degsteps===0&&this.cyc>0)){const t=this.cyc*this.gradsteps;this.bri=e&&e>0?e:this.startbri-t,t>=100&&(this.cyc=0,this.gradsteps=this.gradsteps/2)}return this._hsvToRgb(this.deg,this.sat,this.bri)}_stringToDegrees(e){const t=[...e].reduce((e,t)=>t.charCodeAt(0)+((e<<5)-e),0);return Math.abs(t)%360}_hsvToRgb(e,t,s,n){e/=360,t/=100,s/=100,n=void 0!==n?parseFloat(n):void 0;const r=Math.floor(6*e),i=6*e-r,a=s*(1-t),o=s*(1-i*t),l=s*(1-(1-i)*t);let d,c,p;switch(r%6){case 0:d=s,c=l,p=a;break;case 1:d=o,c=s,p=a;break;case 2:d=a,c=s,p=l;break;case 3:d=a,c=o,p=s;break;case 4:d=l,c=a,p=s;break;case 5:d=s,c=a,p=o}const h=[Math.round(255*d),Math.round(255*c),Math.round(255*p)],g=void 0!==n?"rgba":"rgb";return void 0!==n&&h.push(n),{values:h,string:`${g}(${h.join(",")})`,hex:this._rgbToHex(h),contra:this._textContrast(h)}}_hexToHsl(e){const t=this._hexToRgb(e),s=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.min(s,n,r),a=Math.max(s,n,r),o=a-i;let l=0;0!==o&&(l=a===s?(n-r)/o%6:a===n?(r-s)/o+2:(s-n)/o+4),l=Math.round(60*l),l<0&&(l+=360);const d=(a+i)/2;return[l,+(100*(0===o?0:o/(1-Math.abs(2*d-1)))).toFixed(1),+(100*d).toFixed(1)]}_hslToHsv(e){const t=e[1]*(e[2]<50?e[2]:100-e[2])/100,s=0===t?0:2*t/(e[2]+t)*100,n=e[2]+t;return[e[0],s,n]}_hexToRgb(e){return e.match(/\w\w/g).map(e=>+`0x${e}`)}_rgbToHex(e){return"#"+e.slice(0,3).map(e=>e.toString(16).padStart(2,"0")).join("")}_textContrast(e){return Math.round((299*parseInt(e[0])+587*parseInt(e[1])+114*parseInt(e[2]))/1e3)>125?"rgb(0,0,0)":"rgb(255,255,255)"}_clamp(e,t,s){return Math.min(Math.max(e,t),s)}},a=window.location.search.includes("debug=true"),o="font-family: Lucida Grande,Lucida Sans Unicode,Lucida Sans,Geneva,Verdana,sans-serif",l=new Map,d={log:"black",info:"#1e529e",warn:"#fd7e14",error:"red"};function c(e,t=!1){const s=`${e}:${t}`;if(l.has(s))return l.get(s);const n=i.new(e),r=`${o};padding:3px 5px;border-radius:6px;`,a=t?r+"color: #339;border: 1px solid #339B;background-color: #FFF8;margin-right:2px;":r+`color:${n.contra};border: 1px solid transparent;`+`background-color:${n.string};margin-right:10px;`+`background-image:linear-gradient(0deg,${n.adjust({deg:10}).string} 0%,${n.adjust({opa:1}).string} 100%);`;return l.set(s,a),a}function p(e,t,s){if(!a)return;const n=console[e]||console.log,r=`${o};color:${d[e]};`,i=t.match(/^(core|util)\.(.+)/);if(i){const e=i[1],a=i[2],o=c(e,!0),l=c(t,!1);"object"==typeof s&&null!==s?n(`%c${e}%c${a}`,o,l,s):n(`%c${e}%c${a}%c ${s}`,o,l,r)}else{const e=c(t,!1);"object"==typeof s&&null!==s?n(`%c${t}`,e,s):n(`%c${t}%c ${s}`,e,r)}}const h={log(e,t){p("log",e,t)},info(e,t){p("info",e,t)},warn(e,t){p("warn",e,t)},error(e,t){p("error",e,t)}},g=window.wp.element,u=window.ReactJSXRuntime,x=({value:e,onChange:t,icons:s})=>{const[n,r]=(0,g.useState)(!1),[i,a]=(0,g.useState)(""),o=Object.entries(s).flatMap(e=>Object.entries(e[1]).map(t=>({name:t[0],svg:t[1],category:e[0]}))),l=o.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())),d=o.find(t=>t.name===e);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("style",{children:"\n        svg.nok-icon {\n            width: 100%;\n            height: 100%;\n            display: block;\n        }\n    "}),(0,u.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"12px",fontWeight:"600",marginBottom:"8px"},children:"Icon"}),(0,u.jsxs)("div",{style:{position:"relative"},children:[(0,u.jsx)("div",{onClick:()=>r(!n),style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#fff",minHeight:"40px"},children:d?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{style:{width:"24px",height:"24px",flexShrink:0},dangerouslySetInnerHTML:{__html:d.svg}}),(0,u.jsx)("span",{style:{fontSize:"13px"},children:d.name})]}):(0,u.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:"Select an icon..."})}),d&&(0,u.jsx)("button",{onClick:e=>{e.stopPropagation(),t("")},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#d63638",color:"#fff",border:"none",borderRadius:"3px",padding:"4px 8px",fontSize:"11px",cursor:"pointer",fontWeight:"500"},title:"Clear icon",children:"×"})]}),n&&(0,u.jsxs)("div",{style:{position:"absolute",zIndex:9999,background:"#fff",border:"1px solid #ddd",borderRadius:"4px",marginTop:"4px",maxHeight:"400px",width:"300px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",overflow:"hidden"},children:[(0,u.jsx)("input",{type:"text",placeholder:"Search icons...",value:i,onChange:e=>a(e.target.value),style:{width:"100%",padding:"8px",border:"none",borderBottom:"1px solid #ddd",fontSize:"13px",outline:"none"}}),(0,u.jsx)("div",{style:{overflowY:"auto",maxHeight:"350px",padding:"8px"},children:0===l.length?(0,u.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"},children:"No icons found"}):(0,u.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:l.map(s=>(0,u.jsx)("div",{onClick:()=>{t(s.name),r(!1),a("")},title:s.name,style:{padding:"2px",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",background:e===s.name?"#e0f0ff":"#fff",transition:"all 0.15s",aspectRatio:"1"},onMouseEnter:t=>{e!==s.name&&(t.currentTarget.style.background="#f5f5f5")},onMouseLeave:t=>{e!==s.name&&(t.currentTarget.style.background="#fff")},children:(0,u.jsx)("div",{style:{width:"3em",height:"3em"},dangerouslySetInnerHTML:{__html:s.svg}})},s.name))})})]})]})]})},m="nok-page-part-design-selector",f={width:"100%",borderBottom:"1px solid #ddd",borderRadius:"3px",fontSize:"13px",margin:"0",padding:"16px 0"},b={margin:"8px 0 8px 0",fontSize:"12px",color:"#757575",fontStyle:"italic",lineHeight:"1.4"},y=({label:e,children:t})=>(0,u.jsxs)("div",{style:{marginBottom:"16px"},children:[e&&(0,u.jsx)("div",{style:{marginBottom:"8px",fontSize:"11px",fontWeight:"600",textTransform:"uppercase",color:"#1e1e1e"},children:e}),t]}),j=({value:e,onChange:t,postTypes:s=["post"],categories:n=[]})=>{const[r,i]=(0,g.useState)([]),[a,o]=(0,g.useState)([]),[l,d]=(0,g.useState)(!1),[c,p]=(0,g.useState)(""),h=(0,g.useMemo)(()=>{try{return JSON.parse(e||"[]")}catch{return[]}},[e]);return(0,g.useEffect)(()=>{(async()=>{if(0!==h.length)try{const e=new URLSearchParams({include:h.join(",")}),t=await fetch(`/wp-json/nok-2025-v1/v1/posts/query?${e}`),s=await t.json();o(s)}catch(e){console.error("Failed to fetch selected posts:",e)}else o([])})()},[h.join(",")]),(0,g.useEffect)(()=>{(async()=>{d(!0);try{const e=new URLSearchParams({post_type:s.join(","),exclude:h.join(","),search:c});n.length>0&&e.append("categories",n.join(","));const t=await fetch(`/wp-json/nok-2025-v1/v1/posts/query?${e}`),r=await t.json();i(r)}catch(e){console.error("Failed to fetch posts:",e)}d(!1)})()},[h.join(","),c,s.join(","),n.join(",")]),(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{marginBottom:"8px"},children:(0,u.jsx)("input",{type:"text",placeholder:"Search posts...",value:c,onChange:e=>p(e.target.value),style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px"}})}),a.length>0&&(0,u.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,u.jsx)("strong",{children:"Selected:"}),a.map(e=>(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 8px",background:"#f0f0f0",marginTop:"4px",borderRadius:"3px"},children:[(0,u.jsx)("span",{children:e.title}),(0,u.jsx)("button",{type:"button",onClick:()=>(e=>{const s=h.filter(t=>t!==e);o(a.filter(t=>t.id!==e)),t(JSON.stringify(s))})(e.id),style:{background:"none",border:"none",color:"#cc0000",cursor:"pointer",padding:"0 4px"},children:"×"})]},e.id))]}),(0,u.jsx)("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"3px"},children:l?(0,u.jsx)("div",{style:{padding:"8px",textAlign:"center"},children:"Loading..."}):0===r.length?(0,u.jsx)("div",{style:{padding:"8px",textAlign:"center",color:"#666"},children:c?"No posts found":"All posts selected"}):r.map(e=>(0,u.jsxs)("div",{onClick:()=>(e=>{const s=[...h,e.id];o([...a,e]),t(JSON.stringify(s))})(e),style:{padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"},onMouseEnter:e=>e.target.style.background="#f9f9f9",onMouseLeave:e=>e.target.style.background="transparent",children:[(0,u.jsx)("div",{style:{fontWeight:"500"},children:e.title}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#666"},children:[e.type," • ",e.date]})]},e.id))})]})},v=({field:e,schema:t,value:s,onChange:n})=>{const[r,i]=(0,g.useState)(()=>{try{return JSON.parse(s||"[]")}catch{return[]}}),[a,o]=(0,g.useState)(null),l=()=>{const e={_id:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return t.forEach(t=>{e[t.name]=""}),e},d=e=>{i(e),n(JSON.stringify(e))},c=(e,t,s)=>{const n=[...r];n[e]={...n[e],[t]:s},d(n)},p=e=>{e.currentTarget.style.opacity="1",o(null)},h=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"};return(0,u.jsxs)(u.Fragment,{children:[r.map((s,n)=>(0,u.jsxs)("div",{draggable:!0,onDragStart:e=>((e,t)=>{o(t),e.dataTransfer.effectAllowed="move",e.currentTarget.style.opacity="0.5"})(e,n),onDragEnd:p,onDragOver:h,onDrop:e=>((e,t)=>{e.preventDefault(),null!==a&&a!==t&&((e,t)=>{const s=[...r],[n]=s.splice(e,1);s.splice(t,0,n),d(s)})(a,t)})(e,n),style:{background:a===n?"#f0f0f0":"#f8f9fa",border:"1px solid #ddd",borderRadius:"4px",padding:"12px",marginBottom:"8px",position:"relative",cursor:"move",transition:"background 0.2s"},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,u.jsxs)("span",{style:{fontSize:"11px",fontWeight:"600",color:"#555",userSelect:"none"},children:["⋮⋮ Item ",n+1]}),(0,u.jsx)("button",{type:"button",onClick:()=>(e=>{const t=r.filter((t,s)=>s!==e);d(t)})(n),style:{background:"#dc3232",color:"white",border:"none",padding:"4px 8px",borderRadius:"3px",cursor:"pointer",fontSize:"11px"},children:"Verwijder"})]}),t.map(t=>((t,s,n)=>{const r=t.name,i=s[r]||"",a=t.name.charAt(0).toUpperCase()+t.name.slice(1).replace(/_/g," ");switch(t.type){case"icon-selector":const s=window.PagePartDesignSettings?.icons||{};return(0,u.jsxs)(y,{label:t.label||a,children:[(0,u.jsx)(x,{value:i,icons:s,onChange:t=>updateMetaField(e.meta_key,t)}),e.description&&(0,u.jsx)("p",{style:b,children:e.description})]},r);case"textarea":return(0,u.jsx)(y,{label:t.label||a,children:(0,u.jsx)("textarea",{value:i,onChange:e=>c(n,r,e.target.value),rows:3,style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})},r);case"url":return(0,u.jsx)(y,{label:t.label||a,children:(0,u.jsx)("input",{type:"url",value:i,onChange:e=>c(n,r,e.target.value),placeholder:"https://...",style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})},r);default:return(0,u.jsx)(y,{label:t.label||a,children:(0,u.jsx)("input",{type:"text",value:i,onChange:e=>c(n,r,e.target.value),style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})},r)}})(t,s,n))]},s._id||n)),(0,u.jsx)("button",{type:"button",onClick:()=>{const e=[...r,l()];d(e)},style:{background:"#0073aa",color:"white",border:"none",padding:"6px 12px",borderRadius:"3px",cursor:"pointer",fontSize:"12px"},children:"Add Item"})]})};(0,t.registerPlugin)("page-part-design",{render:function(){if("page_part"!==(0,e.useSelect)(e=>e("core/editor").getCurrentPostType(),[]))return null;const t=(0,e.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),r=(0,e.useSelect)(e=>e("core/editor").getEditedPostAttribute("meta"),[]),{editPost:i}=(0,e.useDispatch)("core/editor"),a=window.PagePartDesignSettings?.registry||{},o=[{label:"— Select —",value:""},...Object.entries(a).map(([e,t])=>({label:t.name,value:e}))],l=r?.design_slug||"",d=(a[l]||{}).custom_fields||[],[c,p]=(0,g.useState)({}),[_,w]=(0,g.useState)(!1),k=(0,g.useRef)({});(0,g.useEffect)(()=>{if(r&&d.length>0){const e={};d.forEach(t=>{const s=r[t.meta_key],n=void 0!==s&&""!==s?s:t.default||"";e[t.meta_key]=n}),p(e),_||setTimeout(()=>w(!0),1e3)}},[l,r?.design_slug]);const S=(e,t)=>{_?(p(s=>({...s,[e]:t})),k.current[e]&&clearTimeout(k.current[e]),k.current[e]=setTimeout(()=>{h.log(m,`Debounced update for ${e}: ${t}`);const s={...r,[e]:t};i({meta:s}),delete k.current[e]},500)):h.log(m,`Skipping update during initialization for ${e}`)};function C(e,s=!1){const n=[];for(const t in r)/^[a-z0-9-]+_[a-z0-9_]+$/.test(t)&&"design_slug"!==t&&(s&&t.startsWith(e+"_")?h.log(m,`Will not remove ${t}`):(n.push(t),h.warn(m,`Will remove ${t}`)));0!==n.length&&wp.apiFetch({path:`/nok/v1/page-part/${t}/prune-fields`,method:"POST",data:{retain_current:s}}).then(()=>{h.log(m,`Deleted ${n.length} field(s)`);const e={...r};n.forEach(t=>delete e[t]),i({meta:e})})}return(0,u.jsxs)(s.PluginDocumentSettingPanel,{name:"page-part-design",title:"NOK Design template",icon:"admin-generic",children:[(0,u.jsx)(n.SelectControl,{label:"Template",value:l,options:o,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:e=>{h.log(m,`→ setting design_slug to "${e}"`);const t={...r,design_slug:e};i({meta:t})}}),d.length>0&&(0,u.jsxs)(g.Fragment,{children:[(0,u.jsx)("hr",{style:{margin:"16px 0"}}),(0,u.jsx)("h2",{style:f,children:"Template options"}),d.map(e=>{var t,s;const i=null!==(t=null!==(s=c[e.meta_key])&&void 0!==s?s:r?.[e.meta_key])&&void 0!==t?t:"";switch(e.type){case"textarea":return(0,u.jsxs)(y,{label:e.label,children:[(0,u.jsx)(n.TextareaControl,{value:i,onChange:t=>S(e.meta_key,t),rows:3}),e.description&&(0,u.jsx)("p",{style:helpStylehelpStyle,children:e.description})]},e.meta_key);case"url":return(0,u.jsx)(y,{label:e.label,children:(0,u.jsx)(n.TextControl,{type:"url",value:i,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:t=>S(e.meta_key,t),placeholder:"https://..."})},e.meta_key);case"repeater":return"post"===e.repeater_subtype?(0,u.jsxs)(y,{label:e.label,children:[e.description&&(0,u.jsx)("p",{style:b,children:e.description}),(0,u.jsx)(j,{value:i,onChange:t=>S(e.meta_key,t),postTypes:e.post_types||["post"],categories:e.categories||[]})]},e.meta_key):e.schema&&0!==e.schema.length?(0,u.jsxs)(y,{label:e.label,children:[e.description&&(0,u.jsx)("p",{style:b,children:e.description}),(0,u.jsx)(v,{field:e,schema:e.schema,value:i,onChange:t=>S(e.meta_key,t)})]},e.meta_key):(0,u.jsxs)("div",{style:{padding:"8px",background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",marginBottom:"16px"},children:[(0,u.jsx)("strong",{children:"Warning:"}),' Repeater field "',e.label,'" has no schema defined.']},e.meta_key);case"icon-selector":const t=window.PagePartDesignSettings?.icons||{};return(0,u.jsx)(y,{label:e.label,children:(0,u.jsx)(x,{value:i,icons:t,onChange:t=>S(e.meta_key,t)})},e.meta_key);case"select":const s=e.options||[],r=e.option_labels||s,a=e.default&&""!==e.default?s.map((e,t)=>({label:r[t]||e,value:e})):[{label:"— Select —",value:""},...s.map((e,t)=>({label:r[t]||e,value:e}))];return(0,u.jsxs)(y,{label:e.label,children:[(0,u.jsx)(n.SelectControl,{value:i,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,options:a,onChange:t=>S(e.meta_key,t)},e.meta_key),e.description&&(0,u.jsx)("p",{style:b,children:e.description})]},e.meta_key);case"checkbox":return(0,u.jsx)(y,{children:(0,u.jsx)(n.CheckboxControl,{label:e.label,help:e.description||"",checked:"1"===i||!0===i,onChange:t=>S(e.meta_key,t?"1":"0")},e.meta_key)},e.meta_key);default:return(0,u.jsxs)(y,{label:e.label,children:[(0,u.jsx)(n.TextControl,{value:i,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:t=>S(e.meta_key,t)},e.meta_key),e.description&&(0,u.jsx)("p",{style:b,children:e.description})]},e.meta_key)}})]}),d.length>0&&(0,u.jsxs)(g.Fragment,{children:[(0,u.jsx)("hr",{style:{margin:"16px 0"}}),(0,u.jsx)(n.Button,{isDestructive:!0,variant:"secondary",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onClick:()=>{confirm("Wil je alle velden die niet langer door de huidige template worden gebruikt verwijderen?")&&(h.log(m,"Pruning unused template fields"),C(!0))},style:{width:"100%",justifyContent:"center",marginBottom:"16px"},children:"Reset ongebruikt"}),(0,u.jsx)(n.Button,{isDestructive:!0,variant:"secondary",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onClick:()=>{confirm("Wil je de velden voor ALLE templates voor deze page part terugzetten naar de standaardwaarden?")&&(h.log(m,"Resetting template fields to defaults"),C())},style:{width:"100%",justifyContent:"center",marginBottom:"16px"},children:"Reset opties"})]})]})}})})();