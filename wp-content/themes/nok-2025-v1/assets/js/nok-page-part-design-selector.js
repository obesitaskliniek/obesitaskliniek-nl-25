(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.data,n=window.wp.plugins,r=window.wp.editor,s=window.wp.components,i=window.wp.apiFetch;var a=e.n(i);const o={degsteps:60,startsat:100,startbri:100,startdeg:0,gradsteps:10,paletlim:[0,360]},l=new class{constructor(e,t,n,r,s,i){this.startdeg=null!=r?r:o.startdeg,this.degsteps=null!=e?e:o.degsteps,this.startsat=null!=t?t:o.startsat,this.startbri=null!=n?n:o.startbri,this.gradsteps=s&&s>1?s:o.gradsteps,this.paletlim=null!=i?i:o.paletlim,this.calls=0,this.color=null,this.deg=0,this.cyc=0,this.bri=100,this.sat=100,this.opa=1}new(e,t){return this.color=this._generateColor(e,t),this.string=this.color.string,this.values=this.color.values,this.contra=this.color.contra,this.hex=this._rgbToHex(this.color.values),this.calls++,this}adjust(e){var t,n,r,s;const i=null!==(t=e.deg)&&void 0!==t?t:0,a=null!==(n=e.sat)&&void 0!==n?n:this.sat,o=null!==(r=e.bri)&&void 0!==r?r:this.bri,l=null!==(s=e.opa)&&void 0!==s?s:this.opa,d=(this.deg+i)%this.paletlim[1],c=this._clamp(o<=1&&o>0?this.bri*o:o,0,100),p=this._clamp(a<=1&&a>0?this.sat*a:a,0,100),h=this._clamp(l,0,1);return this._hsvToRgb(d,p,c,h)}_generateColor(e,t){let n=!1;if("string"==typeof e)if("#"===e[0]){const t=this._hslToHsv(this._hexToHsl(e));this.deg=t[0],this.sat=t[1],this.bri=t[2],n=!0}else this.deg=this._stringToDegrees(e);else this.startdeg=Math.max(this.startdeg,this.paletlim[0]),this.deg=this.startdeg+this.calls*this.degsteps;if(this.cyc=Math.floor(this.deg/this.paletlim[1]),!n&&(this.bri=e&&e>0?e:this.startbri,this.sat=t&&t>0?t:this.startsat,this.bri=Math.abs(this.bri%101),this.sat=Math.abs(this.sat%101),this.deg=this.deg%(this.paletlim[1]+1),this.deg=Math.max(this.deg,this.paletlim[0]),this.paletlim[0]%this.degsteps===0&&this.cyc>0)){const t=this.cyc*this.gradsteps;this.bri=e&&e>0?e:this.startbri-t,t>=100&&(this.cyc=0,this.gradsteps=this.gradsteps/2)}return this._hsvToRgb(this.deg,this.sat,this.bri)}_stringToDegrees(e){const t=[...e].reduce((e,t)=>t.charCodeAt(0)+((e<<5)-e),0);return Math.abs(t)%360}_hsvToRgb(e,t,n,r){e/=360,t/=100,n/=100,r=void 0!==r?parseFloat(r):void 0;const s=Math.floor(6*e),i=6*e-s,a=n*(1-t),o=n*(1-i*t),l=n*(1-(1-i)*t);let d,c,p;switch(s%6){case 0:d=n,c=l,p=a;break;case 1:d=o,c=n,p=a;break;case 2:d=a,c=n,p=l;break;case 3:d=a,c=o,p=n;break;case 4:d=l,c=a,p=n;break;case 5:d=n,c=a,p=o}const h=[Math.round(255*d),Math.round(255*c),Math.round(255*p)],u=void 0!==r?"rgba":"rgb";return void 0!==r&&h.push(r),{values:h,string:`${u}(${h.join(",")})`,hex:this._rgbToHex(h),contra:this._textContrast(h)}}_hexToHsl(e){const t=this._hexToRgb(e),n=t[0]/255,r=t[1]/255,s=t[2]/255,i=Math.min(n,r,s),a=Math.max(n,r,s),o=a-i;let l=0;0!==o&&(l=a===n?(r-s)/o%6:a===r?(s-n)/o+2:(n-r)/o+4),l=Math.round(60*l),l<0&&(l+=360);const d=(a+i)/2;return[l,+(100*(0===o?0:o/(1-Math.abs(2*d-1)))).toFixed(1),+(100*d).toFixed(1)]}_hslToHsv(e){const t=e[1]*(e[2]<50?e[2]:100-e[2])/100,n=0===t?0:2*t/(e[2]+t)*100,r=e[2]+t;return[e[0],n,r]}_hexToRgb(e){return e.match(/\w\w/g).map(e=>+`0x${e}`)}_rgbToHex(e){return"#"+e.slice(0,3).map(e=>e.toString(16).padStart(2,"0")).join("")}_textContrast(e){return Math.round((299*parseInt(e[0])+587*parseInt(e[1])+114*parseInt(e[2]))/1e3)>125?"rgb(0,0,0)":"rgb(255,255,255)"}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}},d=function(){if("undefined"==typeof window)return!1;try{return"true"===new URLSearchParams(window.location.search).get("debug")}catch{return window.location.search.includes("debug=true")}}(),c="font-family: Lucida Grande,Lucida Sans Unicode,Lucida Sans,Geneva,Verdana,sans-serif",p=new Map,h={log:"black",info:"#1e529e",warn:"#fd7e14",error:"red"};function u(e,t=!1){const n=`${e}:${t}`;if(p.has(n))return p.get(n);const r=l.new(e),s=`${c};padding:3px 5px;border-radius:6px;`,i=t?s+"color: #339;border: 1px solid #339B;background-color: #FFF8;margin-right:2px;":s+`color:${r.contra};border: 1px solid transparent;`+`background-color:${r.string};margin-right:10px;`+`background-image:linear-gradient(0deg,${r.adjust({deg:10}).string} 0%,${r.adjust({opa:1}).string} 100%);`;return p.set(n,i),i}function g(e,t,n){if(!d)return;const r=console[e]||console.log,s=`${c};color:${h[e]};`,i=t.match(/^(core|util)\.(.+)/);if(i){const e=i[1],a=i[2],o=u(e,!0),l=u(t,!1);"object"==typeof n&&null!==n?r(`%c${e}%c${a}`,o,l,n):r(`%c${e}%c${a}%c ${n}`,o,l,s)}else{const e=u(t,!1);"object"==typeof n&&null!==n?r(`%c${t}`,e,n):r(`%c${t}%c ${n}`,e,s)}}const x={log(e,t){g("log",e,t)},info(e,t){g("info",e,t)},warn(e,t){g("warn",e,t)},error(e,t){g("error",e,t)}},m=window.wp.element,f=window.ReactJSXRuntime,y=({value:e,onChange:t,icons:n})=>{const[r,i]=(0,m.useState)(!1),[a,o]=(0,m.useState)(""),l=(0,m.useRef)(null),d=Object.entries(n).flatMap(e=>Object.entries(e[1]).map(t=>({name:t[0],svg:t[1],category:e[0]}))),c=d.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())),p=d.find(t=>t.name===e);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("style",{children:"\n        svg.nok-icon {\n            width: 100%;\n            height: 100%;\n            display: block;\n        }\n    "}),(0,f.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,f.jsx)("label",{style:{display:"block",fontSize:"12px",fontWeight:"600",marginBottom:"8px"},children:"Icon"}),(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("div",{ref:l,onClick:()=>i(!r),style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#fff",minHeight:"40px"},children:p?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{width:"24px",height:"24px",flexShrink:0},dangerouslySetInnerHTML:{__html:p.svg}}),(0,f.jsx)("span",{style:{fontSize:"13px"},children:p.name})]}):(0,f.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:"Select an icon..."})}),p&&(0,f.jsx)("button",{onClick:e=>{e.stopPropagation(),t("")},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#d63638",color:"#fff",border:"none",borderRadius:"3px",padding:"4px 8px",fontSize:"11px",cursor:"pointer",fontWeight:"500"},title:"Clear icon",children:"×"})]}),r&&(0,f.jsx)(s.Popover,{anchor:l.current,onClose:()=>{i(!1),o("")},placement:"bottom-start",shift:!0,resize:!0,children:(0,f.jsxs)("div",{style:{background:"#fff",maxHeight:"400px",width:"280px",overflow:"hidden"},children:[(0,f.jsx)("input",{type:"text",placeholder:"Search icons...",value:a,onChange:e=>o(e.target.value),style:{width:"100%",padding:"8px",border:"none",borderBottom:"1px solid #ddd",fontSize:"13px",outline:"none",boxSizing:"border-box"},autoFocus:!0}),(0,f.jsx)("div",{style:{overflowY:"auto",maxHeight:"350px",padding:"8px"},children:0===c.length?(0,f.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"},children:"No icons found"}):(0,f.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:c.map(n=>(0,f.jsx)("div",{onClick:()=>{t(n.name),i(!1),o("")},title:n.name,style:{padding:"2px",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",background:e===n.name?"#e0f0ff":"#fff",transition:"all 0.15s",aspectRatio:"1"},onMouseEnter:t=>{e!==n.name&&(t.currentTarget.style.background="#f5f5f5")},onMouseLeave:t=>{e!==n.name&&(t.currentTarget.style.background="#fff")},children:(0,f.jsx)("div",{style:{width:"3em",height:"3em"},dangerouslySetInnerHTML:{__html:n.svg}})},n.name))})})]})})]})]})},b=({taxonomy:e,value:t,onChange:n,multiple:r=!0,label:i})=>{const[o,l]=(0,m.useState)([]),[d,c]=(0,m.useState)(!0),p=t?t.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)):[];return(0,m.useEffect)(()=>{c(!0),a()({path:`/wp/v2/${e}?per_page=100&orderby=name&order=asc`}).then(e=>{l(e),c(!1)}).catch(e=>{console.error("Failed to fetch taxonomy terms:",e),c(!1)})},[e]),d?(0,f.jsx)("p",{style:{fontSize:"12px",color:"#666"},children:"Categorieën laden..."}):0===o.length?(0,f.jsx)("p",{style:{fontSize:"12px",color:"#666"},children:"Geen categorieën gevonden."}):(0,f.jsxs)("div",{style:{marginBottom:"12px"},children:[i&&(0,f.jsx)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"8px",color:"#1e1e1e"},children:i}),(0,f.jsx)("p",{style:{fontSize:"11px",color:"#666",marginBottom:"8px"},children:0===p.length?"Alle categorieën (geen filter)":`${p.length} categorie${1!==p.length?"ën":""} geselecteerd`}),(0,f.jsx)("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",padding:"8px",backgroundColor:"#fff"},children:o.map(e=>(0,f.jsx)(s.CheckboxControl,{label:e.name,checked:p.includes(e.id),onChange:t=>((e,t)=>{let s;s=r?t?[...p,e]:p.filter(t=>t!==e):t?[e]:[],n(s.length>0?s.join(","):"")})(e.id,t),__nextHasNoMarginBottom:!0},e.id))}),p.length>0&&(0,f.jsx)(s.Button,{variant:"link",isDestructive:!0,onClick:()=>n(""),style:{marginTop:"8px",fontSize:"12px"},children:"Selectie wissen (alle tonen)"})]})},v=({value:e,onChange:t,palette:n})=>{const[r,i]=(0,m.useState)(!1),[a,o]=(0,m.useState)(""),l=(0,m.useRef)(null),d=(window.PagePartDesignSettings?.colorPalettes||{})[n]||[],c=d.filter(e=>e.label.toLowerCase().includes(a.toLowerCase())),p=d.find(t=>t.value===e),h=(e,t="24px")=>{const n=!e||"transparent"===e||"inherit"===e;return(0,f.jsx)("div",{style:{width:t,height:t,borderRadius:"4px",border:"1px solid #ccc",flexShrink:0,background:n?"repeating-linear-gradient(45deg, #fff, #fff 4px, #eee 4px, #eee 8px)":e,boxShadow:"inset 0 0 0 1px rgba(0,0,0,0.1)"}})};return(0,f.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("div",{ref:l,onClick:()=>i(!r),style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#fff",minHeight:"40px"},children:p?(0,f.jsxs)(f.Fragment,{children:[h(p.color),(0,f.jsx)("span",{style:{fontSize:"13px"},children:p.label})]}):e?(0,f.jsxs)(f.Fragment,{children:[h(null),(0,f.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:e})]}):(0,f.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:"Selecteer kleur..."})}),p&&(0,f.jsx)("button",{onClick:e=>{e.stopPropagation(),t("")},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#d63638",color:"#fff",border:"none",borderRadius:"3px",padding:"4px 8px",fontSize:"11px",cursor:"pointer",fontWeight:"500"},title:"Wis selectie",children:"×"})]}),r&&(0,f.jsx)(s.Popover,{anchor:l.current,onClose:()=>{i(!1),o("")},placement:"bottom-start",shift:!0,resize:!0,children:(0,f.jsxs)("div",{style:{background:"#fff",maxHeight:"400px",width:"280px",overflow:"hidden"},children:[(0,f.jsx)("input",{type:"text",placeholder:"Zoek kleur...",value:a,onChange:e=>o(e.target.value),style:{width:"100%",padding:"8px",border:"none",borderBottom:"1px solid #ddd",fontSize:"13px",outline:"none",boxSizing:"border-box"},autoFocus:!0}),(0,f.jsx)("div",{style:{overflowY:"auto",maxHeight:"350px",padding:"8px"},children:0===c.length?(0,f.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"},children:"Geen kleuren gevonden"}):(0,f.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:c.map(n=>(0,f.jsxs)("div",{onClick:()=>{t(n.value),i(!1),o("")},title:n.label,style:{padding:"4px",border:e===n.value?"2px solid #007cba":"1px solid #ddd",borderRadius:"4px",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",background:e===n.value?"#e0f0ff":"#fff",transition:"all 0.15s",minHeight:"50px"},onMouseEnter:t=>{e!==n.value&&(t.currentTarget.style.background="#f5f5f5")},onMouseLeave:t=>{e!==n.value&&(t.currentTarget.style.background="#fff")},children:[h(n.color,"32px"),(0,f.jsx)("span",{style:{fontSize:"10px",textAlign:"center",lineHeight:"1.2",color:"#333",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.label})]},n.value||"empty"))})})]})})]})},j={text:["text","textarea","url"],textarea:["textarea","text"],url:["url","text"],select:["select","text"],checkbox:["checkbox"],"icon-selector":["icon-selector","text"],repeater:["repeater"]},k=(e,t)=>{var n;return null!==(n=j[e]?.includes(t))&&void 0!==n&&n},_=({isOpen:e,onClose:t,postId:n,currentTemplate:r,targetFields:i,onImport:o})=>{const[l,d]=(0,m.useState)(!0),[c,p]=(0,m.useState)([]),[h,u]=(0,m.useState)(""),[g,x]=(0,m.useState)({}),[y,b]=(0,m.useState)({});(0,m.useEffect)(()=>{e&&(d(!0),a()({path:`/nok/v1/page-part/${n}/orphaned-fields?current_template=${r}`}).then(e=>{p(e.sources||[]),1===e.sources?.length&&u(e.sources[0].template_slug),d(!1)}).catch(()=>{p([]),d(!1)}))},[e,n,r]),(0,m.useEffect)(()=>{if(!h)return x({}),void b({});const e=c.find(e=>e.template_slug===h);if(!e)return;const t={},n={};i.forEach(r=>{const s=((e,t,n)=>{const r=t.filter(e=>k(n,e.type)),s=r.find(t=>t.name===e);if(s)return s.meta_key;const i=r.find(t=>t.name.includes(e)||e.includes(t.name));return i?i.meta_key:""})(r.name,e.fields,r.type);if(t[r.meta_key]=s,"repeater"===r.type&&s){const t=e.fields.find(e=>e.meta_key===s);if(t?.schema&&r.schema){const e={};r.schema.forEach(n=>{const r=t.schema?.find(e=>e.name===n.name||e.name.includes(n.name)||n.name.includes(e.name));e[n.name]=r?.name||""}),n[r.meta_key]=e}}}),x(t),b(n)},[h,c,i]);const v=()=>c.find(e=>e.template_slug===h)?.fields||[];if(!e)return null;const j=c.find(e=>e.template_slug===h);return(0,f.jsx)(s.Modal,{title:"Import from previous template",onRequestClose:t,style:{maxWidth:"600px",width:"100%"},children:l?(0,f.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,f.jsx)(s.Spinner,{})}):0===c.length?(0,f.jsx)("p",{children:"No importable fields found from previous templates."}):(0,f.jsxs)("div",{children:[c.length>1&&(0,f.jsx)(s.SelectControl,{label:"Source template",value:h,options:[{label:"— Select template —",value:""},...c.map(e=>({label:`${e.template_name} (${e.fields.length} fields)`,value:e.template_slug}))],onChange:u,__nextHasNoMarginBottom:!0,style:{marginBottom:"16px"}}),h&&(0,f.jsxs)("div",{children:[(0,f.jsxs)("p",{style:{color:"#666",fontSize:"12px",marginBottom:"16px"},children:["Map fields from ",(0,f.jsx)("strong",{children:j?.template_name})," to current template."]}),(0,f.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{style:{borderBottom:"2px solid #ddd"},children:[(0,f.jsx)("th",{style:{textAlign:"left",padding:"8px",width:"40%"},children:"Target field"}),(0,f.jsx)("th",{style:{textAlign:"left",padding:"8px"},children:"Import from"})]})}),(0,f.jsx)("tbody",{children:i.map(e=>{const t=(n=e.type,v().filter(e=>k(n,e.type)));var n;const r="repeater"===e.type,i=(a=g[e.meta_key],v().find(e=>e.meta_key===a));var a;const o=r&&i?.schema&&g[e.meta_key];return(0,f.jsxs)(React.Fragment,{children:[(0,f.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,f.jsxs)("td",{style:{padding:"8px",verticalAlign:"top"},children:[(0,f.jsx)("strong",{children:e.label}),(0,f.jsx)("br",{}),(0,f.jsx)("span",{style:{fontSize:"11px",color:"#666"},children:e.type})]}),(0,f.jsx)("td",{style:{padding:"8px"},children:(0,f.jsx)(s.SelectControl,{value:g[e.meta_key]||"",options:[{label:"— Don't import —",value:""},...t.map(e=>({label:`${e.label||e.name} (${e.type})`,value:e.meta_key}))],onChange:t=>x(n=>({...n,[e.meta_key]:t})),__nextHasNoMarginBottom:!0})})]}),o&&(0,f.jsx)("tr",{children:(0,f.jsxs)("td",{colSpan:"2",style:{padding:"0 8px 8px 24px",background:"#f9f9f9"},children:[(0,f.jsxs)("div",{style:{fontSize:"11px",fontWeight:"600",margin:"8px 0",textTransform:"uppercase",color:"#666"},children:["Subfield mapping (",JSON.parse(i.value).length," items)"]}),(0,f.jsx)("table",{style:{width:"100%"},children:(0,f.jsx)("tbody",{children:e.schema.map(t=>(0,f.jsxs)("tr",{children:[(0,f.jsxs)("td",{style:{padding:"4px 8px",width:"40%"},children:[t.label||t.name,(0,f.jsxs)("span",{style:{fontSize:"10px",color:"#999",marginLeft:"4px"},children:["(",t.type,")"]})]}),(0,f.jsx)("td",{style:{padding:"4px 8px"},children:(0,f.jsx)(s.SelectControl,{value:y[e.meta_key]?.[t.name]||"",options:[{label:"— None —",value:""},...i.schema.map(e=>({label:e.label||e.name,value:e.name}))],onChange:n=>b(r=>({...r,[e.meta_key]:{...r[e.meta_key],[t.name]:n}})),__nextHasNoMarginBottom:!0})})]},t.name))})})]})},`${e.meta_key}-sub`)]},e.meta_key)})})]})]}),(0,f.jsxs)("div",{style:{marginTop:"24px",display:"flex",justifyContent:"flex-end",gap:"8px"},children:[(0,f.jsx)(s.Button,{variant:"tertiary",onClick:t,children:"Cancel"}),(0,f.jsx)(s.Button,{variant:"primary",onClick:()=>{const e=v(),n={};Object.entries(g).forEach(([t,r])=>{if(!r)return;const s=e.find(e=>e.meta_key===r),a=i.find(e=>e.meta_key===t);if(s&&a)if("repeater"===a.type&&"repeater"===s.type){const e=y[t]||{};try{const r=JSON.parse(s.value).map(t=>{const n={_id:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return a.schema.forEach(r=>{const s=e[r.name];n[r.name]=s&&t[s]||""}),n});n[t]=JSON.stringify(r)}catch(e){console.error("Failed to map repeater:",e)}}else n[t]=s.value}),o(n),t()},disabled:!h||Object.values(g).every(e=>!e),children:"Import"})]})]})})},w=window.wp.primitives;var S=(0,f.jsx)(w.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(w.Path,{d:"M17.031 4.703 15.576 4l-1.56 3H14v.03l-2.324 4.47H9.5V13h1.396l-1.502 2.889h-.95a3.694 3.694 0 0 1 0-7.389H10V7H8.444a5.194 5.194 0 1 0 0 10.389h.17L7.5 19.53l1.416.719L15.049 8.5h.507a3.694 3.694 0 0 1 0 7.39H14v1.5h1.556a5.194 5.194 0 0 0 .273-10.383l1.202-2.304Z"})});const C=[{slug:"kennisbank",title:"Kennisbank (archief)",type:"archive"},{slug:"voorlichting",title:"Voorlichtingen (archief)",type:"archive"},{slug:"vestiging",title:"Vestigingen (archief)",type:"archive"}],$=({value:e,onChange:t,placeholder:n="Search or enter URL..."})=>{const[r,i]=(0,m.useState)(""),[o,l]=(0,m.useState)([]),[d,c]=(0,m.useState)(!1),[p,h]=(0,m.useState)(!1),[u,g]=(0,m.useState)(null),x=(0,m.useRef)(null),y=(e=>e?e.startsWith("post:")?{type:"post",id:parseInt(e.replace("post:",""),10),slug:null,url:""}:e.startsWith("term:")?{type:"term",id:parseInt(e.replace("term:",""),10),slug:null,url:""}:e.startsWith("archive:")?{type:"archive",id:null,slug:e.replace("archive:",""),url:""}:{type:"url",id:null,slug:null,url:e}:{type:"none",id:null,slug:null,url:""})(e);(0,m.useEffect)(()=>{if("post"===y.type&&y.id)(async()=>{const e=[{path:`/wp/v2/posts/${y.id}`,type:"post"},{path:`/wp/v2/pages/${y.id}`,type:"page"},{path:`/wp/v2/kennisbank/${y.id}`,type:"kennisbank"},{path:`/wp/v2/voorlichting/${y.id}`,type:"voorlichting"},{path:`/wp/v2/vestigingen/${y.id}`,type:"vestiging"}];for(const t of e)try{const e=await a()({path:t.path});return void g({id:e.id,title:e.title.rendered,url:e.link,itemType:t.type})}catch(e){}g(null)})();else if("term"===y.type&&y.id)a()({path:`/wp/v2/categories/${y.id}`}).then(e=>g({id:e.id,title:e.name,url:e.link,itemType:"category"})).catch(()=>{a()({path:`/wp/v2/tags/${y.id}`}).then(e=>g({id:e.id,title:e.name,url:e.link,itemType:"tag"})).catch(()=>g(null))});else if("archive"===y.type&&y.slug){const e=C.find(e=>e.slug===y.slug);g(e?{id:null,title:e.title,url:null,itemType:"archive",slug:y.slug}:null)}else g(null),"url"===y.type&&i(y.url)},[e]);const b=(()=>{let e;return(...t)=>{clearTimeout(e),e=setTimeout(()=>(async e=>{if(!e||e.length<2)l([]);else{c(!0);try{const[t,n,r,s,i,o]=await Promise.all([a()({path:`/wp/v2/posts?search=${encodeURIComponent(e)}&per_page=5`}),a()({path:`/wp/v2/pages?search=${encodeURIComponent(e)}&per_page=5`}),a()({path:`/wp/v2/kennisbank?search=${encodeURIComponent(e)}&per_page=5`}).catch(()=>[]),a()({path:`/wp/v2/voorlichting?search=${encodeURIComponent(e)}&per_page=5`}).catch(()=>[]),a()({path:`/wp/v2/vestigingen?search=${encodeURIComponent(e)}&per_page=5`}).catch(()=>[]),a()({path:`/wp/v2/categories?search=${encodeURIComponent(e)}&per_page=5`})]),d=e.toLowerCase(),c=C.filter(e=>e.title.toLowerCase().includes(d)||e.slug.toLowerCase().includes(d)),p=[...t.map(e=>({id:e.id,title:e.title.rendered,type:"post",url:e.link,storeAs:"post"})),...n.map(e=>({id:e.id,title:e.title.rendered,type:"page",url:e.link,storeAs:"post"})),...r.map(e=>({id:e.id,title:e.title.rendered,type:"kennisbank",url:e.link,storeAs:"post"})),...s.map(e=>({id:e.id,title:e.title.rendered,type:"voorlichting",url:e.link,storeAs:"post"})),...i.map(e=>({id:e.id,title:e.title.rendered,type:"vestiging",url:e.link,storeAs:"post"})),...o.map(e=>({id:e.id,title:e.name,type:"category",url:e.link,storeAs:"term"})),...c.map(e=>({id:e.slug,title:e.title,type:"archive",url:null,storeAs:"archive"}))];l(p)}catch(e){console.error("Link search failed:",e),l([])}c(!1)}})(...t),300)}})(),v=()=>{t(""),i(""),g(null)};if((0,m.useEffect)(()=>{const e=e=>{x.current&&!x.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),u){let e="";if(u.url)try{e=new URL(u.url).pathname}catch(t){e=u.url}else"archive"===u.itemType&&(e=`/${u.slug}/`);return(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"archive"===u.itemType?"#e8f4e8":"#f0f0f0",borderRadius:"4px",border:"1px solid "+("archive"===u.itemType?"#a3d9a3":"#ddd")},children:[(0,f.jsxs)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[(0,f.jsx)("strong",{dangerouslySetInnerHTML:{__html:u.title}}),e&&(0,f.jsx)("span",{style:{color:"#666",marginLeft:"8px",fontSize:"11px"},children:e})]}),(0,f.jsx)(s.Button,{icon:S,label:"Remove link",isSmall:!0,onClick:v})]})}return"url"===y.type&&y.url?(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"#fff8e5",borderRadius:"4px",border:"1px solid #f0c36d"},children:[(0,f.jsx)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:y.url}),(0,f.jsx)(s.Button,{icon:S,label:"Remove link",isSmall:!0,onClick:v})]}):(0,f.jsxs)("div",{ref:x,style:{position:"relative"},children:[(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,f.jsx)(s.TextControl,{value:r,onChange:e=>{i(e),h(!0),b(e)},onFocus:()=>h(!0),onBlur:()=>{setTimeout(()=>{if(h(!1),r&&!u){const e=r.trim();(e.startsWith("/")||e.startsWith("http")||e.startsWith("#"))&&t(e)}},200)},placeholder:n,style:{flex:1,marginBottom:0},__nextHasNoMarginBottom:!0}),d&&(0,f.jsx)(s.Spinner,{})]}),p&&o.length>0&&(0,f.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflow:"auto"},children:o.map(e=>(0,f.jsxs)("div",{onClick:()=>(e=>{const n=e.storeAs||"post";t(`${n}:${e.id}`),i(""),l([]),h(!1)})(e),style:{padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseEnter:e=>e.currentTarget.style.background="#f5f5f5",onMouseLeave:e=>e.currentTarget.style.background="#fff",children:[(0,f.jsx)("span",{dangerouslySetInnerHTML:{__html:e.title}}),(0,f.jsx)("span",{style:{fontSize:"10px",color:"#666",background:"#eee",padding:"2px 6px",borderRadius:"3px",textTransform:"uppercase"},children:e.type})]},`${e.type}-${e.id}`))}),p&&r&&0===o.length&&!d&&(0,f.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"No results. Press Tab or click away to save as URL."})]})},T="nok-page-part-design-selector",R={width:"100%",borderBottom:"1px solid #ddd",borderRadius:"3px",fontSize:"13px",margin:"0",padding:"16px 0"},z={margin:"8px 0 8px 0",fontSize:"12px",color:"#757575",fontStyle:"italic",lineHeight:"1.4"},M=({label:e,children:t})=>(0,f.jsxs)("div",{style:{marginBottom:"16px"},children:[e&&(0,f.jsx)("div",{style:{marginBottom:"8px",fontSize:"11px",fontWeight:"600",textTransform:"uppercase",color:"#1e1e1e"},children:e}),t]}),B=({value:e,onChange:t,postTypes:n=["post"],categories:r=[]})=>{const[s,i]=(0,m.useState)([]),[a,o]=(0,m.useState)([]),[l,d]=(0,m.useState)(!1),[c,p]=(0,m.useState)(""),h=(0,m.useMemo)(()=>{try{return JSON.parse(e||"[]")}catch{return[]}},[e]);return(0,m.useEffect)(()=>{(async()=>{if(0!==h.length)try{const e=new URLSearchParams({include:h.join(",")}),t=await fetch(`/wp-json/nok-2025-v1/v1/posts/query?${e}`),n=await t.json();o(n)}catch(e){console.error("Failed to fetch selected posts:",e)}else o([])})()},[h.join(",")]),(0,m.useEffect)(()=>{(async()=>{d(!0);try{const e=new URLSearchParams({post_type:n.join(","),exclude:h.join(","),search:c});r.length>0&&e.append("categories",r.join(","));const t=await fetch(`/wp-json/nok-2025-v1/v1/posts/query?${e}`),s=await t.json();i(s)}catch(e){console.error("Failed to fetch posts:",e)}d(!1)})()},[h.join(","),c,n.join(","),r.join(",")]),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{marginBottom:"8px"},children:(0,f.jsx)("input",{type:"text",placeholder:"Search posts...",value:c,onChange:e=>p(e.target.value),style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px"}})}),a.length>0&&(0,f.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,f.jsx)("strong",{children:"Selected:"}),a.map(e=>(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 8px",background:"#f0f0f0",marginTop:"4px",borderRadius:"3px"},children:[(0,f.jsx)("span",{children:e.title}),(0,f.jsx)("button",{type:"button",onClick:()=>(e=>{const n=h.filter(t=>t!==e);o(a.filter(t=>t.id!==e)),t(JSON.stringify(n))})(e.id),style:{background:"none",border:"none",color:"#cc0000",cursor:"pointer",padding:"0 4px"},children:"×"})]},e.id))]}),(0,f.jsx)("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"3px"},children:l?(0,f.jsx)("div",{style:{padding:"8px",textAlign:"center"},children:"Loading..."}):0===s.length?(0,f.jsx)("div",{style:{padding:"8px",textAlign:"center",color:"#666"},children:c?"No posts found":"All posts selected"}):s.map(e=>(0,f.jsxs)("div",{onClick:()=>(e=>{const n=[...h,e.id];o([...a,e]),t(JSON.stringify(n))})(e),style:{padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"},onMouseEnter:e=>e.target.style.background="#f9f9f9",onMouseLeave:e=>e.target.style.background="transparent",children:[(0,f.jsx)("div",{style:{fontWeight:"500"},children:e.title}),(0,f.jsxs)("div",{style:{fontSize:"11px",color:"#666"},children:[e.type," • ",e.date]})]},e.id))})]})},H=({field:e,schema:t,value:n,onChange:r})=>{const[s,i]=(0,m.useState)(()=>{try{return JSON.parse(n||"[]")}catch{return[]}}),[a,o]=(0,m.useState)(null);(0,m.useEffect)(()=>{try{const e=JSON.parse(n||"[]");JSON.stringify(e)!==JSON.stringify(s)&&i(e)}catch{}},[n]);const l=()=>{const e={_id:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return t.forEach(t=>{e[t.name]=""}),e},d=e=>{i(e),r(JSON.stringify(e))},c=(e,t,n)=>{const r=[...s];r[e]={...r[e],[t]:n},d(r)},p=e=>{e.currentTarget.style.opacity="1",o(null)},h=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"};return(0,f.jsxs)(f.Fragment,{children:[s.map((n,r)=>(0,f.jsxs)("div",{draggable:!0,onDragStart:e=>((e,t)=>{o(t),e.dataTransfer.effectAllowed="move",e.currentTarget.style.opacity="0.5"})(e,r),onDragEnd:p,onDragOver:h,onDrop:e=>((e,t)=>{e.preventDefault(),null!==a&&a!==t&&((e,t)=>{const n=[...s],[r]=n.splice(e,1);n.splice(t,0,r),d(n)})(a,t)})(e,r),style:{background:a===r?"#f0f0f0":"#f8f9fa",border:"1px solid #ddd",borderRadius:"4px",padding:"12px",marginBottom:"8px",position:"relative",cursor:"move",transition:"background 0.2s"},children:[(0,f.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,f.jsxs)("span",{style:{fontSize:"11px",fontWeight:"600",color:"#555",userSelect:"none"},children:["⋮⋮ Item ",r+1]}),(0,f.jsx)("button",{type:"button",onClick:()=>(e=>{const t=s.filter((t,n)=>n!==e);d(t)})(r),style:{background:"#dc3232",color:"white",border:"none",padding:"4px 8px",borderRadius:"3px",cursor:"pointer",fontSize:"11px"},children:"Verwijder"})]}),t.map(t=>((t,n,r)=>{const s=t.name,i=n[s]||"",a=t.name.charAt(0).toUpperCase()+t.name.slice(1).replace(/_/g," ");switch(t.type){case"icon-selector":const n=window.PagePartDesignSettings?.icons||{};return(0,f.jsxs)(M,{label:t.label||a,children:[(0,f.jsx)(y,{value:i,icons:n,onChange:e=>c(r,s,e)}),e.description&&(0,f.jsx)("p",{style:z,children:e.description})]},s);case"textarea":return(0,f.jsx)(M,{label:t.label||a,children:(0,f.jsx)("textarea",{value:i,onChange:e=>c(r,s,e.target.value),rows:3,style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})},s);case"url":return(0,f.jsx)(M,{label:t.label||a,children:(0,f.jsx)("input",{type:"url",value:i,onChange:e=>c(r,s,e.target.value),placeholder:"https://...",style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})},s);default:return(0,f.jsx)(M,{label:t.label||a,children:(0,f.jsx)("input",{type:"text",value:i,onChange:e=>c(r,s,e.target.value),style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})},s)}})(t,n,r))]},n._id||r)),(0,f.jsx)("button",{type:"button",onClick:()=>{const e=[...s,l()];d(e)},style:{background:"#0073aa",color:"white",border:"none",padding:"6px 12px",borderRadius:"3px",cursor:"pointer",fontSize:"12px"},children:"Add Item"})]})};(0,n.registerPlugin)("page-part-design",{render:function(){if("page_part"!==(0,t.useSelect)(e=>e("core/editor").getCurrentPostType(),[]))return null;const e=(0,t.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),n=(0,t.useSelect)(e=>e("core/editor").getEditedPostAttribute("meta"),[]),{editPost:i}=(0,t.useDispatch)("core/editor"),o=window.PagePartDesignSettings?.registry||{},l=[{label:"— Select —",value:""},...Object.entries(o).map(([e,t])=>({label:t.name,value:e}))],d=n?.design_slug||"",c=(o[d]||{}).custom_fields||[],[p,h]=(0,m.useState)({}),[u,g]=(0,m.useState)(!1),j=(0,m.useRef)({}),[k,w]=(0,m.useState)(!1),[S,C]=(0,m.useState)(!1);(0,m.useEffect)(()=>{if(n&&c.length>0){const e={};c.forEach(t=>{const r=n[t.meta_key],s=void 0!==r?r:t.default||"";e[t.meta_key]=s}),h(e),u||setTimeout(()=>g(!0),1e3)}},[d,n?.design_slug]),(0,m.useEffect)(()=>{e&&d?a()({path:`/nok/v1/page-part/${e}/orphaned-fields?current_template=${d}`}).then(e=>{C(e.sources?.length>0)}).catch(()=>C(!1)):C(!1)},[e,d]);const I=(e,t)=>{u?(h(n=>({...n,[e]:t})),j.current[e]&&clearTimeout(j.current[e]),j.current[e]=setTimeout(()=>{x.log(T,`Debounced update for ${e}: ${t}`);const r={...n,[e]:t};i({meta:r}),delete j.current[e]},500)):x.log(T,`Skipping update during initialization for ${e}`)};function L(t,r=!1){const s=[];for(const e in n)/^[a-z0-9-]+_[a-z0-9_]+$/.test(e)&&"design_slug"!==e&&(r&&e.startsWith(t+"_")?x.log(T,`Will not remove ${e}`):(s.push(e),x.warn(T,`Will remove ${e}`)));0!==s.length&&wp.apiFetch({path:`/nok/v1/page-part/${e}/prune-fields`,method:"POST",data:{retain_current:r}}).then(()=>{x.log(T,`Deleted ${s.length} field(s)`);const e={...n};s.forEach(t=>delete e[t]),i({meta:e})})}return(0,f.jsxs)(r.PluginDocumentSettingPanel,{name:"page-part-design",title:"NOK Design template",icon:"admin-generic",children:[(0,f.jsx)(s.SelectControl,{label:"Template",value:d,options:l,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:e=>{x.log(T,`→ setting design_slug to "${e}"`);const t={...n,design_slug:e};i({meta:t})}}),S&&(0,f.jsx)(s.Button,{variant:"secondary",onClick:()=>w(!0),style:{width:"100%",justifyContent:"center",marginTop:"12px"},children:"Importeer..."}),(0,f.jsx)(_,{isOpen:k,onClose:()=>w(!1),postId:e,currentTemplate:d,targetFields:c,onImport:e=>{const t={...n,...e};i({meta:t}),h(t=>({...t,...e})),x.log(T,`Imported ${Object.keys(e).length} fields from previous template`)}}),c.length>0&&(0,f.jsxs)(m.Fragment,{children:[(0,f.jsx)("hr",{style:{margin:"16px 0"}}),(0,f.jsx)("h2",{style:R,children:"Template options"}),c.map(e=>{var t,r;const i=null!==(t=null!==(r=p[e.meta_key])&&void 0!==r?r:n?.[e.meta_key])&&void 0!==t?t:"";switch(e.type){case"textarea":return(0,f.jsxs)(M,{label:e.label,children:[(0,f.jsx)(s.TextareaControl,{value:i,onChange:t=>I(e.meta_key,t),rows:3}),e.description&&(0,f.jsx)("p",{style:z,children:e.description})]},e.meta_key);case"url":return(0,f.jsx)(M,{label:e.label,children:(0,f.jsx)(s.TextControl,{type:"url",value:i,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:t=>I(e.meta_key,t),placeholder:"https://..."})},e.meta_key);case"link":return(0,f.jsxs)(M,{label:e.label,children:[e.description&&(0,f.jsx)("p",{style:z,children:e.description}),(0,f.jsx)($,{value:i,onChange:t=>I(e.meta_key,t),placeholder:"Search pages or enter URL..."})]},e.meta_key);case"repeater":return"post"===e.repeater_subtype?(0,f.jsxs)(M,{label:e.label,children:[e.description&&(0,f.jsx)("p",{style:z,children:e.description}),(0,f.jsx)(B,{value:i,onChange:t=>I(e.meta_key,t),postTypes:e.post_types||["post"],categories:e.categories||[]})]},e.meta_key):e.schema&&0!==e.schema.length?(0,f.jsxs)(M,{label:e.label,children:[e.description&&(0,f.jsx)("p",{style:z,children:e.description}),(0,f.jsx)(H,{field:e,schema:e.schema,value:i,onChange:t=>I(e.meta_key,t)})]},e.meta_key):(0,f.jsxs)("div",{style:{padding:"8px",background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",marginBottom:"16px"},children:[(0,f.jsx)("strong",{children:"Warning:"}),' Repeater field "',e.label,'" has no schema defined.']},e.meta_key);case"icon-selector":const t=window.PagePartDesignSettings?.icons||{};return(0,f.jsx)(M,{label:e.label,children:(0,f.jsx)(y,{value:i,icons:t,onChange:t=>I(e.meta_key,t)})},e.meta_key);case"color-selector":return(0,f.jsxs)(M,{label:e.label,children:[(0,f.jsx)(v,{value:i,palette:e.palette,onChange:t=>I(e.meta_key,t)}),e.description&&(0,f.jsx)("p",{style:z,children:e.description})]},e.meta_key);case"select":const n=e.options||[],r=e.option_labels||n,a=e.default&&""!==e.default?n.map((e,t)=>({label:r[t]||e,value:e})):[{label:"— Select —",value:""},...n.map((e,t)=>({label:r[t]||e,value:e}))];return(0,f.jsxs)(M,{label:e.label,children:[(0,f.jsx)(s.SelectControl,{value:i,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,options:a,onChange:t=>I(e.meta_key,t)},e.meta_key),e.description&&(0,f.jsx)("p",{style:z,children:e.description})]},e.meta_key);case"checkbox":return(0,f.jsx)(M,{children:(0,f.jsx)(s.CheckboxControl,{label:e.label,help:e.description||"",checked:"1"===i||!0===i,onChange:t=>I(e.meta_key,t?"1":"0")},e.meta_key)},e.meta_key);case"taxonomy":return(0,f.jsxs)(M,{label:e.label,children:[e.description&&(0,f.jsx)("p",{style:z,children:e.description}),(0,f.jsx)(b,{taxonomy:e.taxonomy,value:i,onChange:t=>I(e.meta_key,t),multiple:!1!==e.multiple})]},e.meta_key);default:return(0,f.jsxs)(M,{label:e.label,children:[(0,f.jsx)(s.TextControl,{value:i,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:t=>I(e.meta_key,t)},e.meta_key),e.description&&(0,f.jsx)("p",{style:z,children:e.description})]},e.meta_key)}})]}),c.length>0&&(0,f.jsxs)(m.Fragment,{children:[(0,f.jsx)("hr",{style:{margin:"16px 0"}}),(0,f.jsx)(s.Button,{isDestructive:!0,variant:"secondary",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onClick:()=>{confirm("Wil je alle velden die niet langer door de huidige template worden gebruikt verwijderen?")&&(x.log(T,"Pruning unused template fields"),L(!0))},style:{width:"100%",justifyContent:"center",marginBottom:"16px"},children:"Reset ongebruikt"}),(0,f.jsx)(s.Button,{isDestructive:!0,variant:"secondary",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onClick:()=>{confirm("Wil je de velden voor ALLE templates voor deze page part terugzetten naar de standaardwaarden?")&&(x.log(T,"Resetting template fields to defaults"),L())},style:{width:"100%",justifyContent:"center",marginBottom:"16px"},children:"Reset opties"})]})]})}})})();