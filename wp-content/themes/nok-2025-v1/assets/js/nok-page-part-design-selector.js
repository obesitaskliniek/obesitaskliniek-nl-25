(()=>{"use strict";const e=window.wp.data,t=window.wp.plugins,s=window.wp.editPost,r=window.wp.components,a={degsteps:60,startsat:100,startbri:100,startdeg:0,gradsteps:10,paletlim:[0,360]},i=new class{constructor(e,t,s,r,i,n){this.startdeg=null!=r?r:a.startdeg,this.degsteps=null!=e?e:a.degsteps,this.startsat=null!=t?t:a.startsat,this.startbri=null!=s?s:a.startbri,this.gradsteps=i&&i>1?i:a.gradsteps,this.paletlim=null!=n?n:a.paletlim,this.calls=0,this.color=null,this.deg=0,this.cyc=0,this.bri=100,this.sat=100,this.opa=1}new(e,t){return this.color=this._generateColor(e,t),this.string=this.color.string,this.values=this.color.values,this.contra=this.color.contra,this.hex=this._rgbToHex(this.color.values),this.calls++,this}adjust(e){var t,s,r,a;const i=null!==(t=e.deg)&&void 0!==t?t:0,n=null!==(s=e.sat)&&void 0!==s?s:this.sat,o=null!==(r=e.bri)&&void 0!==r?r:this.bri,l=null!==(a=e.opa)&&void 0!==a?a:this.opa,c=(this.deg+i)%this.paletlim[1],d=this._clamp(o<=1&&o>0?this.bri*o:o,0,100),h=this._clamp(n<=1&&n>0?this.sat*n:n,0,100),g=this._clamp(l,0,1);return this._hsvToRgb(c,h,d,g)}_generateColor(e,t){let s=!1;if("string"==typeof e)if("#"===e[0]){const t=this._hslToHsv(this._hexToHsl(e));this.deg=t[0],this.sat=t[1],this.bri=t[2],s=!0}else this.deg=this._stringToDegrees(e);else this.startdeg=Math.max(this.startdeg,this.paletlim[0]),this.deg=this.startdeg+this.calls*this.degsteps;if(this.cyc=Math.floor(this.deg/this.paletlim[1]),!s&&(this.bri=e&&e>0?e:this.startbri,this.sat=t&&t>0?t:this.startsat,this.bri=Math.abs(this.bri%101),this.sat=Math.abs(this.sat%101),this.deg=this.deg%(this.paletlim[1]+1),this.deg=Math.max(this.deg,this.paletlim[0]),this.paletlim[0]%this.degsteps===0&&this.cyc>0)){const t=this.cyc*this.gradsteps;this.bri=e&&e>0?e:this.startbri-t,t>=100&&(this.cyc=0,this.gradsteps=this.gradsteps/2)}return this._hsvToRgb(this.deg,this.sat,this.bri)}_stringToDegrees(e){const t=[...e].reduce((e,t)=>t.charCodeAt(0)+((e<<5)-e),0);return Math.abs(t)%360}_hsvToRgb(e,t,s,r){e/=360,t/=100,s/=100,r=void 0!==r?parseFloat(r):void 0;const a=Math.floor(6*e),i=6*e-a,n=s*(1-t),o=s*(1-i*t),l=s*(1-(1-i)*t);let c,d,h;switch(a%6){case 0:c=s,d=l,h=n;break;case 1:c=o,d=s,h=n;break;case 2:c=n,d=s,h=l;break;case 3:c=n,d=o,h=s;break;case 4:c=l,d=n,h=s;break;case 5:c=s,d=n,h=o}const g=[Math.round(255*c),Math.round(255*d),Math.round(255*h)],p=void 0!==r?"rgba":"rgb";return void 0!==r&&g.push(r),{values:g,string:`${p}(${g.join(",")})`,hex:this._rgbToHex(g),contra:this._textContrast(g)}}_hexToHsl(e){const t=this._hexToRgb(e),s=t[0]/255,r=t[1]/255,a=t[2]/255,i=Math.min(s,r,a),n=Math.max(s,r,a),o=n-i;let l=0;0!==o&&(l=n===s?(r-a)/o%6:n===r?(a-s)/o+2:(s-r)/o+4),l=Math.round(60*l),l<0&&(l+=360);const c=(n+i)/2;return[l,+(100*(0===o?0:o/(1-Math.abs(2*c-1)))).toFixed(1),+(100*c).toFixed(1)]}_hslToHsv(e){const t=e[1]*(e[2]<50?e[2]:100-e[2])/100,s=0===t?0:2*t/(e[2]+t)*100,r=e[2]+t;return[e[0],s,r]}_hexToRgb(e){return e.match(/\w\w/g).map(e=>+`0x${e}`)}_rgbToHex(e){return"#"+e.slice(0,3).map(e=>e.toString(16).padStart(2,"0")).join("")}_textContrast(e){return Math.round((299*parseInt(e[0])+587*parseInt(e[1])+114*parseInt(e[2]))/1e3)>125?"rgb(0,0,0)":"rgb(255,255,255)"}_clamp(e,t,s){return Math.min(Math.max(e,t),s)}},n=window.location.search.includes("debug=true"),o="font-family: Lucida Grande,Lucida Sans Unicode,Lucida Sans,Geneva,Verdana,sans-serif",l=new Map,c={log:"black",info:"#1e529e",warn:"#fd7e14",error:"red"};function d(e,t=!1){const s=`${e}:${t}`;if(l.has(s))return l.get(s);const r=i.new(e),a=`${o};padding:3px 5px;border-radius:6px;`,n=t?a+"color: #339;border: 1px solid #339B;background-color: #FFF8;margin-right:2px;":a+`color:${r.contra};border: 1px solid transparent;`+`background-color:${r.string};margin-right:10px;`+`background-image:linear-gradient(0deg,${r.adjust({deg:10}).string} 0%,${r.adjust({opa:1}).string} 100%);`;return l.set(s,n),n}function h(e,t,s){if(!n)return;const r=console[e]||console.log,a=`${o};color:${c[e]};`,i=t.match(/^(core|util)\.(.+)/);if(i){const e=i[1],n=i[2],o=d(e,!0),l=d(t,!1);"object"==typeof s&&null!==s?r(`%c${e}%c${n}`,o,l,s):r(`%c${e}%c${n}%c ${s}`,o,l,a)}else{const e=d(t,!1);"object"==typeof s&&null!==s?r(`%c${t}`,e,s):r(`%c${t}%c ${s}`,e,a)}}const g={log(e,t){h("log",e,t)},info(e,t){h("info",e,t)},warn(e,t){h("warn",e,t)},error(e,t){h("error",e,t)}},p=window.wp.element,u=window.ReactJSXRuntime,m="nok-page-part-design-selector",b=({field:e,schema:t,value:s,onChange:r})=>{const[a,i]=(0,p.useState)(()=>{try{return JSON.parse(s||"[]")}catch{return[]}}),[n,o]=(0,p.useState)(null),l=()=>{const e={};return t.forEach(t=>{e[t.name]=""}),e},c=e=>{i(e),r(JSON.stringify(e))},d=(e,t,s)=>{const r=[...a];r[e]={...r[e],[t]:s},c(r)},h=e=>{e.currentTarget.style.opacity="1",o(null)},g=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"};return(0,u.jsxs)("div",{style:{marginTop:"12px"},children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"12px",fontWeight:"600",marginBottom:"8px",color:"#1e1e1e"},children:e.label}),(0,u.jsx)("div",{style:{marginBottom:"12px"},children:a.map((e,s)=>(0,u.jsxs)("div",{draggable:!0,onDragStart:e=>((e,t)=>{o(t),e.dataTransfer.effectAllowed="move",e.currentTarget.style.opacity="0.5"})(e,s),onDragEnd:h,onDragOver:g,onDrop:e=>((e,t)=>{e.preventDefault(),null!==n&&n!==t&&((e,t)=>{const s=[...a],[r]=s.splice(e,1);s.splice(t,0,r),c(s)})(n,t)})(e,s),style:{background:n===s?"#f0f0f0":"#f8f9fa",border:"1px solid #ddd",borderRadius:"4px",padding:"12px",marginBottom:"8px",position:"relative",cursor:"move",transition:"background 0.2s"},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,u.jsxs)("span",{style:{fontSize:"11px",fontWeight:"600",color:"#555",userSelect:"none"},children:["⋮⋮ Item ",s+1]}),(0,u.jsx)("button",{type:"button",onClick:()=>(e=>{const t=a.filter((t,s)=>s!==e);c(t)})(s),style:{background:"#dc3232",color:"white",border:"none",padding:"4px 8px",borderRadius:"3px",cursor:"pointer",fontSize:"11px"},children:"Verwijder"})]}),t.map(t=>((e,t,s)=>{const r=e.name,a=t[r]||"",i=e.name.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),n={width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"};return"textarea"===e.type?(0,u.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,u.jsxs)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px"},children:[i,":"]}),(0,u.jsx)("textarea",{value:a,onChange:e=>d(s,r,e.target.value),rows:3,style:n})]},r):(0,u.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,u.jsxs)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px"},children:[i,":"]}),(0,u.jsx)("input",{type:"text",value:a,onChange:e=>d(s,r,e.target.value),style:n})]},r)})(t,e,s))]},s))}),(0,u.jsx)("button",{type:"button",onClick:()=>{const e=[...a,l()];c(e)},style:{background:"#0073aa",color:"white",border:"none",padding:"6px 12px",borderRadius:"3px",cursor:"pointer",fontSize:"12px"},children:"Add Item"})]})};(0,t.registerPlugin)("page-part-design",{render:function(){if("page_part"!==(0,e.useSelect)(e=>e("core/editor").getCurrentPostType(),[]))return null;(0,e.useSelect)(e=>e("core/editor").getCurrentPostId(),[]);const t=(0,e.useSelect)(e=>e("core/editor").getEditedPostAttribute("meta"),[]),{editPost:a}=(0,e.useDispatch)("core/editor"),i=window.PagePartDesignSettings?.registry||{},n=[{label:"— Select —",value:""},...Object.entries(i).map(([e,t])=>({label:t.name,value:e}))],o=t?.design_slug||"",l=(i[o]||{}).custom_fields||[],[c,d]=(0,p.useState)({}),[h,x]=(0,p.useState)(!1),f=(0,p.useRef)({});(0,p.useEffect)(()=>{if(t&&l.length>0){const e={};l.forEach(s=>{const r=t[s.meta_key],a=void 0!==r&&""!==r?r:s.default||"";e[s.meta_key]=a}),d(e),h||setTimeout(()=>x(!0),1e3)}},[o,t?.design_slug]);const y=(e,s)=>{h?(d(t=>({...t,[e]:s})),f.current[e]&&clearTimeout(f.current[e]),f.current[e]=setTimeout(()=>{g.log(m,`Debounced update for ${e}: ${s}`);const r={...t,[e]:s};a({meta:r}),delete f.current[e]},500)):g.log(m,`Skipping update during initialization for ${e}`)};return(0,u.jsxs)(s.PluginDocumentSettingPanel,{name:"page-part-design",title:"NOK Design template",children:[(0,u.jsx)(r.SelectControl,{label:"Template",value:o,options:n,onChange:e=>{g.log(m,`→ setting design_slug to "${e}"`);const s={...t,design_slug:e};a({meta:s})}}),l.length>0&&(0,u.jsxs)(p.Fragment,{children:[(0,u.jsx)("hr",{style:{margin:"16px 0"}}),(0,u.jsx)("h4",{style:{margin:"0 0 12px 0",fontSize:"13px",fontWeight:"600"},children:"Template options"}),l.map(e=>{var s,a;const i=null!==(s=null!==(a=c[e.meta_key])&&void 0!==a?a:t?.[e.meta_key])&&void 0!==s?s:"";switch(e.type){case"textarea":return(0,u.jsx)(r.TextareaControl,{label:e.label,value:i,onChange:t=>y(e.meta_key,t),rows:3},e.meta_key);case"url":return(0,u.jsx)(r.TextControl,{label:e.label,type:"url",value:i,onChange:t=>y(e.meta_key,t),placeholder:"https://..."},e.meta_key);case"repeater":return e.schema&&0!==e.schema.length?(0,u.jsx)(b,{field:e,schema:e.schema,value:i,onChange:t=>y(e.meta_key,t)},e.meta_key):(0,u.jsxs)("div",{style:{padding:"12px",background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px"},children:[(0,u.jsx)("strong",{children:"Warning:"}),' Repeater field "',e.label,'" has no schema defined.']},e.meta_key);case"select":const t=e.options||[],s=e.option_labels||t;return(0,u.jsx)(r.SelectControl,{label:e.label,value:i,options:[{label:"— Select —",value:""},...t.map((e,t)=>({label:s[t]||e,value:e}))],onChange:t=>y(e.meta_key,t)},e.meta_key);case"checkbox":return(0,u.jsx)(r.CheckboxControl,{label:e.label,checked:"1"===i||!0===i,onChange:t=>y(e.meta_key,t?"1":"0")},e.meta_key);default:return(0,u.jsx)(r.TextControl,{label:e.label,value:i,onChange:t=>y(e.meta_key,t)},e.meta_key)}})]})]})}})})();