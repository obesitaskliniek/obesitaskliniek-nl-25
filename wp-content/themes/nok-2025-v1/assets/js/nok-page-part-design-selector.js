(()=>{"use strict";const t=window.wp.data,e=window.wp.plugins,s=window.wp.editPost,i=window.wp.components,o=new class{constructor(t,e,s,i,o,a){this.startdeg=i||0,this.degsteps=t||60,this.startsat=e||100,this.startbri=s||100,this.gradsteps=o&&o>1?o:10,this.paletlim=a||[0,360],this.skipgreen=!1,this.calls=0,this.color=null,this.deg=0,this.cyc=0,this.bri=100,this.sat=100,this.opa=1}_stringToDegrees(t){let e=[...t].reduce((t,e)=>e.charCodeAt(0)+((t<<5)-t),0);return Math.abs(e)%360}_textContrast(t){return Math.round((299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3)>125?"rgb(0,0,0)":"rgb(255,255,255)"}_componentToHex(t){var e=t.toString(16);return 1===e.length?"0"+e:e}_rgbToHex(t){return"#"+this._componentToHex(t[0])+this._componentToHex(t[1])+this._componentToHex(t[2])}_hexToRgb(t){return t.match(/\w\w/g).map(t=>+`0x${t}`)}_hexToHSL(t){let e=this._hexToRgb(t),s=e[0]/255,i=e[1]/255,o=e[2]/255,a=Math.min(s,i,o),n=Math.max(s,i,o),r=n-a,l=0,d=0,h=0;return l=0===r?0:n===s?(i-o)/r%6:n===i?(o-s)/r+2:(s-i)/r+4,l=Math.round(60*l),l<0&&(l+=360),h=(n+a)/2,d=0===r?0:r/(1-Math.abs(2*h-1)),d=+(100*d).toFixed(1),h=+(100*h).toFixed(1),[l,d,h]}_hsl2hsv(t){const e=t[1]*(t[2]<50?t[2]:100-t[2])/100,s=0===e?0:2*e/(t[2]+e)*100,i=t[2]+e;return[t[0],s,i]}_HSVtoRGB(t,e,s,i){var o,a,n,r,l,d,h,c;switch(t/=360,e/=100,s/=100,i=void 0!==i?parseFloat(i):void 0,1===arguments.length&&(e=t.s,s=t.v,t=t.h),d=s*(1-e),h=s*(1-(l=6*t-(r=Math.floor(6*t)))*e),c=s*(1-(1-l)*e),r%6){case 0:o=s,a=c,n=d;break;case 1:o=h,a=s,n=d;break;case 2:o=d,a=s,n=c;break;case 3:o=d,a=h,n=s;break;case 4:o=c,a=d,n=s;break;case 5:o=s,a=d,n=h}let p=[Math.round(255*o),Math.round(255*a),Math.round(255*n)],g="rgb";return void 0!==i&&(p.push(i),g="rgba"),{values:p,string:g+"("+p.join(",")+")",hex:this._rgbToHex(p),contra:this._textContrast(p),textContrast:this._textContrast}}doColor(t,e){let s=!1;if("string"==typeof t)if("#"===t[0]){let e=this._hsl2hsv(this._hexToHSL(t));this.deg=e[0],this.sat=e[1],this.bri=e[2],s=!0}else this.deg=this._stringToDegrees(t);else this.startdeg=this.startdeg<this.paletlim[0]?this.paletlim[0]:this.startdeg,this.deg=this.startdeg+this.calls*this.degsteps;if(this.cyc=Math.floor(this.deg/this.paletlim[1]),!s&&(this.bri=t&&t>0?t:this.startbri,this.sat=e&&e>0?e:this.startsat,this.bri=Math.abs(this.bri%101),this.sat=Math.abs(this.sat%101),this.deg=this.deg%(this.paletlim[1]+1),this.deg=this.deg<this.paletlim[0]?this.paletlim[0]:this.deg,this.paletlim[0]%this.degsteps===0&&this.cyc>0)){let s=this.cyc*this.gradsteps;this.altbri=t&&t>0?t:this.startbri-s,this.altsat=e&&e>0?e:this.startsat-s,this.altdeg=this.deg+this.degsteps/(this.cyc+1),this.altdeg=this.altdeg<this.paletlim[0]?this.altdeg-this.paletlim[0]:this.altdeg,this.bri=this.altbri,s>=100&&(this.cyc=0,this.gradsteps=this.gradsteps/2)}return this._HSVtoRGB(this.deg,this.sat,this.bri)}new(t,e){return this.color=this.doColor(t,e),this.string=this.color.string,this.values=this.color.values,this.contra=this.color.contra,this.hex=this._rgbToHex(this.color.values),this.calls++,this}adjust(t){let e,s,i,o,a=void 0!==t.deg?t.deg:0,n=void 0!==t.sat?t.sat:this.sat,r=void 0!==t.bri?t.bri:this.bri,l=void 0!==t.opa?t.opa:this.opa;return i=(this.deg+a)%this.paletlim[1],s=r<=1&&r>0?this.bri*r:r,e=n<=1&&n>0?this.sat*n:n,o=l<0?0:l>1?1:l,s=s>100?100:s<0?0:s,e=e>100?100:e<0?0:e,this._HSVtoRGB(i,e,s,o)}},a=window.location.search.includes("debug=true");function n(t){return"%c"+[].slice.call(t).join("%c")}const r="font-family: Lucida Grande,Lucida Sans Unicode,Lucida Sans,Geneva,Verdana,sans-serif";function l(t){const e=o.new(t);return`color:${e.contra};\n  background-color:${e.string};\n  background-image:linear-gradient(0deg,${e.adjust({deg:10}).string} 0%, ${e.adjust({opa:1}).string} 100%);\n  padding:3px 5px;margin-right:15px;border-radius:4px;`}const d=function(t,e){!a||console.log("object"==typeof t?t:n("object"==typeof e?[t]:arguments),`${r}; ${l(t)}`,"object"==typeof e?e:`${r};color:black;`)},h=window.wp.element,c=window.ReactJSXRuntime,p="nok-page-part-design-selector",g=({field:t,value:e,onChange:s})=>{const[i,o]=(0,h.useState)(()=>{try{return JSON.parse(e||"[]")}catch{return[]}}),a=t=>{o(t),s(JSON.stringify(t))},n=(t,e,s)=>{const o=[...i];o[t]={...o[t],[e]:s},a(o)};return(0,c.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"12px",marginTop:"8px"},children:[(0,c.jsx)("div",{style:{marginBottom:"12px",fontSize:"13px",fontWeight:"600"},children:t.label}),i.map((t,e)=>(0,c.jsxs)("div",{style:{border:"1px solid #e0e0e0",borderRadius:"4px",marginBottom:"10px",overflow:"hidden"},children:[(0,c.jsxs)("div",{style:{background:"#f8f9fa",padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #e0e0e0"},children:[(0,c.jsxs)("span",{style:{fontSize:"12px",fontWeight:"600"},children:["Item ",e+1]}),(0,c.jsx)("button",{type:"button",onClick:()=>(t=>{const e=i.filter((e,s)=>s!==t);a(e)})(e),style:{background:"none",border:"none",color:"#d63638",cursor:"pointer",fontSize:"12px"},children:"Remove"})]}),(0,c.jsxs)("div",{style:{padding:"12px"},children:[(0,c.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px"},children:"Title:"}),(0,c.jsx)("input",{type:"text",value:t.title||"",onChange:t=>n(e,"title",t.target.value),placeholder:"e.g., Arts, Internist",style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})]}),(0,c.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px"},children:"Content:"}),(0,c.jsx)("textarea",{value:t.content||"",onChange:t=>n(e,"content",t.target.value),placeholder:"Description text...",rows:"3",style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px",resize:"vertical"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px"},children:"Button Text:"}),(0,c.jsx)("input",{type:"text",value:t.button_text||"",onChange:t=>n(e,"button_text",t.target.value),placeholder:"e.g., Over de Arts",style:{width:"100%",padding:"6px 8px",border:"1px solid #ddd",borderRadius:"3px",fontSize:"13px"}})]})]})]},e)),(0,c.jsx)("button",{type:"button",onClick:()=>{const t=[...i,{title:"",content:"",button_text:""}];a(t)},style:{background:"#0073aa",color:"white",border:"none",padding:"6px 12px",borderRadius:"3px",cursor:"pointer",fontSize:"12px"},children:"Add Item"})]})};(0,e.registerPlugin)("page-part-design",{render:function(){if("page_part"!==(0,t.useSelect)(t=>t("core/editor").getCurrentPostType(),[]))return null;const e=(0,t.useSelect)(t=>t("core/editor").getCurrentPostId(),[]),o=(0,t.useSelect)(t=>t("core/editor").getEditedPostAttribute("meta"),[]),{editPost:u}=(0,t.useDispatch)("core/editor"),x=window.PagePartDesignSettings?.registry||{},b=[{label:"— Select —",value:""},...Object.entries(x).map(([t,e])=>({label:e.name,value:t}))],m=o?.design_slug||"",y=(x[m]||{}).custom_fields||[],f=(t=null)=>{const s=t||o,i=s?.design_slug||"";d(p,"Storing all meta:"),d(p,s);const h=new URLSearchParams({action:"store_preview_state",post_id:e,design_slug:i});h.append("all_meta",JSON.stringify(s)),fetch(window.PagePartDesignSettings.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:h}).then(t=>t.json()).then(t=>(d(p,"Meta stored via React:"),d(p,t),wp.data.dispatch("core/editor").autosave())).then(()=>{d(p,"Autosave completed via React"),"function"==typeof window.nokUpdatePreview&&window.nokUpdatePreview(!0)}).catch(t=>{!function(t,e){!a||console.error("object"==typeof t?t:n("object"==typeof e?[t]:arguments),`${r}; ${l(t)}`,"object"==typeof e?e:`${r};color:red;`)}(p,`Preview update failed: ${t}`)})},[v,_]=(0,h.useState)({}),[w,j]=(0,h.useState)(!1),k=(0,h.useRef)({});(0,h.useEffect)(()=>{if(o&&y.length>0){const t={};y.forEach(e=>{const s=o[e.meta_key],i=void 0!==s&&""!==s?s:e.default||"";t[e.meta_key]=i}),_(t),w||setTimeout(()=>j(!0),1e3)}},[m,o?.design_slug]);const S=(t,e)=>{w?(_(s=>({...s,[t]:e})),k.current[t]&&clearTimeout(k.current[t]),k.current[t]=setTimeout(()=>{d(p,`Debounced update for ${t}: ${e}`);const s={...o,[t]:e};u({meta:s}),f(s),delete k.current[t]},500)):d(p,`Skipping update during initialization for ${t}`)};return(0,c.jsxs)(s.PluginDocumentSettingPanel,{name:"page-part-design",title:"NOK Design template",children:[(0,c.jsx)(i.SelectControl,{label:"Template",value:m,options:b,onChange:t=>{d(p,`→ setting design_slug to "${t}"`);const e={...o,design_slug:t};u({meta:e}),f(e)}}),y.length>0&&(0,c.jsxs)(h.Fragment,{children:[(0,c.jsx)("hr",{style:{margin:"16px 0"}}),(0,c.jsx)("h4",{style:{margin:"0 0 12px 0",fontSize:"13px",fontWeight:"600"},children:"Template options"}),y.map(t=>{var e,s;const a=null!==(e=null!==(s=v[t.meta_key])&&void 0!==s?s:o?.[t.meta_key])&&void 0!==e?e:"";switch(t.type){case"textarea":return(0,c.jsx)(i.TextareaControl,{label:t.label,value:a,onChange:e=>S(t.meta_key,e),rows:3},t.meta_key);case"url":return(0,c.jsx)(i.TextControl,{label:t.label,type:"url",value:a,onChange:e=>S(t.meta_key,e),placeholder:"https://..."},t.meta_key);case"repeater":return(0,c.jsx)(g,{field:t,value:a,onChange:e=>S(t.meta_key,e)},t.meta_key);case"select":const e=t.options||[],s=t.option_labels||e;return(0,c.jsx)(i.SelectControl,{label:t.label,value:a,options:[{label:"— Select —",value:""},...e.map((t,e)=>({label:s[e]||t,value:t}))],onChange:e=>S(t.meta_key,e)},t.meta_key);case"checkbox":return(0,c.jsx)(i.CheckboxControl,{label:t.label,checked:"1"===a||!0===a,onChange:e=>S(t.meta_key,e?"1":"0")},t.meta_key);default:return(0,c.jsx)(i.TextControl,{label:t.label,value:a,onChange:e=>S(t.meta_key,e)},t.meta_key)}})]})]})}})})();