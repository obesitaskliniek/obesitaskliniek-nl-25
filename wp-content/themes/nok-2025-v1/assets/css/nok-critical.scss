// =============================================================================
// CRITICAL (ABOVE-THE-FOLD) CSS — Target: <14KB uncompressed
// =============================================================================
// Hand-crafted rules for instant first paint of navigation + hero.
// NO component @use imports — only Sass tooling (which produces zero output).
//
// The full nok-components.css loads deferred (non-render-blocking) and fills in
// all remaining styles. Duplicated selectors here are harmless.
//
// To update: audit which rules cause layout shift in the hero + nav if missing.
// =============================================================================

// --- Sass tooling only (zero CSS output) ---
@use "nok-variables";
@use "./tools/nok-mixins";
@use "./tools/nok-rfs";

// =============================================================================
// 1. MINIMAL REBOOT (box-sizing + body reset)
// =============================================================================
*, *::before, *::after { box-sizing: border-box; }
html { line-height: 1.15; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
img, svg { vertical-align: middle; }
img { max-width: 100%; height: auto; }
h1, h2, h3, h4, h5, h6, p { margin-top: 0; margin-bottom: 0; }
a { text-decoration: none; color: inherit; }
button { cursor: pointer; border: 0; background: transparent; font: inherit; }
ul, ol { padding: 0; margin: 0; }

// =============================================================================
// 2. COLOR VARIABLES (only the colors used above the fold)
// =============================================================================
:root {
  // Blues
  --nok-lightblue: rgb(var(--nok-lightblue-rgb));
  --nok-lightblue-rgb: 0, 176, 228;
  --nok-lightblue-contrast: rgba(0, 19, 47, var(--alpha, 1));
  --nok-darkblue: rgb(var(--nok-darkblue-rgb));
  --nok-darkblue-rgb: 20, 71, 124;
  --nok-darkblue-contrast: rgba(243, 244, 249, var(--alpha, 1));
  --nok-darkerblue: rgb(var(--nok-darkerblue-rgb));
  --nok-darkerblue-rgb: 11, 35, 85;
  --nok-darkerblue-contrast: rgba(243, 244, 249, var(--alpha, 1));
  --nok-darkerblue--darker-rgb: 0, 14, 68;
  --nok-darkestblue: rgb(var(--nok-darkestblue-rgb));
  --nok-darkestblue-rgb: 0, 19, 47;
  --nok-darkestblue-contrast: rgba(243, 244, 249, var(--alpha, 1));
  --nok-darkestblue--darker-rgb: 0, 3, 32;
  // Yellow
  --nok-yellow: rgb(var(--nok-yellow-rgb));
  --nok-yellow-rgb: 255, 212, 31;
  --nok-yellow-contrast: rgba(0, 19, 47, var(--alpha, 1));
  // White
  --nok-white: rgb(var(--nok-white-rgb));
  --nok-white-rgb: 243, 244, 249;
  --nok-white-contrast: rgba(0, 19, 47, var(--alpha, 1));
  --nok-white--darker: rgb(var(--nok-white--darker-rgb));
  --nok-white--darker-rgb: 228, 230, 238;
  // Green (for hero SVG gradients)
  --nok-green: rgb(var(--nok-green-rgb));
  --nok-green-rgb: 84, 176, 133;
  // Body / derived
  --nok-body: var(--nok-white);
  --nok-body-rgb: var(--nok-white-rgb);
  --nok-body-contrast: var(--nok-white-contrast);
  --nok-body--darker: var(--nok-white--darker);
  --nok-body--lighter: var(--nok-white);
  --nok-body--lighter-rgb: var(--nok-white-rgb);
}

// =============================================================================
// 3. COLOR UTILITY CLASSES (only those used above the fold)
// =============================================================================
.nok-bg-body        { --bg-color: var(--nok-body); --bg-color--contrast: var(--nok-body-contrast); background-color: rgba(var(--nok-body-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-body-contrast)); }
.nok-bg-body--lighter { --bg-color: var(--nok-body--lighter); background-color: rgba(var(--nok-body--lighter-rgb), var(--bg-alpha-value, 1)); }
.nok-bg-white       { --bg-color: var(--nok-white); --bg-color--contrast: var(--nok-white-contrast); background-color: rgba(var(--nok-white-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-white-contrast)); }
.nok-bg-white--darker { --bg-color: var(--nok-white--darker); background-color: rgba(var(--nok-white--darker-rgb), var(--bg-alpha-value, 1)); }
.nok-bg-darkblue    { --bg-color: var(--nok-darkblue); --bg-color--contrast: var(--nok-darkblue-contrast); background-color: rgba(var(--nok-darkblue-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-darkblue-contrast)); }
.nok-bg-darkerblue  { --bg-color: var(--nok-darkerblue); --bg-color--contrast: var(--nok-darkerblue-contrast); background-color: rgba(var(--nok-darkerblue-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-darkerblue-contrast)); }
.nok-bg-darkestblue { --bg-color: var(--nok-darkestblue); --bg-color--contrast: var(--nok-darkestblue-contrast); background-color: rgba(var(--nok-darkestblue-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-darkestblue-contrast)); }
.nok-bg-yellow      { --bg-color: var(--nok-yellow); --bg-color--contrast: var(--nok-yellow-contrast); background-color: rgba(var(--nok-yellow-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-yellow-contrast)); }
.nok-text-contrast  { --text-color: var(--bg-color--contrast, inherit); color: var(--text-color); }
.nok-text-darkerblue { --text-color: var(--nok-darkerblue); color: var(--nok-darkerblue); }
.nok-text-lightblue { --text-color: var(--nok-lightblue); color: var(--nok-lightblue); }
.nok-text-yellow    { --text-color: var(--nok-yellow); color: var(--nok-yellow); }
.nok-fill-contrast  { fill: var(--bg-color--contrast, inherit); }

// Dark mode overrides (only the ones used above fold)
@media (prefers-color-scheme: dark) {
  :root {
    --nok-body: var(--nok-darkestblue);
    --nok-body-rgb: var(--nok-darkestblue-rgb);
    --nok-body-contrast: var(--nok-darkestblue-contrast);
    --nok-body--darker: var(--nok-darkestblue--darker);
  }
  .nok-dark-bg-darkerblue          { --bg-color: var(--nok-darkerblue); background-color: rgba(var(--nok-darkerblue-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-darkerblue-contrast)); }
  .nok-dark-bg-darkerblue--darker  { --bg-color: var(--nok-darkerblue--darker); background-color: rgba(var(--nok-darkerblue--darker-rgb), var(--bg-alpha-value, 1)); }
  .nok-dark-bg-darkestblue         { --bg-color: var(--nok-darkestblue); background-color: rgba(var(--nok-darkestblue-rgb), var(--bg-alpha-value, 1)); color: var(--text-color, var(--nok-darkestblue-contrast)); }
  .nok-dark-bg-darkestblue--darker { background-color: rgba(var(--nok-darkestblue--darker-rgb), var(--bg-alpha-value, 1)); }
  .nok-dark-text-contrast { color: var(--bg-color--contrast, inherit); }
  .nok-dark-text-white  { --text-color: var(--nok-white); color: var(--nok-white); }
  .nok-dark-text-yellow { --text-color: var(--nok-yellow); color: var(--nok-yellow); }
}

// =============================================================================
// 4. THEME VARIABLES + BODY/HTML
// =============================================================================
:root {
  @include nok-variables.parsed-variables;
  --nok-top-navigation-height: 4rem;
}
@include nok-mixins.media-breakpoint-down(xl) {
  :root { --nok-top-navigation-height: 6rem; }
}

section, nok-logo, nok-navigation-mobile, nok-navigation-desktop { display: contents; }
// Custom elements that carry background-color classes need block display
nok-navigation-top-row { display: block; }

html {
  --font-size-base: var(--nok-html-font-size, 1em);
  font-size: var(--font-size-base, 1em);
  @include nok-mixins.media-breakpoint-down(md) {
    font-size: calc(var(--font-size-base) * .9);
  }
}
body {
  --nok-body-text-color: var(--nok-darkerblue);
  background: linear-gradient(180deg, var(--nok-body--darker), var(--nok-body));
  @include nok-mixins.nok-text-font;
}
h1, h2, h3, h4, h5, h6, .nok-button { @include nok-mixins.nok-heading-font; line-height: var(--nok-default-heading-line-height, 1.1); }
// Heading font sizes (SOURCE: _nok-reboot.scss:89-117 via RFS)
h1 { @include nok-rfs.font-size(nok-variables.$h1-font-size); }
h2 { @include nok-rfs.font-size(nok-variables.$h2-font-size); }
h3 { @include nok-rfs.font-size(nok-variables.$h3-font-size); }
h4 { @include nok-rfs.font-size(nok-variables.$h4-font-size); }
h5 { @include nok-rfs.font-size(nok-variables.$h5-font-size); }
h6 { @include nok-rfs.font-size(nok-variables.$h6-font-size); }
.nok-fs-giant { @include nok-rfs.rfs((nok-variables.$h1-font-size * 1.5), font-size); }

svg.nok-icon { vertical-align: middle; width: 1em; height: 1em; }

// =============================================================================
// 5. NAVIGATION STRUCTURE (position, display, z-index — not decorative styles)
// =============================================================================
nok-top-navigation {
  font-size: 1.2rem;
}
@include nok-mixins.media-breakpoint-up(xl) {
  nok-top-navigation { position: sticky !important; top: 0; z-index: nok-variables.$z-stack-top; }
  nok-top-navigation nok-navigation-mobile { display: none !important; }
}
@include nok-mixins.media-breakpoint-down(xl) {
  nok-top-navigation {
    position: fixed !important; top: 0; bottom: 0;
    justify-content: flex-start;
    z-index: nok-variables.$z-stack-top !important;
    pointer-events: none;
  }
  nok-top-navigation nok-navigation-desktop { display: none !important; }
}
// Menu bar wrapper (custom element — NOT a class)
// SOURCE: _nok-navigation-menu-bar.scss:6-16
nok-navigation-menu-bar {
  display: flex; flex-direction: column; position: absolute;
  top: var(--nok-top-navigation-height);
  left: 0; right: 0;
  overflow: hidden; align-items: stretch; pointer-events: none;
}

// Menu bar inner (the visible white card)
// SOURCE: _nok-navigation-menu-bar.scss:17-37
.nok-navigation-menu-bar__inner {
  --grid-gap: var(--nok-padding-base, 1.5rem);
  display: flex; flex-direction: row; flex-wrap: nowrap;
  justify-content: space-between; align-items: center;
  gap: var(--grid-gap, var(--nok-global-grid-gap));
  padding: var(--grid-gap) var(--nok-padding-base, 1.5rem);
  border-radius: var(--nok-default-border-radius--large, 1rem);
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  height: 6rem;
  pointer-events: all;
  > * { flex-shrink: 0; }
  > *:first-child { flex-basis: 100%; flex-shrink: 1; }
  img, svg { align-self: center; height: 3.5rem; width: auto; }
}

// Top row inner (ratings bar)
// SOURCE: _nok-navigation-top-row.scss:8-27
.nok-navigation-top-row__inner {
  --grid-gap: var(--nok-padding-base, 1.5rem);
  font-size: 1rem; font-weight: 300;
  display: flex; flex-direction: row; flex-wrap: nowrap;
  justify-content: space-between; align-items: center;
  gap: var(--grid-gap, var(--nok-global-grid-gap));
  padding-top: var(--grid-gap, var(--nok-global-grid-gap));
  padding-bottom: var(--nok-top-navigation-height, 4rem);
  overflow: hidden;
  > * { flex-shrink: 0; }
  > *:first-child { flex-basis: 100%; flex-shrink: 1; }
}

// Star ratings omitted — cosmetic, not layout (budget trim #1)

// --- FOUC prevention: hide drawers/panels before full CSS loads ---
// These transforms match the closed state in the component SCSS.
// No transitions here — elements start hidden instantly.
// Dropdown: display:none is overridden by higher-specificity full CSS selector
// (nok-navigation-menu-bar nok-nav-menu-bar-dropdown → specificity 0,0,2)
nok-nav-menu-bar-dropdown { display: none; }
nok-navigation-drawer { display: block; transform: translate3d(100%, 0%, 0); }
// Same inline-element issue as dropdown: transform ignored on inline custom elements
nok-accessibility-helper { display: none; }
nok-screen-mask { position: fixed; inset: 0; pointer-events: none; --bg-alpha-value: 0; }
nok-popup { opacity: 0; visibility: hidden; pointer-events: none; }

// =============================================================================
// 6. HERO STRUCTURE (grid, sizing — not decorative styles)
// =============================================================================
nok-hero {
  --grid-gap: var(--nok-padding-base, var(--nok-global-grid-gap, 1.5rem));
  --footer-height: 0;
}
nok-hero:has(footer) { --footer-height: 6rem; }
nok-hero:has(figure) {
  --figure-row-mobile: var(--section-max-width, 50vw);
}
nok-hero .nok-hero__inner {
  display: grid;
  width: 100%;
  // SOURCE: _nok-hero.scss:16-25 — 3 rows (was incorrectly 4 rows)
  grid-template-columns: repeat(var(--grid-columns, 2), var(--grid-column-size, 1fr));
  grid-template-rows: calc(var(--nok-top-navigation-height, 4rem) - 1rem) auto var(--footer-height);
  row-gap: var(--nok-spacing-section-ends, 1.5rem);
  column-gap: var(--column-gap, 0);
  border-radius: 0 0 calc(var(--nok-default-border-radius--large, 1rem) * 2.5) calc(var(--nok-default-border-radius--large, 1rem) * 2.5);
  position: relative;
  overflow: hidden;

  article, header {
    display: flex; flex-direction: column; flex-wrap: nowrap;
    align-items: flex-start; justify-content: center;
    z-index: calc(var(--z-base, 1) + 2);
    grid-row: 2 / 3; grid-column: 1 / 2;
    gap: var(--grid-gap);
    // SOURCE: _nok-hero.scss:46-50 — hero-specific typography
    h2 { @include nok-rfs.rfs(2.5rem, font-size); } // $h2-font-size * 1.25
    p { @include nok-rfs.rfs(1.1rem, font-size); margin-bottom: 0; }
  }
  figure {
    overflow: hidden; margin: 0;
    z-index: calc(var(--z-base, 1) + 1);
    grid-row: 1/-1; grid-column: 2 / 3;
    max-height: 750px;
    // Gradient vars for hero SVG (without these, oklch(from ...) falls back to black)
    --grad-1-1: var(--nok-lightblue);
    --grad-1-2: var(--nok-green);
    --grad-1-3: var(--nok-yellow);
    --base-layer: var(--nok-body--darker);
  }
  article, figure { position: relative; }
  footer {
    grid-column: 1 / -1; grid-row: 3;
    z-index: calc(var(--z-base, 1) + 3);
    align-self: stretch;
    display: flex; flex-direction: row; flex-wrap: nowrap;
    justify-content: space-between; align-items: center;
    gap: var(--nok-padding-base, 1.5rem);
    padding: var(--nok-padding-base, 1.5rem);
    .nok-usp {
      display: flex; flex-direction: row; flex-wrap: nowrap;
      align-items: center; gap: calc(var(--grid-gap, 1.5rem) / 2);
    }
  }
}
// Hero responsive breakpoints omitted — deferred CSS covers (budget trim #2)

// --- Fullscreen hero variant (campaign pages) ---
nok-hero.nok-hero--fullscreen {
  display: flex; width: 100%;
  .nok-hero-fullscreen__container {
    position: relative; display: flex; flex-direction: column;
    min-height: calc(100svh - var(--nok-top-navigation-height, 4rem) * 2);
    overflow: hidden; width: 100%; align-self: stretch;
  }
  .nok-hero-fullscreen__figure { position: absolute; inset: 0; margin: 0; }
  .nok-hero-fullscreen__figure img { width: 100%; height: 100%; object-fit: cover; }
  .nok-hero-fullscreen__overlay { position: absolute; inset: 0; }
  .nok-hero-fullscreen__content { display: flex; align-items: center; justify-content: center; flex: 1; position: relative; z-index: 2; }
  @include nok-mixins.media-breakpoint-down(nok-variables.$mobile-breakpoint) {
    .nok-hero-fullscreen__container { min-height: 100svh; }
    .nok-hero-fullscreen__content { align-items: flex-end; padding-top: calc(var(--nok-top-navigation-height, 6rem) + 1.5rem); }
  }
}

// =============================================================================
// 7. SECTION BASE (prevents layout shift)
// =============================================================================
.nok-section, nok-section {
  position: relative; display: flex; width: 100%; padding: 0; margin: 0;
  flex-direction: column; flex-wrap: nowrap;
  justify-content: center; align-items: center;
  overflow-x: clip; font-size: 1.1rem;
}
.nok-section__inner--stretched { align-self: stretch; }
// SOURCE: _nok-sections.scss:31-84
.nok-section__inner {
  width: 100%;
  // NOTE: double-nok prefix is correct (--nok-nok-spacing-section-sides)
  padding-right: var(--nok-nok-spacing-section-sides, 3rem);
  padding-left: var(--nok-nok-spacing-section-sides, 3rem);
  margin: var(--nok-spacing-section-ends, 1.5rem) auto;
  max-width: 1572px; // single value instead of per-breakpoint loop (budget trim #3)
}

// =============================================================================
// 8. BUTTON BASE (prevents FOUT-triggered reflow from buttons)
// =============================================================================
.nok-button {
  display: inline-flex; align-items: center; justify-content: center; gap: 0.5em;
  padding: 0.5em 1.25em;
  border-radius: var(--nok-default-border-radius--large);
  white-space: nowrap;
  cursor: pointer;
  background-color: var(--bg-color, inherit);
  color: var(--bg-color--contrast, var(--text-color, inherit));
  // font via grouped selector above (h1-h6, .nok-button)
}
// Button group — needed for hero 2-column button layout
.nok-button-group {
  display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr;
  width: 100%; gap: var(--grid-gap, 1.5rem);
  align-items: center; justify-items: center;
  font-size: var(--nok-font-size-buttons, 1.25rem);
  > .fill-group-column { width: 100%; }
}
// Hyperlink (underline style links in hero)
.nok-hyperlink { text-decoration: underline; text-underline-offset: 0.2em; font-weight: bold; }

// =============================================================================
// 9. LAYOUT GRID (used in hero and nav)
// =============================================================================
.nok-layout-grid {
  display: grid;
  --grid-gap: var(--nok-space-fluid-md, var(--nok-padding-base, 1.5rem));
  gap: var(--grid-gap);
  grid-template-columns: repeat(var(--grid-columns, 1), 1fr);
}

// =============================================================================
// 10. HAND-PICKED UTILITY CLASSES (~30 used above the fold)
// =============================================================================

// Z-index
@for $i from 1 through 3 {
  .nok-z-#{$i} { --z-base: #{$i}; z-index: var(--z-base, $i); }
}

// Spacing
.nok-mt-0    { margin-top: 0 !important; }
.nok-my-0    { margin-top: 0 !important; margin-bottom: 0 !important; }
.nok-mb-0_5  { margin-bottom: var(--nok-space-fluid-sm) !important; }
.nok-px-0    { padding-right: 0 !important; padding-left: 0 !important; }
.nok-px-section-padding { padding-right: var(--nok-spacing-section-ends) !important; padding-left: var(--nok-spacing-section-ends) !important; }
.nok-pl-section-padding { padding-left: var(--nok-spacing-section-ends) !important; }
@include nok-mixins.media-breakpoint-down(lg) {
  .nok-px-to-lg-section-padding { padding-right: var(--nok-spacing-section-ends) !important; padding-left: var(--nok-spacing-section-ends) !important; }
  .nok-pt-to-lg-1  { padding-top: var(--nok-space-fluid-md) !important; }
  .nok-pb-to-lg-0_5 { padding-bottom: var(--nok-space-fluid-sm) !important; }
}

// Font size
.nok-fs-buttons { font-size: var(--nok-font-size-buttons); }
@for $i from 1 through 7 { .nok-fs-#{$i} { font-size: var(--nok-font-size-#{$i}) !important; } }
@include nok-mixins.media-breakpoint-down(lg) {
  .nok-fs-to-lg-3 { font-size: var(--nok-font-size-3) !important; }
}

// Visibility
@include nok-mixins.media-breakpoint-up(sm) {
  .nok-invisible-sm { display: none !important; }
  .nok-visible-xs   { display: none !important; }
}
@include nok-mixins.media-breakpoint-down(sm)   { .nok-invisible-to-sm   { display: none !important; } }
@include nok-mixins.media-breakpoint-down(lg)   { .nok-invisible-to-lg   { display: none !important; } }
@include nok-mixins.media-breakpoint-down(xl)   { .nok-invisible-to-xl   { display: none !important; } }
@include nok-mixins.media-breakpoint-down(xxxl) { .nok-invisible-to-xxxl { display: none !important; } }

// Alignment
.nok-align-self-stretch  { align-self: stretch !important; grid-column: 1 / -1 !important; }
.nok-align-items-stretch { align-items: stretch !important; }
.nok-justify-items-start { justify-items: flex-start !important; }
.nok-justify-self-center { justify-self: center !important; }

// Alpha
.nok-bg-alpha-6 { --bg-alpha-value: 0.6; }
@media (prefers-color-scheme: dark) {
  .nok-dark-bg-alpha-10 { --bg-alpha-value: 1; }
}

// Border
@include nok-mixins.media-breakpoint-down(sm) { .nok-border-radius-to-sm-0 { border-radius: 0 !important; } }
@include nok-mixins.media-breakpoint-down(lg) { .nok-border-bottom-to-lg-1 { border-bottom: 1px solid oklch(from var(--text-base, var(--text-color)) l c h/0.25) !important; } }

// Misc
.nok-bg-blur { backdrop-filter: blur(5px); &--large { backdrop-filter: blur(10px); } }
.nok-sticky  { position: sticky; top: 0; z-index: nok-variables.$z-stack-top; }
