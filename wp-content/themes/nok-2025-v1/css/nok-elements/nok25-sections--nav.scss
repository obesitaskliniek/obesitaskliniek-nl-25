@use "sass:map";
@use "../nok-variables";
@use "../nok-colors";
@use "../nok-mixins";
@use "../nok-rfs";
@use "../nok-utilities";

/**
 * hero unit
 */

@mixin menu-flex($gap) {
  --grid-gap: #{$gap};
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  justify-content: space-between;
  align-items: center;

  gap: var(--grid-gap, var(--global-grid-gap));

  padding-top: calc(var(--grid-gap, var(--global-grid-gap)) * .75);
  padding-bottom: calc(var(--grid-gap, var(--global-grid-gap)) * .75);

  > * {
    flex-shrink: 0;

    &:first-child {
      flex-basis: 100%;
      flex-shrink: 1;
    }
  }
}

$component-name: #{nok-variables.$prefix}-nav;

.#{$component-name} {
  $z_base: 0;
  --bs-navbar-toggler-icon-bg: #{nok-utilities.escape-svg(url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke='#{map.get(nok-colors.$nok-base-colors, darkerblue)}' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg>"))};
  --bs-navbar-toggler-icon-bg-active: #{nok-utilities.escape-svg(url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' class='bi bi-x-lg' viewBox='0 0 16 16'><path fill='#{map.get(nok-colors.$nok-base-colors, darkerblue)}' d='M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z'/></svg>"))};

  nok-25-mobile-nav, nok-25-mobile-nav {
    display: contents;
  }

  @include nok-mixins.media-breakpoint-up(lg) {
    nok-25-mobile-nav {
      display: none !important;
    }
  }
  @include nok-mixins.media-breakpoint-down(lg) {
    nok-25-desktop-nav {
      display: none !important;
    }
  }

  &-menu-toggler.nok25-button {
    background-image: var(--bs-navbar-toggler-icon-bg);
    background-repeat: no-repeat;
    background-position: center;
    background-size: 75%;
    vertical-align: middle;
    aspect-ratio: 1 / 1;
    box-shadow: none;
    transform: rotate(0deg);
    transition: transform .3s ease-in-out;
  }

  &-mask {
    --local-bg-color-alpha: 0;
    inset: 0;
    position: fixed;
    z-index: 2;
    pointer-events: none;
    transition: background 500ms ease-in-out, backdrop-filter 500ms ease-in-out;
  }

  &.open {
    .#{$component-name}-mask {
      backdrop-filter: blur(5px);
      --local-bg-color-alpha: 0.5;
      pointer-events: all;
    }

    .#{$component-name}-dropdown {
      transform: translateY(0);
    }

    .#{$component-name}-menu-toggler {
      background-image: var(--bs-navbar-toggler-icon-bg-active);
      transform: rotate(-180deg);
    }
  }

  nok-25-desktop-nav {
    .#{$component-name}-top {
      z-index: $z_base + 1;
      @include nok-mixins.nok-text-font;
      @include nok-rfs.rfs(1rem, font-size);
      font-weight: 300;

      @include menu-flex(var(--nok25-padding-base, var(--global-grid-gap, 1.5rem)));

      &-row {
        padding-bottom: 2rem;
        overflow: hidden;
      }
    }

    .#{$component-name}-menubar {
      z-index: $z_base + 3;
      @include menu-flex(var(--nok25-padding-base, var(--global-grid-gap, 1.5rem)));
      @include nok-mixins.nok-border-radius('large');
      @include nok-mixins.nok-subtle-shadow;

      padding-left: var(--nok25-padding-base, 1.5rem);
      padding-right: var(--nok25-padding-base, 1.5rem);
      height: 6rem;

      overflow: hidden;

      @include nok-mixins.nok-font;
      @include nok-rfs.rfs(1.2rem, font-size);
      font-weight: 500;

      img, svg {
        align-self: center;
        height: 3.5rem;
        @include nok-rfs.rfs(3.5rem, height);
        width: auto;
      }

      &-row {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        position: absolute;
        top: 4rem;
        overflow: hidden; // stops the dropdown from appearing at the top when collapsed
      }
    }

    .#{$component-name}-dropdown {
      z-index: $z_base + 2;
      display: grid;
      grid-template-rows: 1fr;
      overflow: hidden;
      justify-content: center;

      margin-top: calc(-1 * var(--nok25-default-border-radius--large, 0));
      margin-left: var(--nok25-default-border-radius--large, 0); //prevents the dropdown from appearing at the top sides when collapsed due to border radius on the menubar
      margin-right: var(--nok25-default-border-radius--large, 0); //prevents the dropdown from appearing at the top sides when collapsed due to border radius on the menubar
      transform: translateY(-100%);
      transition: transform .65s cubic-bezier(.85, 0, .15, 1);

      &.open {
        transform: translateY(0);
      }

      &-collapser {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      &-contents {
        --grid-gap: var(--nok25-padding-base, var(--global-grid-gap, 1.5rem));
        display: inline-flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: stretch;
        align-self: center;

        gap: var(--grid-gap, var(--global-grid-gap));
        @include nok-mixins.nok-border-radius('large', 'bottom');
        @include nok-mixins.nok-subtle-shadow;

        width: max-content;
        overflow: hidden;
        padding: calc(var(--grid-gap, var(--nok25-padding-base, 1.5rem)) * 2);

        > * {
          flex-basis: 50%;
          min-width: 0;
          flex-shrink: 1;
        }

        &-menu {
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          padding: calc(var(--grid-gap, var(--nok25-padding-base, 1.5rem)) / 2) 0;
        }

        h2 {
          @include nok-rfs.rfs(2rem, font-size);
        }

        h3 {
          @include nok-rfs.rfs(1.5rem, font-size);
        }

        ul {
          list-style-type: none;
          padding: 0;
          font-weight: 300;
        }
      }
    }

    /*
    @include nok-mixins.media-breakpoint-down(lg) {
      position: fixed !important;
      bottom: 0;
      .#{$component-name}-top-row {
        order: 2;
      }
      .#{$component-name}-menubar-row {
        order: 1;
        position: relative;
        flex-basis: 100%;
        padding: 0;
        top: 0;

        .#{$component-name}-menubar {

          flex-basis: 100%;
          flex-direction: column;
          justify-content: flex-start;
          align-items: stretch;
          padding: 0;
          gap: 0;
          background-color: var(--nok25-darkblue--darker--contrast);

          > * {
            padding: var(--grid-gap, 1.5rem);
          }
          > :nth-child(1) {
            background-color: var(--nok25-white);
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: space-between;
            flex-basis: auto;
          }

        }

        .#{$component-name}-dropdown {
          transform: none;
          margin: 0;
        }
      }
    }//*/
  }

  nok-25-mobile-nav {

    img, svg {
      align-self: center;
      height: 3.5rem;
      @include nok-rfs.rfs(3.5rem, height);
      width: auto;
    }

  }
}