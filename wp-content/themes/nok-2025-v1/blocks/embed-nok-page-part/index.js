(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,i=window.wp.data,o=window.wp.i18n,r=window.wp.element,l=window.ReactJSXRuntime,a="nok-2025-v1",d=({value:e,options:t,onChange:i,onOpen:o})=>{const[a,d]=(0,r.useState)(!1),[s,c]=(0,r.useState)(null),p=(0,r.useRef)(),u=t.find(t=>t.value===e);return(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsxs)(n.Button,{ref:p,variant:"secondary",onClick:()=>{const e=!a;d(e),e&&o&&o()},style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"end",color:"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:u?.label||"Select Page Part..."},style:{flexBasis:"100%"}}),u?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${u.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555",marginLeft:"auto"}}):null]}),a&&(0,l.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999},children:[(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent"},onClick:()=>d(!1)}),(0,l.jsx)("div",{style:{position:"absolute",top:p.current?.getBoundingClientRect().bottom+window.scrollY,left:p.current?.getBoundingClientRect().left+window.scrollX,width:p.current?.offsetWidth||"auto",maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"2px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",zIndex:1e5},children:t.map(t=>(0,l.jsxs)(n.Button,{onClick:()=>{i(t.value),d(!1)},onMouseEnter:()=>c(t.value),onMouseLeave:()=>c(null),style:{width:"100%",textAlign:"left",padding:"8px 12px",border:"none",borderBottom:"1px solid #f0f0f1",borderRadius:"0",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",justifyContent:"space-between",backgroundColor:t.value===e?"var(--wp-admin-theme-color)":s===t.value?"#e6f3ff":"transparent",color:t.value===e?"white":"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}}),t.value?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${t.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null]},t.value))})]})]})};(0,e.registerBlockType)("nok2025/embed-nok-page-part",{edit:({attributes:e,setAttributes:s})=>{const{postId:c,overrides:p}=e,{invalidateResolution:u}=(0,i.useDispatch)("core"),g=(0,i.useSelect)(e=>e("core").getEntityRecords("postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}),[])||[],x="undefined"!=typeof window&&window.PagePartDesignSettings&&window.PagePartDesignSettings.registry||{},m=g.find(e=>e.id===c),h=x[m?.meta?.design_slug||""]||{},b=(h.custom_fields||[]).filter(e=>e.page_editable),f=(0,i.useSelect)(e=>{const t=p._override_thumbnail_id;return t?e("core").getMedia(t):null},[p._override_thumbnail_id]),v=[{label:(0,o.__)(" - Selecteer Page Part blok… - ",a),value:0},...g.map(e=>{const t=e.meta&&e.meta.design_slug||"",n=x[t]&&x[t].name?x[t].name:t||"Unknown";return{label:`${e.title.rendered}`,template:n,value:e.id}})],_=c?`/wp-json/nok-2025-v1/v1/embed-page-part/${c}?${new URLSearchParams(Object.entries(p).map(([e,t])=>[e,t])).toString()}`:"",w=(0,r.useRef)(null),[y,j]=(0,r.useState)(400);return(0,r.useEffect)(()=>{const e=w.current;if(!e)return;let t;const n=()=>{try{const t=e.contentDocument||e.contentWindow.document,n=Math.max(t.documentElement.scrollHeight,t.body.scrollHeight);j(n)}catch(e){}},i=()=>{n(),e.contentDocument&&e.contentDocument.body&&(t=new MutationObserver(n),t.observe(e.contentDocument.body,{childList:!0,subtree:!0,attributes:!0}))};return e.addEventListener("load",i),()=>{e.removeEventListener("load",i),t&&t.disconnect()}},[c]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.BlockControls,{}),(0,l.jsxs)("div",{...(0,t.useBlockProps)(),style:{position:"relative",width:"100%",margin:"0",maxWidth:"100%"},children:[(0,l.jsxs)(n.PanelBody,{title:(0,o.__)("NOK Page Part Blok",a),initialOpen:!0,children:[(0,l.jsx)(d,{label:(0,o.__)("Selecteer een Page Part uit de lijst",a),value:c,options:v,onChange:e=>s({postId:parseInt(e,10)}),onOpen:()=>{u("getEntityRecords",["postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}])}}),b.length>0&&0!==c&&(0,l.jsxs)(n.PanelBody,{title:(0,o.__)("Pagina-afhankelijke overrides",a),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Deze page part biedt de mogelijkheid om enkele instellingen specifek voor deze pagina te overschrijven/herdefinieren:"}),b.map(e=>{const t=p[e.meta_key]||"",i=t=>{const n={...p};""===t||null===t?delete n[e.meta_key]:n[e.meta_key]=t,s({overrides:n})};switch(e.type){case"select":const o=e.options||[],r=e.option_labels||o;return(0,l.jsx)(n.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"— Gebruik de ingestelde waarde —",value:""},...o.map((e,t)=>({label:r[t]||e,value:e}))],onChange:i},e.meta_key);case"checkbox":return(0,l.jsx)(n.CheckboxControl,{label:`Override ${e.label}`,checked:"1"===t,onChange:e=>i(e?"1":"")},e.meta_key);case"text":case"url":return(0,l.jsx)(n.TextControl,{label:`Override ${e.label}`,value:t,onChange:i,placeholder:"— Gebruik de ingestelde waarde —"},e.meta_key);default:return null}})]}),0!==c&&h.featured_image_overridable&&(0,l.jsxs)(n.PanelBody,{title:(0,o.__)("Uitgelichte afbeelding",a),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Overschrijf de uitgelichte afbeelding van deze page part specifiek voor deze pagina."}),(0,l.jsx)(t.MediaUploadCheck,{children:(0,l.jsx)(t.MediaUpload,{onSelect:e=>{const t={...p};t._override_thumbnail_id=e.id,s({overrides:t})},allowedTypes:["image"],value:p._override_thumbnail_id||"",render:({open:e})=>(0,l.jsxs)("div",{children:[f&&(0,l.jsx)("div",{style:{marginBottom:"12px",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden",maxWidth:"200px"},children:(0,l.jsx)("img",{src:f.media_details?.sizes?.medium?.source_url||f.media_details?.sizes?.thumbnail?.source_url||f.source_url,style:{width:"100%",height:"auto",display:"block"},alt:""})}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,l.jsx)(n.Button,{variant:"secondary",onClick:e,children:f?(0,o.__)("Wijzig afbeelding",a):(0,o.__)("Selecteer afbeelding",a)}),f&&(0,l.jsx)(n.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{const e={...p};delete e._override_thumbnail_id,s({overrides:e})},children:(0,o.__)("Verwijder override",a)})]})]})})})]})]}),0===c?(0,l.jsx)("div",{style:{padding:"40px 20px",textAlign:"center",backgroundColor:"#f0f0f1",border:"1px dashed #ccc"},children:(0,l.jsx)("p",{style:{margin:0,color:"#666"},children:(0,o.__)("Selecteer een Page Part om de preview te zien",a)})}):(0,l.jsx)("iframe",{ref:w,src:_,style:{width:"100%",height:`${y}px`,border:"none"}})]})]})},save:()=>null})})();