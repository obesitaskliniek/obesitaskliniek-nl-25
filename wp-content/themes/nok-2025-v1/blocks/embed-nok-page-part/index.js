(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,i=window.wp.data,o=window.wp.i18n,r=window.wp.element,l=window.ReactJSXRuntime,d=({value:e,onChange:t,icons:n})=>{const[i,o]=(0,r.useState)(!1),[d,a]=(0,r.useState)(""),s=Object.entries(n).flatMap(([e,t])=>Object.entries(t).map(([t,n])=>({name:t,svg:n,category:e}))),c=s.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),p=s.find(t=>t.name===e);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("style",{children:"\n        svg.nok-icon {\n            width: 100%;\n            height: 100%;\n            display: block;\n        }\n    "}),(0,l.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,l.jsx)("label",{style:{display:"block",fontSize:"12px",fontWeight:"600",marginBottom:"8px"},children:"Icon"}),(0,l.jsx)("div",{onClick:()=>o(!i),style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#fff",minHeight:"40px"},children:p?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{width:"24px",height:"24px",flexShrink:0},dangerouslySetInnerHTML:{__html:p.svg}}),(0,l.jsx)("span",{style:{fontSize:"13px"},children:p.name})]}):(0,l.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:"Select an icon..."})}),i&&(0,l.jsxs)("div",{style:{position:"absolute",zIndex:9999,background:"#fff",border:"1px solid #ddd",borderRadius:"4px",marginTop:"4px",maxHeight:"400px",width:"300px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",overflow:"hidden"},children:[(0,l.jsx)("input",{type:"text",placeholder:"Search icons...",value:d,onChange:e=>a(e.target.value),style:{width:"100%",padding:"8px",border:"none",borderBottom:"1px solid #ddd",fontSize:"13px",outline:"none"}}),(0,l.jsx)("div",{style:{overflowY:"auto",maxHeight:"350px",padding:"8px"},children:0===c.length?(0,l.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"},children:"No icons found"}):(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:c.map(n=>(0,l.jsx)("div",{onClick:()=>{t(n.name),o(!1),a("")},title:n.name,style:{padding:"2px",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",background:e===n.name?"#e0f0ff":"#fff",transition:"all 0.15s",aspectRatio:"1"},onMouseEnter:t=>{e!==n.name&&(t.currentTarget.style.background="#f5f5f5")},onMouseLeave:t=>{e!==n.name&&(t.currentTarget.style.background="#fff")},children:(0,l.jsx)("div",{style:{width:"3em",height:"3em"},dangerouslySetInnerHTML:{__html:n.svg}})},n.name))})})]})]})]})},a="nok-2025-v1",s=({value:e,options:t,onChange:i,onOpen:o})=>{const[d,a]=(0,r.useState)(!1),[s,c]=(0,r.useState)(null),p=(0,r.useRef)(),u=t.find(t=>t.value===e);return(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsxs)(n.Button,{ref:p,variant:"secondary",onClick:()=>{const e=!d;a(e),e&&o&&o()},style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"end",color:"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:u?.label||"Select Page Part..."},style:{flexBasis:"100%"}}),u?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${u.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555",marginLeft:"auto"}}):null]}),d&&(0,l.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999},children:[(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent"},onClick:()=>a(!1)}),(0,l.jsx)("div",{style:{position:"absolute",top:p.current?.getBoundingClientRect().bottom+window.scrollY,left:p.current?.getBoundingClientRect().left+window.scrollX,width:p.current?.offsetWidth||"auto",maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"2px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",zIndex:1e5},children:t.map(t=>(0,l.jsxs)(n.Button,{onClick:()=>{i(t.value),a(!1)},onMouseEnter:()=>c(t.value),onMouseLeave:()=>c(null),style:{width:"100%",textAlign:"left",padding:"8px 12px",border:"none",borderBottom:"1px solid #f0f0f1",borderRadius:"0",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",justifyContent:"space-between",backgroundColor:t.value===e?"var(--wp-admin-theme-color)":s===t.value?"#e6f3ff":"transparent",color:t.value===e?"white":"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}}),t.value?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${t.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null]},t.value))})]})]})};(0,e.registerBlockType)("nok2025/embed-nok-page-part",{edit:({attributes:e,setAttributes:c})=>{const{postId:p,overrides:u}=e,{invalidateResolution:x}=(0,i.useDispatch)("core"),g=(0,i.useSelect)(e=>e("core").getEntityRecords("postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}),[])||[],h="undefined"!=typeof window&&window.PagePartDesignSettings&&window.PagePartDesignSettings.registry||{},m=g.find(e=>e.id===p),f=h[m?.meta?.design_slug||""]||{},b=(f.custom_fields||[]).filter(e=>e.page_editable),v=(0,i.useSelect)(e=>{const t=u._override_thumbnail_id;return t?e("core").getMedia(t):null},[u._override_thumbnail_id]),y=[{label:(0,o.__)(" - Selecteer Page Part blok… - ",a),value:0},...g.map(e=>{const t=e.meta&&e.meta.design_slug||"",n=h[t]&&h[t].name?h[t].name:t||"Unknown";return{label:`${e.title.rendered}`,template:n,value:e.id}})],_=p?`/wp-json/nok-2025-v1/v1/embed-page-part/${p}?${new URLSearchParams(Object.entries(u).map(([e,t])=>[e,t])).toString()}`:"",w=(0,r.useRef)(null),[j,k]=(0,r.useState)(400);return(0,r.useEffect)(()=>{const e=w.current;if(!e)return;let t;const n=()=>{try{const t=e.contentDocument||e.contentWindow.document,n=Math.max(t.documentElement.scrollHeight,t.body.scrollHeight);k(n)}catch(e){}},i=()=>{n(),e.contentDocument&&e.contentDocument.body&&(t=new MutationObserver(n),t.observe(e.contentDocument.body,{childList:!0,subtree:!0,attributes:!0}))};return e.addEventListener("load",i),()=>{e.removeEventListener("load",i),t&&t.disconnect()}},[p]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.BlockControls,{}),(0,l.jsxs)("div",{...(0,t.useBlockProps)(),style:{position:"relative",width:"100%",margin:"0",maxWidth:"100%"},children:[(0,l.jsxs)(n.PanelBody,{title:(0,o.__)("NOK Page Part Blok",a),initialOpen:!0,children:[(0,l.jsx)(s,{label:(0,o.__)("Selecteer een Page Part uit de lijst",a),value:p,options:y,onChange:e=>c({postId:parseInt(e,10)}),onOpen:()=>{x("getEntityRecords",["postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}])}}),b.length>0&&0!==p&&(0,l.jsxs)(n.PanelBody,{title:(0,o.__)("Pagina-afhankelijke overrides",a),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Deze page part biedt de mogelijkheid om enkele instellingen specifek voor deze pagina te overschrijven/herdefinieren:"}),b.map(e=>{const t=u[e.meta_key]||"",i=t=>{const n={...u};""===t||null===t?delete n[e.meta_key]:n[e.meta_key]=t,c({overrides:n})};switch(e.type){case"icon-selector":const o=window.PagePartDesignSettings?.icons||{};return(0,l.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,l.jsxs)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px",color:"#666"},children:["Override ",e.label]}),t&&(0,l.jsx)("button",{onClick:()=>i(""),style:{fontSize:"11px",color:"#d63638",background:"none",border:"none",padding:"0",marginBottom:"8px",cursor:"pointer",textDecoration:"underline"},children:"Clear override (gebruik de ingestelde waarde)"}),(0,l.jsx)(d,{value:t,icons:o,onChange:i})]},e.meta_key);case"select":const r=e.options||[],a=e.option_labels||r;return(0,l.jsx)(n.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"— Gebruik de ingestelde waarde —",value:""},...r.map((e,t)=>({label:a[t]||e,value:e}))],onChange:i},e.meta_key);case"checkbox":return(0,l.jsx)(n.CheckboxControl,{label:`Override ${e.label}`,checked:"1"===t,onChange:e=>i(e?"1":"")},e.meta_key);case"text":case"url":return(0,l.jsx)(n.TextControl,{label:`Override ${e.label}`,value:t,onChange:i,placeholder:"— Gebruik de ingestelde waarde —"},e.meta_key);default:return null}})]}),0!==p&&f.featured_image_overridable&&(0,l.jsxs)(n.PanelBody,{title:(0,o.__)("Uitgelichte afbeelding",a),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Overschrijf de uitgelichte afbeelding van deze page part specifiek voor deze pagina."}),(0,l.jsx)(t.MediaUploadCheck,{children:(0,l.jsx)(t.MediaUpload,{onSelect:e=>{const t={...u};t._override_thumbnail_id=e.id,c({overrides:t})},allowedTypes:["image"],value:u._override_thumbnail_id||"",render:({open:e})=>(0,l.jsxs)("div",{children:[v&&(0,l.jsx)("div",{style:{marginBottom:"12px",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden",maxWidth:"200px"},children:(0,l.jsx)("img",{src:v.media_details?.sizes?.medium?.source_url||v.media_details?.sizes?.thumbnail?.source_url||v.source_url,style:{width:"100%",height:"auto",display:"block"},alt:""})}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,l.jsx)(n.Button,{variant:"secondary",onClick:e,children:v?(0,o.__)("Wijzig afbeelding",a):(0,o.__)("Selecteer afbeelding",a)}),v&&(0,l.jsx)(n.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{const e={...u};delete e._override_thumbnail_id,c({overrides:e})},children:(0,o.__)("Verwijder override",a)})]})]})})})]})]}),0===p?(0,l.jsx)("div",{style:{padding:"40px 20px",textAlign:"center",backgroundColor:"#f0f0f1",border:"1px dashed #ccc"},children:(0,l.jsx)("p",{style:{margin:0,color:"#666"},children:(0,o.__)("Selecteer een Page Part om de preview te zien",a)})}):(0,l.jsx)("iframe",{ref:w,src:_,style:{width:"100%",height:`${j}px`,border:"none"}})]})]})},save:()=>null})})();