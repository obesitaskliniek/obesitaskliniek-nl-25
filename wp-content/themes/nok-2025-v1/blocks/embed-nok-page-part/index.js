(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,i=window.wp.components,n=window.ReactJSXRuntime,o=window.wp.primitives;var r=(0,n.jsx)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(o.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})});const s=window.wp.data,a=window.wp.i18n,l=window.wp.element,d=({value:e,onChange:t,icons:i})=>{const[o,r]=(0,l.useState)(!1),[s,a]=(0,l.useState)(""),d=Object.entries(i).flatMap(e=>Object.entries(e[1]).map(t=>({name:t[0],svg:t[1],category:e[0]}))),c=d.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())),p=d.find(t=>t.name===e);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("style",{children:"\n        svg.nok-icon {\n            width: 100%;\n            height: 100%;\n            display: block;\n        }\n    "}),(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,n.jsx)("label",{style:{display:"block",fontSize:"12px",fontWeight:"600",marginBottom:"8px"},children:"Icon"}),(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)("div",{onClick:()=>r(!o),style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#fff",minHeight:"40px"},children:p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{width:"24px",height:"24px",flexShrink:0},dangerouslySetInnerHTML:{__html:p.svg}}),(0,n.jsx)("span",{style:{fontSize:"13px"},children:p.name})]}):(0,n.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:"Select an icon..."})}),p&&(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),t("")},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#d63638",color:"#fff",border:"none",borderRadius:"3px",padding:"4px 8px",fontSize:"11px",cursor:"pointer",fontWeight:"500"},title:"Clear icon",children:"Ã—"})]}),o&&(0,n.jsxs)("div",{style:{position:"absolute",zIndex:9999,background:"#fff",border:"1px solid #ddd",borderRadius:"4px",marginTop:"4px",maxHeight:"400px",width:"300px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",overflow:"hidden"},children:[(0,n.jsx)("input",{type:"text",placeholder:"Search icons...",value:s,onChange:e=>a(e.target.value),style:{width:"100%",padding:"8px",border:"none",borderBottom:"1px solid #ddd",fontSize:"13px",outline:"none"}}),(0,n.jsx)("div",{style:{overflowY:"auto",maxHeight:"350px",padding:"8px"},children:0===c.length?(0,n.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"},children:"No icons found"}):(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:c.map(i=>(0,n.jsx)("div",{onClick:()=>{t(i.name),r(!1),a("")},title:i.name,style:{padding:"2px",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",background:e===i.name?"#e0f0ff":"#fff",transition:"all 0.15s",aspectRatio:"1"},onMouseEnter:t=>{e!==i.name&&(t.currentTarget.style.background="#f5f5f5")},onMouseLeave:t=>{e!==i.name&&(t.currentTarget.style.background="#fff")},children:(0,n.jsx)("div",{style:{width:"3em",height:"3em"},dangerouslySetInnerHTML:{__html:i.svg}})},i.name))})})]})]})]})},c={degsteps:60,startsat:100,startbri:100,startdeg:0,gradsteps:10,paletlim:[0,360]},p=new class{constructor(e,t,i,n,o,r){this.startdeg=null!=n?n:c.startdeg,this.degsteps=null!=e?e:c.degsteps,this.startsat=null!=t?t:c.startsat,this.startbri=null!=i?i:c.startbri,this.gradsteps=o&&o>1?o:c.gradsteps,this.paletlim=null!=r?r:c.paletlim,this.calls=0,this.color=null,this.deg=0,this.cyc=0,this.bri=100,this.sat=100,this.opa=1}new(e,t){return this.color=this._generateColor(e,t),this.string=this.color.string,this.values=this.color.values,this.contra=this.color.contra,this.hex=this._rgbToHex(this.color.values),this.calls++,this}adjust(e){var t,i,n,o;const r=null!==(t=e.deg)&&void 0!==t?t:0,s=null!==(i=e.sat)&&void 0!==i?i:this.sat,a=null!==(n=e.bri)&&void 0!==n?n:this.bri,l=null!==(o=e.opa)&&void 0!==o?o:this.opa,d=(this.deg+r)%this.paletlim[1],c=this._clamp(a<=1&&a>0?this.bri*a:a,0,100),p=this._clamp(s<=1&&s>0?this.sat*s:s,0,100),h=this._clamp(l,0,1);return this._hsvToRgb(d,p,c,h)}_generateColor(e,t){let i=!1;if("string"==typeof e)if("#"===e[0]){const t=this._hslToHsv(this._hexToHsl(e));this.deg=t[0],this.sat=t[1],this.bri=t[2],i=!0}else this.deg=this._stringToDegrees(e);else this.startdeg=Math.max(this.startdeg,this.paletlim[0]),this.deg=this.startdeg+this.calls*this.degsteps;if(this.cyc=Math.floor(this.deg/this.paletlim[1]),!i&&(this.bri=e&&e>0?e:this.startbri,this.sat=t&&t>0?t:this.startsat,this.bri=Math.abs(this.bri%101),this.sat=Math.abs(this.sat%101),this.deg=this.deg%(this.paletlim[1]+1),this.deg=Math.max(this.deg,this.paletlim[0]),this.paletlim[0]%this.degsteps===0&&this.cyc>0)){const t=this.cyc*this.gradsteps;this.bri=e&&e>0?e:this.startbri-t,t>=100&&(this.cyc=0,this.gradsteps=this.gradsteps/2)}return this._hsvToRgb(this.deg,this.sat,this.bri)}_stringToDegrees(e){const t=[...e].reduce((e,t)=>t.charCodeAt(0)+((e<<5)-e),0);return Math.abs(t)%360}_hsvToRgb(e,t,i,n){e/=360,t/=100,i/=100,n=void 0!==n?parseFloat(n):void 0;const o=Math.floor(6*e),r=6*e-o,s=i*(1-t),a=i*(1-r*t),l=i*(1-(1-r)*t);let d,c,p;switch(o%6){case 0:d=i,c=l,p=s;break;case 1:d=a,c=i,p=s;break;case 2:d=s,c=i,p=l;break;case 3:d=s,c=a,p=i;break;case 4:d=l,c=s,p=i;break;case 5:d=i,c=s,p=a}const h=[Math.round(255*d),Math.round(255*c),Math.round(255*p)],g=void 0!==n?"rgba":"rgb";return void 0!==n&&h.push(n),{values:h,string:`${g}(${h.join(",")})`,hex:this._rgbToHex(h),contra:this._textContrast(h)}}_hexToHsl(e){const t=this._hexToRgb(e),i=t[0]/255,n=t[1]/255,o=t[2]/255,r=Math.min(i,n,o),s=Math.max(i,n,o),a=s-r;let l=0;0!==a&&(l=s===i?(n-o)/a%6:s===n?(o-i)/a+2:(i-n)/a+4),l=Math.round(60*l),l<0&&(l+=360);const d=(s+r)/2;return[l,+(100*(0===a?0:a/(1-Math.abs(2*d-1)))).toFixed(1),+(100*d).toFixed(1)]}_hslToHsv(e){const t=e[1]*(e[2]<50?e[2]:100-e[2])/100,i=0===t?0:2*t/(e[2]+t)*100,n=e[2]+t;return[e[0],i,n]}_hexToRgb(e){return e.match(/\w\w/g).map(e=>+`0x${e}`)}_rgbToHex(e){return"#"+e.slice(0,3).map(e=>e.toString(16).padStart(2,"0")).join("")}_textContrast(e){return Math.round((299*parseInt(e[0])+587*parseInt(e[1])+114*parseInt(e[2]))/1e3)>125?"rgb(0,0,0)":"rgb(255,255,255)"}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}},h="nok-2025-v1",g=({value:e,options:t,onChange:o,onOpen:r})=>{const[s,a]=(0,l.useState)(!1),[d,c]=(0,l.useState)(null),h=(0,l.useRef)(),g=t.find(t=>t.value===e);return(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsxs)(i.Button,{ref:h,variant:"secondary",onClick:()=>{const e=!s;a(e),e&&r&&r()},style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"end",color:"inherit"},children:[(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:g?.label||"Select Page Part..."},style:{flexBasis:"100%"}}),g?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:`${g.template}`},style:{padding:"2px 6px",backgroundColor:p.new(g.template).string,borderRadius:"6px",fontSize:"1em",color:p.new(g.template).contra,marginLeft:"auto"}}):null]}),s&&(0,n.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999},children:[(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent"},onClick:()=>a(!1)}),(0,n.jsx)("div",{style:{position:"absolute",top:h.current?.getBoundingClientRect().bottom+window.scrollY,left:h.current?.getBoundingClientRect().left+window.scrollX,width:h.current?.offsetWidth||"auto",maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"2px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",zIndex:1e5},children:t.map(t=>{const r=p.new(t.template);return(0,n.jsxs)(i.Button,{onClick:()=>{o(t.value),a(!1)},onMouseEnter:()=>c(t.value),onMouseLeave:()=>c(null),style:{width:"100%",textAlign:"left",padding:"8px 12px",border:"none",borderBottom:"1px solid #f0f0f1",borderRadius:"0",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",justifyContent:"space-between",backgroundColor:t.value===e?"var(--wp-admin-theme-color)":d===t.value?"#e6f3ff":"transparent",color:t.value===e?"white":"inherit"},children:[(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}}),t.value?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:`${t.template}`},style:{padding:"2px 6px",backgroundColor:r.adjust({sat:.7}).string,borderRadius:"6px",fontSize:"1em",color:r.contra}}):null]},t.value)})})]})]})};(0,e.registerBlockType)("nok2025/embed-nok-page-part",{attributes:{postId:{type:"number",default:0},overrides:{type:"object",default:{}},excludeFromSeo:{type:"boolean",default:!1}},edit:({attributes:e,setAttributes:o})=>{const{postId:c,overrides:p,excludeFromSeo:u}=e,{invalidateResolution:x}=(0,s.useDispatch)("core"),b=(0,s.useSelect)(e=>e("core").getEntityRecords("postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}),[])||[],m="undefined"!=typeof window&&window.PagePartDesignSettings&&window.PagePartDesignSettings.registry||{},f=b.find(e=>e.id===c),v=f?.title?.rendered||"",y=m[f?.meta?.design_slug||""]||{},w=(y.custom_fields||[]).filter(e=>e.page_editable),_=(0,s.useSelect)(e=>{const t=p._override_thumbnail_id;return t?e("core").getMedia(t):null},[p._override_thumbnail_id]),j=[{label:(0,a.__)(" - Selecteer Page Part blokâ€¦ - ",h),value:0},...b.map(e=>{const t=e.meta&&e.meta.design_slug||"",i=m[t]&&m[t].name?m[t].name:t||"Unknown";return{label:`${e.title.rendered}`,template:i,value:e.id}})],k=c?`/wp-json/nok-2025-v1/v1/embed-page-part/${c}?${new URLSearchParams(Object.entries(p).map(([e,t])=>[e,t])).toString()}`:"",S=(0,l.useRef)(null),[C,P]=(0,l.useState)(400);return(0,l.useEffect)(()=>{const e=S.current;if(!e)return;let t;const i=()=>{try{const t=e.contentDocument||e.contentWindow.document,i=Math.max(t.documentElement.scrollHeight,t.body.scrollHeight);P(i)}catch(e){}},n=()=>{i();try{const t=(e.contentDocument||e.contentWindow.document).querySelector('meta[name="yoast-content"]');if(t&&c){const e=t.getAttribute("content");window.nokPagePartData=window.nokPagePartData||{},window.nokPagePartData[c]=e,window.nokYoastIntegration?.debug&&console.log(`[Yoast] Stored content for part ${c}:`,e.length,"chars")}}catch(e){}e.contentDocument&&e.contentDocument.body&&(t=new MutationObserver(i),t.observe(e.contentDocument.body,{childList:!0,subtree:!0,attributes:!0}))};return e.addEventListener("load",n),()=>{e.removeEventListener("load",n),t&&t.disconnect()}},[c]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.BlockControls,{}),(0,n.jsxs)("div",{...(0,t.useBlockProps)(),style:{position:"relative",width:"100%",marginBottom:"15px",maxWidth:"100%",padding:"15px 3vw",boxSizing:"border-box"},children:[u&&(0,n.jsx)("div",{style:{position:"absolute",top:"10px",right:"10px",background:"#f0f0f1",padding:"4px 8px",borderRadius:"3px",fontSize:"11px",color:"#666",zIndex:10,border:"1px solid #ddd"},children:"ðŸš« SEO uitgesloten"}),(0,n.jsxs)(i.PanelBody,{title:(0,a.__)("NOK Page Part Blok",h)+(v?` - ${v}`:""),initialOpen:!0,children:[(0,n.jsx)(g,{label:(0,a.__)("Selecteer een Page Part uit de lijst",h),value:c,options:j,onChange:e=>o({postId:parseInt(e,10)}),onOpen:()=>{x("getEntityRecords",["postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}])}}),0!==c&&(0,n.jsx)(i.PanelBody,{title:(0,a.__)("SEO Instellingen",h),initialOpen:!1,children:(0,n.jsx)(i.CheckboxControl,{label:(0,a.__)("Meenemen in SEO analyse",h),help:(0,a.__)("Schakel uit om deze page part uit te sluiten van Yoast SEO analyse",h),checked:!u,onChange:e=>{o({excludeFromSeo:!e}),window.nokYoastIntegration?.debug&&console.log(`[Yoast] Part ${c} SEO exclusion changed to:`,!e)}})}),w.length>0&&0!==c&&(0,n.jsxs)(i.PanelBody,{title:(0,a.__)("Pagina-afhankelijke overrides",h),initialOpen:!1,children:[(0,n.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Deze page part biedt de mogelijkheid om enkele instellingen specifek voor deze pagina te overschrijven/herdefinieren:"}),w.map(e=>{const t=p[e.meta_key]||"",r=t=>{const i={...p};""===t||null===t?delete i[e.meta_key]:i[e.meta_key]=t,o({overrides:i})};switch(e.type){case"icon-selector":const o=window.PagePartDesignSettings?.icons||{};return(0,n.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,n.jsxs)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px",color:"#666"},children:["Override ",e.label]}),t&&(0,n.jsx)("button",{onClick:()=>r(""),style:{fontSize:"11px",color:"#d63638",background:"none",border:"none",padding:"0",marginBottom:"8px",cursor:"pointer",textDecoration:"underline"},children:"Clear override (gebruik de ingestelde waarde)"}),(0,n.jsx)(d,{value:t,icons:o,onChange:r})]},e.meta_key);case"select":const s=e.options||[],a=e.option_labels||s;return(0,n.jsx)(i.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"â€” Gebruik de ingestelde waarde â€”",value:""},...s.map((e,t)=>({label:a[t]||e,value:e}))],onChange:r},e.meta_key);case"checkbox":return(0,n.jsx)(i.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"â€” Gebruik de ingestelde waarde â€”",value:""},{label:"Ja",value:"1"},{label:"Nee",value:"0"}],onChange:r},e.meta_key);case"text":case"url":return(0,n.jsx)(i.TextControl,{label:`Override ${e.label}`,value:t,onChange:r,placeholder:"â€” Gebruik de ingestelde waarde â€”"},e.meta_key);default:return null}})]}),0!==c&&y.featured_image_overridable&&(0,n.jsxs)(i.PanelBody,{title:(0,a.__)("Uitgelichte afbeelding",h),initialOpen:!1,children:[(0,n.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Overschrijf de uitgelichte afbeelding van deze page part specifiek voor deze pagina."}),(0,n.jsx)(t.MediaUploadCheck,{children:(0,n.jsx)(t.MediaUpload,{onSelect:e=>{const t={...p};t._override_thumbnail_id=e.id,o({overrides:t})},allowedTypes:["image"],value:p._override_thumbnail_id||"",render:({open:e})=>(0,n.jsxs)("div",{children:[_&&(0,n.jsx)("div",{style:{marginBottom:"12px",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden",maxWidth:"200px"},children:(0,n.jsx)("img",{src:_.media_details?.sizes?.medium?.source_url||_.media_details?.sizes?.thumbnail?.source_url||_.source_url,style:{width:"100%",height:"auto",display:"block"},alt:""})}),(0,n.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,n.jsx)(i.Button,{variant:"secondary",onClick:e,children:_?(0,a.__)("Wijzig afbeelding",h):(0,a.__)("Selecteer afbeelding",h)}),_&&(0,n.jsx)(i.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{const e={...p};delete e._override_thumbnail_id,o({overrides:e})},children:(0,a.__)("Verwijder override",h)})]})]})})})]}),0===c?(0,n.jsx)("div",{style:{padding:"40px 20px",textAlign:"center",backgroundColor:"#f0f0f1",border:"1px dashed #ccc"},children:(0,n.jsx)("p",{style:{margin:0,color:"#666"},children:(0,a.__)("Selecteer een Page Part om de preview te zien",h)})}):(0,n.jsxs)("div",{style:{marginTop:"15px",border:"1px solid rgba(0,0,0,0.6)",borderRadius:"10px",padding:"0",boxSizing:"border-box",overflow:"hidden",display:"flex",flexDirection:"column"},children:[(0,n.jsxs)("div",{style:{background:"rgba(0,0,0,0.1)",borderBottom:"1px solid rgba(0,0,0,0.6)",padding:"8px 12px",fontSize:"12px",display:"flex",alignItems:"center",gap:"12px"},children:[(0,n.jsx)("strong",{children:"Preview:"}),(0,n.jsx)("span",{children:f?.title.rendered||`ID ${c}`}),(0,n.jsx)("a",{href:`/wp-admin/post.php?post=${c}&action=edit`,target:"_blank",title:" Bewerk deze Page Part (in nieuw tabblad)",rel:"noopener noreferrer",style:{color:"#8cf",textDecoration:"none",marginLeft:"auto"},children:(0,n.jsx)(i.Icon,{icon:r})})]}),(0,n.jsx)("iframe",{ref:S,src:k,style:{width:"100%",height:`${C}px`,flexShrink:0}})]})]})]})]})},save:()=>null})})();