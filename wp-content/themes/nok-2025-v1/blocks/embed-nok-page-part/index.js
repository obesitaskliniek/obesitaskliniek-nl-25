(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,o=window.ReactJSXRuntime,i=window.wp.primitives;var r=(0,o.jsx)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(i.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})});const l=window.wp.data,a=window.wp.i18n,d=window.wp.element,s=({value:e,onChange:t,icons:n})=>{const[i,r]=(0,d.useState)(!1),[l,a]=(0,d.useState)(""),s=Object.entries(n).flatMap(([e,t])=>Object.entries(t).map(([t,n])=>({name:t,svg:n,category:e}))),c=s.filter(e=>e.name.toLowerCase().includes(l.toLowerCase())),p=s.find(t=>t.name===e);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("style",{children:"\n        svg.nok-icon {\n            width: 100%;\n            height: 100%;\n            display: block;\n        }\n    "}),(0,o.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"12px",fontWeight:"600",marginBottom:"8px"},children:"Icon"}),(0,o.jsx)("div",{onClick:()=>r(!i),style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#fff",minHeight:"40px"},children:p?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:{width:"24px",height:"24px",flexShrink:0},dangerouslySetInnerHTML:{__html:p.svg}}),(0,o.jsx)("span",{style:{fontSize:"13px"},children:p.name})]}):(0,o.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:"Select an icon..."})}),i&&(0,o.jsxs)("div",{style:{position:"absolute",zIndex:9999,background:"#fff",border:"1px solid #ddd",borderRadius:"4px",marginTop:"4px",maxHeight:"400px",width:"300px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",overflow:"hidden"},children:[(0,o.jsx)("input",{type:"text",placeholder:"Search icons...",value:l,onChange:e=>a(e.target.value),style:{width:"100%",padding:"8px",border:"none",borderBottom:"1px solid #ddd",fontSize:"13px",outline:"none"}}),(0,o.jsx)("div",{style:{overflowY:"auto",maxHeight:"350px",padding:"8px"},children:0===c.length?(0,o.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"},children:"No icons found"}):(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:c.map(n=>(0,o.jsx)("div",{onClick:()=>{t(n.name),r(!1),a("")},title:n.name,style:{padding:"2px",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",background:e===n.name?"#e0f0ff":"#fff",transition:"all 0.15s",aspectRatio:"1"},onMouseEnter:t=>{e!==n.name&&(t.currentTarget.style.background="#f5f5f5")},onMouseLeave:t=>{e!==n.name&&(t.currentTarget.style.background="#fff")},children:(0,o.jsx)("div",{style:{width:"3em",height:"3em"},dangerouslySetInnerHTML:{__html:n.svg}})},n.name))})})]})]})]})},c="nok-2025-v1",p=({value:e,options:t,onChange:i,onOpen:r})=>{const[l,a]=(0,d.useState)(!1),[s,c]=(0,d.useState)(null),p=(0,d.useRef)(),x=t.find(t=>t.value===e);return(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsxs)(n.Button,{ref:p,variant:"secondary",onClick:()=>{const e=!l;a(e),e&&r&&r()},style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"end",color:"inherit"},children:[(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:x?.label||"Select Page Part..."},style:{flexBasis:"100%"}}),x?(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:`${x.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555",marginLeft:"auto"}}):null]}),l&&(0,o.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999},children:[(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent"},onClick:()=>a(!1)}),(0,o.jsx)("div",{style:{position:"absolute",top:p.current?.getBoundingClientRect().bottom+window.scrollY,left:p.current?.getBoundingClientRect().left+window.scrollX,width:p.current?.offsetWidth||"auto",maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"2px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",zIndex:1e5},children:t.map(t=>(0,o.jsxs)(n.Button,{onClick:()=>{i(t.value),a(!1)},onMouseEnter:()=>c(t.value),onMouseLeave:()=>c(null),style:{width:"100%",textAlign:"left",padding:"8px 12px",border:"none",borderBottom:"1px solid #f0f0f1",borderRadius:"0",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",justifyContent:"space-between",backgroundColor:t.value===e?"var(--wp-admin-theme-color)":s===t.value?"#e6f3ff":"transparent",color:t.value===e?"white":"inherit"},children:[(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}}),t.value?(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:`${t.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null]},t.value))})]})]})};(0,e.registerBlockType)("nok2025/embed-nok-page-part",{attributes:{postId:{type:"number",default:0},overrides:{type:"object",default:{}},excludeFromSeo:{type:"boolean",default:!1}},edit:({attributes:e,setAttributes:i})=>{const{postId:x,overrides:u,excludeFromSeo:g}=e,{invalidateResolution:h}=(0,l.useDispatch)("core"),m=(0,l.useSelect)(e=>e("core").getEntityRecords("postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}),[])||[],b="undefined"!=typeof window&&window.PagePartDesignSettings&&window.PagePartDesignSettings.registry||{},f=m.find(e=>e.id===x),v=f?.title?.rendered||"",y=b[f?.meta?.design_slug||""]||{},w=(y.custom_fields||[]).filter(e=>e.page_editable),j=(0,l.useSelect)(e=>{const t=u._override_thumbnail_id;return t?e("core").getMedia(t):null},[u._override_thumbnail_id]),_=[{label:(0,a.__)(" - Selecteer Page Part blokâ€¦ - ",c),value:0},...m.map(e=>{const t=e.meta&&e.meta.design_slug||"",n=b[t]&&b[t].name?b[t].name:t||"Unknown";return{label:`${e.title.rendered}`,template:n,value:e.id}})],k=x?`/wp-json/nok-2025-v1/v1/embed-page-part/${x}?${new URLSearchParams(Object.entries(u).map(([e,t])=>[e,t])).toString()}`:"",S=(0,d.useRef)(null),[C,P]=(0,d.useState)(400);return(0,d.useEffect)(()=>{const e=S.current;if(!e)return;let t;const n=()=>{try{const t=e.contentDocument||e.contentWindow.document,n=Math.max(t.documentElement.scrollHeight,t.body.scrollHeight);P(n)}catch(e){}},o=()=>{n();try{const t=(e.contentDocument||e.contentWindow.document).querySelector('meta[name="yoast-content"]');if(t&&x){const e=t.getAttribute("content");window.nokPagePartData=window.nokPagePartData||{},window.nokPagePartData[x]=e,window.nokYoastIntegration?.debug&&console.log(`[Yoast] Stored content for part ${x}:`,e.length,"chars")}}catch(e){}e.contentDocument&&e.contentDocument.body&&(t=new MutationObserver(n),t.observe(e.contentDocument.body,{childList:!0,subtree:!0,attributes:!0}))};return e.addEventListener("load",o),()=>{e.removeEventListener("load",o),t&&t.disconnect()}},[x]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.BlockControls,{}),(0,o.jsxs)("div",{...(0,t.useBlockProps)(),style:{position:"relative",width:"100%",marginBottom:"15px",maxWidth:"100%",padding:"15px 3vw",boxSizing:"border-box"},children:[g&&(0,o.jsx)("div",{style:{position:"absolute",top:"10px",right:"10px",background:"#f0f0f1",padding:"4px 8px",borderRadius:"3px",fontSize:"11px",color:"#666",zIndex:10,border:"1px solid #ddd"},children:"ðŸš« SEO uitgesloten"}),(0,o.jsxs)(n.PanelBody,{title:(0,a.__)("NOK Page Part Blok",c)+(v?` - ${v}`:""),initialOpen:!0,children:[(0,o.jsx)(p,{label:(0,a.__)("Selecteer een Page Part uit de lijst",c),value:x,options:_,onChange:e=>i({postId:parseInt(e,10)}),onOpen:()=>{h("getEntityRecords",["postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}])}}),0!==x&&(0,o.jsx)(n.PanelBody,{title:(0,a.__)("SEO Instellingen",c),initialOpen:!1,children:(0,o.jsx)(n.CheckboxControl,{label:(0,a.__)("Meenemen in SEO analyse",c),help:(0,a.__)("Schakel uit om deze page part uit te sluiten van Yoast SEO analyse",c),checked:!g,onChange:e=>{i({excludeFromSeo:!e}),window.nokYoastIntegration?.debug&&console.log(`[Yoast] Part ${x} SEO exclusion changed to:`,!e)}})}),w.length>0&&0!==x&&(0,o.jsxs)(n.PanelBody,{title:(0,a.__)("Pagina-afhankelijke overrides",c),initialOpen:!1,children:[(0,o.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Deze page part biedt de mogelijkheid om enkele instellingen specifek voor deze pagina te overschrijven/herdefinieren:"}),w.map(e=>{const t=u[e.meta_key]||"",r=t=>{const n={...u};""===t||null===t?delete n[e.meta_key]:n[e.meta_key]=t,i({overrides:n})};switch(e.type){case"icon-selector":const i=window.PagePartDesignSettings?.icons||{};return(0,o.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,o.jsxs)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px",color:"#666"},children:["Override ",e.label]}),t&&(0,o.jsx)("button",{onClick:()=>r(""),style:{fontSize:"11px",color:"#d63638",background:"none",border:"none",padding:"0",marginBottom:"8px",cursor:"pointer",textDecoration:"underline"},children:"Clear override (gebruik de ingestelde waarde)"}),(0,o.jsx)(s,{value:t,icons:i,onChange:r})]},e.meta_key);case"select":const l=e.options||[],a=e.option_labels||l;return(0,o.jsx)(n.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"â€” Gebruik de ingestelde waarde â€”",value:""},...l.map((e,t)=>({label:a[t]||e,value:e}))],onChange:r},e.meta_key);case"checkbox":return(0,o.jsx)(n.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"â€” Gebruik de ingestelde waarde â€”",value:""},{label:"Ja",value:"1"},{label:"Nee",value:"0"}],onChange:r},e.meta_key);case"text":case"url":return(0,o.jsx)(n.TextControl,{label:`Override ${e.label}`,value:t,onChange:r,placeholder:"â€” Gebruik de ingestelde waarde â€”"},e.meta_key);default:return null}})]}),0!==x&&y.featured_image_overridable&&(0,o.jsxs)(n.PanelBody,{title:(0,a.__)("Uitgelichte afbeelding",c),initialOpen:!1,children:[(0,o.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Overschrijf de uitgelichte afbeelding van deze page part specifiek voor deze pagina."}),(0,o.jsx)(t.MediaUploadCheck,{children:(0,o.jsx)(t.MediaUpload,{onSelect:e=>{const t={...u};t._override_thumbnail_id=e.id,i({overrides:t})},allowedTypes:["image"],value:u._override_thumbnail_id||"",render:({open:e})=>(0,o.jsxs)("div",{children:[j&&(0,o.jsx)("div",{style:{marginBottom:"12px",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden",maxWidth:"200px"},children:(0,o.jsx)("img",{src:j.media_details?.sizes?.medium?.source_url||j.media_details?.sizes?.thumbnail?.source_url||j.source_url,style:{width:"100%",height:"auto",display:"block"},alt:""})}),(0,o.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,o.jsx)(n.Button,{variant:"secondary",onClick:e,children:j?(0,a.__)("Wijzig afbeelding",c):(0,a.__)("Selecteer afbeelding",c)}),j&&(0,o.jsx)(n.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{const e={...u};delete e._override_thumbnail_id,i({overrides:e})},children:(0,a.__)("Verwijder override",c)})]})]})})})]}),0===x?(0,o.jsx)("div",{style:{padding:"40px 20px",textAlign:"center",backgroundColor:"#f0f0f1",border:"1px dashed #ccc"},children:(0,o.jsx)("p",{style:{margin:0,color:"#666"},children:(0,a.__)("Selecteer een Page Part om de preview te zien",c)})}):(0,o.jsxs)("div",{style:{marginTop:"15px",border:"1px solid rgba(0,0,0,0.6)",borderRadius:"10px",padding:"0",boxSizing:"border-box",overflow:"hidden",display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{background:"rgba(0,0,0,0.1)",borderBottom:"1px solid rgba(0,0,0,0.6)",padding:"8px 12px",fontSize:"12px",display:"flex",alignItems:"center",gap:"12px"},children:[(0,o.jsx)("strong",{children:"Preview:"}),(0,o.jsx)("span",{children:f?.title.rendered||`ID ${x}`}),(0,o.jsx)("a",{href:`/wp-admin/post.php?post=${x}&action=edit`,target:"_blank",title:" Bewerk deze Page Part (in nieuw tabblad)",rel:"noopener noreferrer",style:{color:"#8cf",textDecoration:"none",marginLeft:"auto"},children:(0,o.jsx)(n.Icon,{icon:r})})]}),(0,o.jsx)("iframe",{ref:S,src:k,style:{pointerEvents:"none",width:"100%",height:`${C}px`,flexShrink:0}})]})]})]})]})},save:()=>null})})();