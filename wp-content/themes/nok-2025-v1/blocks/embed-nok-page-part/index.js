(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,o=window.wp.data,l=window.wp.i18n,r=window.wp.element,a=window.ReactJSXRuntime,i="nok-2025-v1",s=({value:e,options:t,onChange:o})=>{const[l,i]=(0,r.useState)(!1),[s,d]=(0,r.useState)(null),p=(0,r.useRef)(),c=t.find(t=>t.value===e);return(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsxs)(n.Button,{ref:p,variant:"secondary",onClick:()=>i(!l),style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"end",color:"inherit"},children:[(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:c?.label||"Select Page Part..."},style:{flexBasis:"100%"}}),c?(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:`${c.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null,(0,a.jsx)("span",{children:"▼"})]}),l&&(0,a.jsx)("div",{style:{position:"absolute",top:"100%",left:"0",right:"0",zIndex:999999,backgroundColor:"white",border:"1px solid #ccd0d4",borderRadius:"4px",boxShadow:"0 2px 6px rgba(0,0,0,0.05)",maxHeight:"300px",overflow:"hidden"},children:(0,a.jsx)("div",{style:{minWidth:"100%",maxHeight:"300px",backgroundColor:"white",border:"1px solid #ccd0d4",borderRadius:"4px",boxShadow:"0 2px 6px rgba(0,0,0,0.05)",overflow:"hidden auto"},children:t.map(t=>(0,a.jsxs)(n.Button,{variant:"tertiary",onMouseEnter:()=>d(t.value),onMouseLeave:()=>d(null),onClick:()=>{o(t.value),i(!1)},style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"space-between",backgroundColor:t.value===e?"var(--wp-admin-theme-color)":s===t.value?"#e6f3ff":"transparent",color:t.value===e?"white":"inherit"},children:[(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}}),t.value?(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:`${t.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null]},t.value))})})]})};(0,e.registerBlockType)("nok2025/embed-nok-page-part",{edit:({attributes:e,setAttributes:d})=>{const{postId:p,overrides:c}=e,u=(0,o.useSelect)(e=>e("core").getEntityRecords("postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}),[])||[],g="undefined"!=typeof window&&window.PagePartDesignSettings&&window.PagePartDesignSettings.registry||{},b=u.find(e=>e.id===p),x=((g[b?.meta?.design_slug||""]||{}).custom_fields||[]).filter(e=>e.page_editable),m=[{label:(0,l.__)(" - Selecteer Page Part blok… - ",i),value:0},...u.map(e=>{const t=e.meta&&e.meta.design_slug||"",n=g[t]&&g[t].name?g[t].name:t||"Unknown";return{label:`${e.title.rendered}`,template:n,value:e.id}})],h=p?`/wp-json/nok-2025-v1/v1/embed-page-part/${p}?${new URLSearchParams(Object.entries(c).map(([e,t])=>[e,t])).toString()}`:"",w=(0,r.useRef)(null),[v,f]=(0,r.useState)(400);return(0,r.useEffect)(()=>{const e=w.current;if(!e)return;let t;const n=()=>{try{const t=e.contentDocument||e.contentWindow.document,n=Math.max(t.documentElement.scrollHeight,t.body.scrollHeight);f(n)}catch(e){}},o=()=>{n(),e.contentDocument&&e.contentDocument.body&&(t=new MutationObserver(n),t.observe(e.contentDocument.body,{childList:!0,subtree:!0,attributes:!0}))};return e.addEventListener("load",o),()=>{e.removeEventListener("load",o),t&&t.disconnect()}},[p]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.BlockControls,{}),(0,a.jsxs)("div",{...(0,t.useBlockProps)(),style:{position:"relative",width:"100%",margin:"0",maxWidth:"100%"},children:[(0,a.jsxs)(n.PanelBody,{title:(0,l.__)("NOK Page Part Blok",i),initialOpen:!0,children:[(0,a.jsx)(s,{label:(0,l.__)("Selecteer een Page Part uit de lijst",i),value:p,options:m,onChange:e=>d({postId:parseInt(e,10)})}),x.length>0&&0!==p&&(0,a.jsxs)(n.PanelBody,{title:(0,l.__)("Pagina-afhankelijke overrides",i),initialOpen:!1,children:[(0,a.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Deze page part biedt de mogelijkheid om enkele instellingen specifek voor deze pagina te overschrijven/herdefinieren:"}),x.map(e=>{const t=c[e.meta_key]||"",o=t=>{const n={...c};""===t||null===t?delete n[e.meta_key]:n[e.meta_key]=t,d({overrides:n})};switch(e.type){case"select":const l=e.options||[],r=e.option_labels||l;return(0,a.jsx)(n.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"— Gebruik de ingestelde waarde —",value:""},...l.map((e,t)=>({label:r[t]||e,value:e}))],onChange:o},e.meta_key);case"checkbox":return(0,a.jsx)(CheckboxControl,{label:`Override ${e.label}`,checked:"1"===t,onChange:e=>o(e?"1":"0")},e.meta_key);default:return(0,a.jsx)(TextControl,{label:`Override ${e.label}`,value:t,onChange:o,placeholder:"Gebruik de ingestelde waarde"},e.meta_key)}})]})]}),p?(0,a.jsx)("div",{style:{position:"relative",width:"100%"},children:(0,a.jsx)("iframe",{ref:w,title:(0,l.__)("Embedded NOK Page Part",i),src:h,style:{width:"100%",height:`${v}px`,border:0},sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"},`${p}-${JSON.stringify(c)}`)}):(0,a.jsx)("p",{children:(0,l.__)("Selecteer een blok om te bekijken…",i)})]})]})},save:()=>null})})();