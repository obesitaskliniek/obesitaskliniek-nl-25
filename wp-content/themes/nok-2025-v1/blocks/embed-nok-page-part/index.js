(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,o=window.wp.data,i=window.wp.i18n,r=window.wp.element,l=window.ReactJSXRuntime,a=({value:e,onChange:t,icons:n})=>{const[o,i]=(0,r.useState)(!1),[a,d]=(0,r.useState)(""),s=Object.entries(n).flatMap(([e,t])=>Object.entries(t).map(([t,n])=>({name:t,svg:n,category:e}))),c=s.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())),p=s.find(t=>t.name===e);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("style",{children:"\n        svg.nok-icon {\n            width: 100%;\n            height: 100%;\n            display: block;\n        }\n    "}),(0,l.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,l.jsx)("label",{style:{display:"block",fontSize:"12px",fontWeight:"600",marginBottom:"8px"},children:"Icon"}),(0,l.jsx)("div",{onClick:()=>i(!o),style:{border:"1px solid #ddd",borderRadius:"4px",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#fff",minHeight:"40px"},children:p?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{width:"24px",height:"24px",flexShrink:0},dangerouslySetInnerHTML:{__html:p.svg}}),(0,l.jsx)("span",{style:{fontSize:"13px"},children:p.name})]}):(0,l.jsx)("span",{style:{fontSize:"13px",color:"#757575"},children:"Select an icon..."})}),o&&(0,l.jsxs)("div",{style:{position:"absolute",zIndex:9999,background:"#fff",border:"1px solid #ddd",borderRadius:"4px",marginTop:"4px",maxHeight:"400px",width:"300px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",overflow:"hidden"},children:[(0,l.jsx)("input",{type:"text",placeholder:"Search icons...",value:a,onChange:e=>d(e.target.value),style:{width:"100%",padding:"8px",border:"none",borderBottom:"1px solid #ddd",fontSize:"13px",outline:"none"}}),(0,l.jsx)("div",{style:{overflowY:"auto",maxHeight:"350px",padding:"8px"},children:0===c.length?(0,l.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"},children:"No icons found"}):(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px"},children:c.map(n=>(0,l.jsx)("div",{onClick:()=>{t(n.name),i(!1),d("")},title:n.name,style:{padding:"2px",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",background:e===n.name?"#e0f0ff":"#fff",transition:"all 0.15s",aspectRatio:"1"},onMouseEnter:t=>{e!==n.name&&(t.currentTarget.style.background="#f5f5f5")},onMouseLeave:t=>{e!==n.name&&(t.currentTarget.style.background="#fff")},children:(0,l.jsx)("div",{style:{width:"3em",height:"3em"},dangerouslySetInnerHTML:{__html:n.svg}})},n.name))})})]})]})]})},d="nok-2025-v1",s=({value:e,options:t,onChange:o,onOpen:i})=>{const[a,d]=(0,r.useState)(!1),[s,c]=(0,r.useState)(null),p=(0,r.useRef)(),u=t.find(t=>t.value===e);return(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsxs)(n.Button,{ref:p,variant:"secondary",onClick:()=>{const e=!a;d(e),e&&i&&i()},style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"end",color:"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:u?.label||"Select Page Part..."},style:{flexBasis:"100%"}}),u?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${u.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555",marginLeft:"auto"}}):null]}),a&&(0,l.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999},children:[(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent"},onClick:()=>d(!1)}),(0,l.jsx)("div",{style:{position:"absolute",top:p.current?.getBoundingClientRect().bottom+window.scrollY,left:p.current?.getBoundingClientRect().left+window.scrollX,width:p.current?.offsetWidth||"auto",maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"2px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",zIndex:1e5},children:t.map(t=>(0,l.jsxs)(n.Button,{onClick:()=>{o(t.value),d(!1)},onMouseEnter:()=>c(t.value),onMouseLeave:()=>c(null),style:{width:"100%",textAlign:"left",padding:"8px 12px",border:"none",borderBottom:"1px solid #f0f0f1",borderRadius:"0",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",justifyContent:"space-between",backgroundColor:t.value===e?"var(--wp-admin-theme-color)":s===t.value?"#e6f3ff":"transparent",color:t.value===e?"white":"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}}),t.value?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${t.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null]},t.value))})]})]})};(0,e.registerBlockType)("nok2025/embed-nok-page-part",{attributes:{postId:{type:"number",default:0},overrides:{type:"object",default:{}},excludeFromSeo:{type:"boolean",default:!1}},edit:({attributes:e,setAttributes:c})=>{const{postId:p,overrides:u,excludeFromSeo:g}=e,{invalidateResolution:x}=(0,o.useDispatch)("core"),h=(0,o.useSelect)(e=>e("core").getEntityRecords("postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}),[])||[],m="undefined"!=typeof window&&window.PagePartDesignSettings&&window.PagePartDesignSettings.registry||{},b=h.find(e=>e.id===p),f=m[b?.meta?.design_slug||""]||{},v=(f.custom_fields||[]).filter(e=>e.page_editable),y=(0,o.useSelect)(e=>{const t=u._override_thumbnail_id;return t?e("core").getMedia(t):null},[u._override_thumbnail_id]),w=[{label:(0,i.__)(" - Selecteer Page Part blokâ€¦ - ",d),value:0},...h.map(e=>{const t=e.meta&&e.meta.design_slug||"",n=m[t]&&m[t].name?m[t].name:t||"Unknown";return{label:`${e.title.rendered}`,template:n,value:e.id}})],_=p?`/wp-json/nok-2025-v1/v1/embed-page-part/${p}?${new URLSearchParams(Object.entries(u).map(([e,t])=>[e,t])).toString()}`:"",j=(0,r.useRef)(null),[k,S]=(0,r.useState)(400);return(0,r.useEffect)(()=>{const e=j.current;if(!e)return;let t;const n=()=>{try{const t=e.contentDocument||e.contentWindow.document,n=Math.max(t.documentElement.scrollHeight,t.body.scrollHeight);S(n)}catch(e){}},o=()=>{n();try{const t=(e.contentDocument||e.contentWindow.document).querySelector('meta[name="yoast-content"]');if(t&&p){const e=t.getAttribute("content");window.nokPagePartData=window.nokPagePartData||{},window.nokPagePartData[p]=e,window.nokYoastIntegration?.debug&&console.log(`[Yoast] Stored content for part ${p}:`,e.length,"chars")}}catch(e){}e.contentDocument&&e.contentDocument.body&&(t=new MutationObserver(n),t.observe(e.contentDocument.body,{childList:!0,subtree:!0,attributes:!0}))};return e.addEventListener("load",o),()=>{e.removeEventListener("load",o),t&&t.disconnect()}},[p]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.BlockControls,{}),(0,l.jsxs)("div",{...(0,t.useBlockProps)(),style:{position:"relative",width:"100%",margin:"0",maxWidth:"100%"},children:[g&&(0,l.jsx)("div",{style:{position:"absolute",top:"10px",right:"10px",background:"#f0f0f1",padding:"4px 8px",borderRadius:"3px",fontSize:"11px",color:"#666",zIndex:10,border:"1px solid #ddd"},children:"ðŸš« SEO uitgesloten"}),(0,l.jsxs)(n.PanelBody,{title:(0,i.__)("NOK Page Part Blok",d),initialOpen:!0,children:[(0,l.jsx)(s,{label:(0,i.__)("Selecteer een Page Part uit de lijst",d),value:p,options:w,onChange:e=>c({postId:parseInt(e,10)}),onOpen:()=>{x("getEntityRecords",["postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}])}}),0!==p&&(0,l.jsx)(n.PanelBody,{title:(0,i.__)("SEO Instellingen",d),initialOpen:!1,children:(0,l.jsx)(n.CheckboxControl,{label:(0,i.__)("Meenemen in SEO analyse",d),help:(0,i.__)("Schakel uit om deze page part uit te sluiten van Yoast SEO analyse",d),checked:!g,onChange:e=>{c({excludeFromSeo:!e}),window.nokYoastIntegration?.debug&&console.log(`[Yoast] Part ${p} SEO exclusion changed to:`,!e)}})}),v.length>0&&0!==p&&(0,l.jsxs)(n.PanelBody,{title:(0,i.__)("Pagina-afhankelijke overrides",d),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Deze page part biedt de mogelijkheid om enkele instellingen specifek voor deze pagina te overschrijven/herdefinieren:"}),v.map(e=>{const t=u[e.meta_key]||"",o=t=>{const n={...u};""===t||null===t?delete n[e.meta_key]:n[e.meta_key]=t,c({overrides:n})};switch(e.type){case"icon-selector":const i=window.PagePartDesignSettings?.icons||{};return(0,l.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,l.jsxs)("label",{style:{display:"block",fontSize:"11px",fontWeight:"600",marginBottom:"4px",color:"#666"},children:["Override ",e.label]}),t&&(0,l.jsx)("button",{onClick:()=>o(""),style:{fontSize:"11px",color:"#d63638",background:"none",border:"none",padding:"0",marginBottom:"8px",cursor:"pointer",textDecoration:"underline"},children:"Clear override (gebruik de ingestelde waarde)"}),(0,l.jsx)(a,{value:t,icons:i,onChange:o})]},e.meta_key);case"select":const r=e.options||[],d=e.option_labels||r;return(0,l.jsx)(n.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"â€” Gebruik de ingestelde waarde â€”",value:""},...r.map((e,t)=>({label:d[t]||e,value:e}))],onChange:o},e.meta_key);case"checkbox":return(0,l.jsx)(n.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"â€” Gebruik de ingestelde waarde â€”",value:""},{label:"Ja",value:"1"},{label:"Nee",value:"0"}],onChange:o},e.meta_key);case"text":case"url":return(0,l.jsx)(n.TextControl,{label:`Override ${e.label}`,value:t,onChange:o,placeholder:"â€” Gebruik de ingestelde waarde â€”"},e.meta_key);default:return null}})]}),0!==p&&f.featured_image_overridable&&(0,l.jsxs)(n.PanelBody,{title:(0,i.__)("Uitgelichte afbeelding",d),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Overschrijf de uitgelichte afbeelding van deze page part specifiek voor deze pagina."}),(0,l.jsx)(t.MediaUploadCheck,{children:(0,l.jsx)(t.MediaUpload,{onSelect:e=>{const t={...u};t._override_thumbnail_id=e.id,c({overrides:t})},allowedTypes:["image"],value:u._override_thumbnail_id||"",render:({open:e})=>(0,l.jsxs)("div",{children:[y&&(0,l.jsx)("div",{style:{marginBottom:"12px",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden",maxWidth:"200px"},children:(0,l.jsx)("img",{src:y.media_details?.sizes?.medium?.source_url||y.media_details?.sizes?.thumbnail?.source_url||y.source_url,style:{width:"100%",height:"auto",display:"block"},alt:""})}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,l.jsx)(n.Button,{variant:"secondary",onClick:e,children:y?(0,i.__)("Wijzig afbeelding",d):(0,i.__)("Selecteer afbeelding",d)}),y&&(0,l.jsx)(n.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{const e={...u};delete e._override_thumbnail_id,c({overrides:e})},children:(0,i.__)("Verwijder override",d)})]})]})})})]})]}),0===p?(0,l.jsx)("div",{style:{padding:"40px 20px",textAlign:"center",backgroundColor:"#f0f0f1",border:"1px dashed #ccc"},children:(0,l.jsx)("p",{style:{margin:0,color:"#666"},children:(0,i.__)("Selecteer een Page Part om de preview te zien",d)})}):(0,l.jsx)("iframe",{ref:j,src:_,style:{width:"100%",height:`${k}px`,border:"none"}})]})]})},save:()=>null})})();