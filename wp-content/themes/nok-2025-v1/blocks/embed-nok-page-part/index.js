(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,i=window.wp.components,n=window.wp.data,r=window.wp.i18n,o=window.wp.element,l=window.ReactJSXRuntime,a="nok-2025-v1",d=({value:e,options:t,onChange:n})=>{const[r,a]=(0,o.useState)(!1),[d,s]=(0,o.useState)(null),c=(0,o.useRef)(),p=t.find(t=>t.value===e);return(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsxs)(i.Button,{ref:c,variant:"secondary",onClick:()=>a(!r),style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"end",color:"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:p?.label||"Select Page Part..."},style:{flexBasis:"100%"}}),p?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${p.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null,(0,l.jsx)("span",{children:"▼"})]}),r&&(0,l.jsx)("div",{style:{position:"absolute",top:"100%",left:"0",right:"0",zIndex:999999,backgroundColor:"white",border:"1px solid #ccd0d4",borderRadius:"4px",boxShadow:"0 2px 6px rgba(0,0,0,0.05)",maxHeight:"300px",overflow:"hidden"},children:(0,l.jsx)("div",{style:{minWidth:"100%",maxHeight:"300px",backgroundColor:"white",border:"1px solid #ccd0d4",borderRadius:"4px",boxShadow:"0 2px 6px rgba(0,0,0,0.05)",overflow:"hidden auto"},children:t.map(t=>(0,l.jsxs)(i.Button,{variant:"tertiary",onMouseEnter:()=>s(t.value),onMouseLeave:()=>s(null),onClick:()=>{n(t.value),a(!1)},style:{width:"100%",textAlign:"left",padding:"8px 12px",borderBottom:"1px solid #f0f0f1",borderRadius:"0",justifyContent:"space-between",backgroundColor:t.value===e?"var(--wp-admin-theme-color)":d===t.value?"#e6f3ff":"transparent",color:t.value===e?"white":"inherit"},children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}}),t.value?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:`${t.template}`},style:{padding:"2px 6px",backgroundColor:"#f0f0f1",borderRadius:"6px",fontSize:"1em",color:"#555"}}):null]},t.value))})})]})};(0,e.registerBlockType)("nok2025/embed-nok-page-part",{edit:({attributes:e,setAttributes:s})=>{const{postId:c,overrides:p}=e,u=(0,n.useSelect)(e=>e("core").getEntityRecords("postType","page_part",{per_page:-1,_embed:!0,orderby:"modified",order:"desc"}),[])||[],h="undefined"!=typeof window&&window.PagePartDesignSettings&&window.PagePartDesignSettings.registry||{},x=u.find(e=>e.id===c),g=h[x?.meta?.design_slug||""]||{},m=(g.custom_fields||[]).filter(e=>e.page_editable),b=(0,n.useSelect)(e=>{const t=p._override_thumbnail_id;return t?e("core").getMedia(t):null},[p._override_thumbnail_id]),_=[{label:(0,r.__)(" - Selecteer Page Part blok… - ",a),value:0},...u.map(e=>{const t=e.meta&&e.meta.design_slug||"",i=h[t]&&h[t].name?h[t].name:t||"Unknown";return{label:`${e.title.rendered}`,template:i,value:e.id}})],v=c?`/wp-json/nok-2025-v1/v1/embed-page-part/${c}?${new URLSearchParams(Object.entries(p).map(([e,t])=>[e,t])).toString()}`:"",f=(0,o.useRef)(null),[w,y]=(0,o.useState)(400);return(0,o.useEffect)(()=>{const e=f.current;if(!e)return;let t;const i=()=>{try{const t=e.contentDocument||e.contentWindow.document,i=Math.max(t.documentElement.scrollHeight,t.body.scrollHeight);y(i)}catch(e){}},n=()=>{i(),e.contentDocument&&e.contentDocument.body&&(t=new MutationObserver(i),t.observe(e.contentDocument.body,{childList:!0,subtree:!0,attributes:!0}))};return e.addEventListener("load",n),()=>{e.removeEventListener("load",n),t&&t.disconnect()}},[c]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.BlockControls,{}),(0,l.jsxs)("div",{...(0,t.useBlockProps)(),style:{position:"relative",width:"100%",margin:"0",maxWidth:"100%"},children:[(0,l.jsxs)(i.PanelBody,{title:(0,r.__)("NOK Page Part Blok",a),initialOpen:!0,children:[(0,l.jsx)(d,{label:(0,r.__)("Selecteer een Page Part uit de lijst",a),value:c,options:_,onChange:e=>s({postId:parseInt(e,10)})}),m.length>0&&0!==c&&(0,l.jsxs)(i.PanelBody,{title:(0,r.__)("Pagina-afhankelijke overrides",a),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Deze page part biedt de mogelijkheid om enkele instellingen specifek voor deze pagina te overschrijven/herdefinieren:"}),m.map(e=>{const t=p[e.meta_key]||"",n=t=>{const i={...p};""===t||null===t?delete i[e.meta_key]:i[e.meta_key]=t,s({overrides:i})};switch(e.type){case"select":const r=e.options||[],o=e.option_labels||r;return(0,l.jsx)(i.SelectControl,{label:`Override ${e.label}`,value:t,options:[{label:"— Gebruik de ingestelde waarde —",value:""},...r.map((e,t)=>({label:o[t]||e,value:e}))],onChange:n},e.meta_key);case"checkbox":return(0,l.jsx)(i.CheckboxControl,{label:`Override ${e.label}`,checked:"1"===t,onChange:e=>n(e?"1":"0")},e.meta_key);default:return(0,l.jsx)(i.TextControl,{label:`Override ${e.label}`,value:t,onChange:n,placeholder:"Gebruik de ingestelde waarde"},e.meta_key)}})]}),0!==c&&g.featured_image_overridable&&(0,l.jsxs)(i.PanelBody,{title:(0,r.__)("Uitgelichte afbeelding",a),initialOpen:!1,children:[(0,l.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"12px"},children:"Overschrijf de uitgelichte afbeelding van deze page part specifiek voor deze pagina."}),(0,l.jsx)(t.MediaUploadCheck,{children:(0,l.jsx)(t.MediaUpload,{onSelect:e=>{const t={...p};t._override_thumbnail_id=e.id,s({overrides:t})},allowedTypes:["image"],value:p._override_thumbnail_id||"",render:({open:e})=>(0,l.jsxs)(l.Fragment,{children:[p._override_thumbnail_id&&(0,l.jsx)("div",{style:{marginBottom:"12px",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden",maxWidth:"200px"},children:b?(0,l.jsx)("img",{src:b.media_details?.sizes?.medium?.source_url||b.media_details?.sizes?.thumbnail?.source_url||b.source_url,style:{width:"100%",height:"auto",display:"block"},alt:""}):(0,l.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"Laden..."})}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,l.jsx)(i.Button,{variant:"secondary",onClick:e,children:p._override_thumbnail_id?(0,r.__)("Wijzig afbeelding",a):(0,r.__)("Selecteer afbeelding",a)}),p._override_thumbnail_id&&(0,l.jsx)(i.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{const e={...p};delete e._override_thumbnail_id,s({overrides:e})},children:(0,r.__)("Verwijder override",a)})]})]})})})]})]}),c?(0,l.jsx)("div",{style:{position:"relative",width:"100%"},children:(0,l.jsx)("iframe",{ref:f,title:(0,r.__)("Embedded NOK Page Part",a),src:v,style:{width:"100%",height:`${w}px`,border:0},sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"},`${c}-${JSON.stringify(p)}`)}):(0,l.jsx)("p",{children:(0,r.__)("Selecteer een blok om te bekijken…",a)})]})]})},save:()=>null})})();